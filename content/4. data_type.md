# Flutter Dart è³‡æ–™å‹åˆ¥èˆ‡å‡½æ•¸å®Œå…¨æŒ‡å—

## ğŸ¯ æ¦‚å¿µé‡æ¸…

åœ¨ Dart ä¸­ï¼Œ`void`ã€`Future<void>`ã€`bool`ã€`List<String>`ã€`String` é€™äº›**ä¸æ˜¯å‡½æ•¸**ï¼Œè€Œæ˜¯**è³‡æ–™å‹åˆ¥**ï¼ˆData Typesï¼‰ã€‚å®ƒå€‘ç”¨ä¾†å‘Šè¨´ç¨‹å¼ï¼š

- è®Šæ•¸å¯ä»¥å„²å­˜ä»€éº¼é¡å‹çš„è³‡æ–™
- å‡½æ•¸æœƒå›å‚³ä»€éº¼é¡å‹çš„å€¼
- åƒæ•¸æœŸæœ›æ¥æ”¶ä»€éº¼é¡å‹çš„è³‡æ–™

```dart
// é€™äº›æ˜¯å‹åˆ¥å®£å‘Šï¼Œä¸æ˜¯å‡½æ•¸ï¼
String name = 'Flutter';           // String å‹åˆ¥çš„è®Šæ•¸
bool isVisible = true;             // bool å‹åˆ¥çš„è®Šæ•¸  
List<String> items = ['A', 'B'];   // List<String> å‹åˆ¥çš„è®Šæ•¸

// åœ¨å‡½æ•¸ä¸­ä½¿ç”¨å‹åˆ¥
String getName() {                 // å›å‚³ String å‹åˆ¥
  return 'Flutter Developer';
}

void printMessage() {              // ä¸å›å‚³ä»»ä½•å€¼ï¼ˆvoidï¼‰
  print('Hello World');
}
```

------

## ğŸ“ Dart åŸºæœ¬è³‡æ–™å‹åˆ¥

### 1. **åŸºæœ¬å‹åˆ¥**

#### `int` - æ•´æ•¸

```dart
// æ•´æ•¸å‹åˆ¥
int age = 25;
int score = 100;
int negative = -10;

// å¸¸ç”¨æ“ä½œ
int sum = 10 + 20;        // åŠ æ³•
int difference = 30 - 15; // æ¸›æ³•
int product = 5 * 6;      // ä¹˜æ³•
int quotient = 20 ~/ 3;   // æ•´æ•¸é™¤æ³• = 6
int remainder = 20 % 3;   // é¤˜æ•¸ = 2

print('å¹´é½¡ï¼š$age');        // å­—ä¸²æ’å€¼
print('åˆ†æ•¸æ˜¯å¦åŠæ ¼ï¼š${score >= 60}'); // æ¯”è¼ƒé‹ç®—
```

#### `double` - æµ®é»æ•¸

```dart
// æµ®é»æ•¸å‹åˆ¥
double height = 175.5;
double weight = 68.2;
double pi = 3.14159;

// æ•¸å­¸é‹ç®—
double bmi = weight / ((height / 100) * (height / 100));
double area = pi * 5 * 5; // åœ“é¢ç©

// ç²¾åº¦æ§åˆ¶
double rounded = double.parse(bmi.toStringAsFixed(2)); // ä¿ç•™å…©ä½å°æ•¸

print('BMI: ${bmi.toStringAsFixed(1)}');
```

#### `String` - å­—ä¸²

```dart
// å­—ä¸²å®£å‘Šæ–¹å¼
String name = 'Flutter Developer';
String title = "æ‡‰ç”¨ç¨‹å¼é–‹ç™¼è€…";
String multiLine = '''
é€™æ˜¯å¤šè¡Œå­—ä¸²
å¯ä»¥åŒ…å«æ›è¡Œ
éå¸¸æ–¹ä¾¿
''';

// å­—ä¸²æ“ä½œ
String firstName = 'John';
String lastName = 'Doe';
String fullName = '$firstName $lastName';        // å­—ä¸²æ’å€¼
String upperName = fullName.toUpperCase();       // è½‰å¤§å¯«
String lowerName = fullName.toLowerCase();       // è½‰å°å¯«

// å­—ä¸²æ–¹æ³•
bool isEmpty = name.isEmpty;                     // æª¢æŸ¥æ˜¯å¦ç‚ºç©º
bool contains = name.contains('Flutter');       // åŒ…å«æª¢æŸ¥
int length = name.length;                        // å­—ä¸²é•·åº¦
String substring = name.substring(0, 7);        // å­å­—ä¸²
List<String> words = name.split(' ');           // åˆ†å‰²å­—ä¸²

// å­—ä¸²æ¯”è¼ƒ
String str1 = 'Hello';
String str2 = 'hello';
bool isEqual = str1 == str2;                     // false (å¤§å°å¯«æ•æ„Ÿ)
bool isEqualIgnoreCase = str1.toLowerCase() == str2.toLowerCase(); // true

print('å…¨åï¼š$fullName');
print('åŒ…å« Flutterï¼š$contains');
print('å­—ä¸²é•·åº¦ï¼š$length');
```

#### `bool` - å¸ƒæ—å€¼

```dart
// å¸ƒæ—å€¼åªæœ‰å…©å€‹å€¼ï¼štrue æˆ– false
bool isLoggedIn = false;
bool isAdmin = true;
bool isVisible = true;

// é‚è¼¯é‹ç®—
bool result1 = true && false;   // AND é‹ç®— = false
bool result2 = true || false;   // OR é‹ç®— = true
bool result3 = !true;           // NOT é‹ç®— = false

// æ¢ä»¶åˆ¤æ–·
int score = 85;
bool isPassed = score >= 60;    // true
bool isExcellent = score >= 90; // false

// åœ¨æ¢ä»¶èªå¥ä¸­ä½¿ç”¨
if (isLoggedIn && isAdmin) {
  print('æ­¡è¿ç®¡ç†å“¡');
} else if (isLoggedIn) {
  print('æ­¡è¿ä½¿ç”¨è€…');
} else {
  print('è«‹å…ˆç™»å…¥');
}

// ä¸‰å…ƒé‹ç®—å­
String status = isLoggedIn ? 'å·²ç™»å…¥' : 'æœªç™»å…¥';
```

### 2. **é›†åˆå‹åˆ¥**

#### `List<T>` - é™£åˆ—/æ¸…å–®

```dart
// List å®£å‘Šæ–¹å¼
List<String> fruits = ['è˜‹æœ', 'é¦™è•‰', 'æ©˜å­'];
List<int> numbers = [1, 2, 3, 4, 5];
List<bool> flags = [true, false, true];

// ç©º List
List<String> emptyList = [];
List<String> emptyList2 = <String>[];
List<String> emptyList3 = List<String>.empty(growable: true);

// List æ“ä½œ
fruits.add('è‘¡è„');                    // æ–°å¢å…ƒç´ 
fruits.addAll(['èŠ’æœ', 'é³³æ¢¨']);        // æ–°å¢å¤šå€‹å…ƒç´ 
fruits.insert(1, 'å¥‡ç•°æœ');            // åœ¨æŒ‡å®šä½ç½®æ’å…¥
fruits.remove('é¦™è•‰');                 // ç§»é™¤ç‰¹å®šå…ƒç´ 
fruits.removeAt(0);                   // ç§»é™¤æŒ‡å®šä½ç½®å…ƒç´ 
fruits.clear();                       // æ¸…ç©ºæ‰€æœ‰å…ƒç´ 

// List å±¬æ€§
int length = fruits.length;           // å–å¾—é•·åº¦
bool isEmpty = fruits.isEmpty;        // æª¢æŸ¥æ˜¯å¦ç‚ºç©º
bool isNotEmpty = fruits.isNotEmpty;  // æª¢æŸ¥æ˜¯å¦éç©º
String first = fruits.first;          // ç¬¬ä¸€å€‹å…ƒç´ 
String last = fruits.last;            // æœ€å¾Œä¸€å€‹å…ƒç´ 

// List éæ­·
for (String fruit in fruits) {
  print('æ°´æœï¼š$fruit');
}

for (int i = 0; i < fruits.length; i++) {
  print('ç¬¬ ${i + 1} å€‹æ°´æœï¼š${fruits[i]}');
}

fruits.forEach((fruit) {
  print('ä½¿ç”¨ forEachï¼š$fruit');
});

// List è½‰æ›
List<String> upperFruits = fruits.map((fruit) => fruit.toUpperCase()).toList();
List<String> longNames = fruits.where((fruit) => fruit.length > 2).toList();

// ç¯„ä¾‹ï¼šå»ºç«‹è³¼ç‰©æ¸…å–® Widget
class ShoppingList extends StatelessWidget {
  final List<String> items = ['ç‰›å¥¶', 'éºµåŒ…', 'é›è›‹', 'è˜‹æœ'];
  
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: items.length,
      itemBuilder: (context, index) {
        return ListTile(
          leading: Icon(Icons.shopping_cart),
          title: Text(items[index]),
          trailing: IconButton(
            icon: Icon(Icons.delete),
            onPressed: () {
              // ç§»é™¤é …ç›®çš„é‚è¼¯
            },
          ),
        );
      },
    );
  }
}
```

#### `Map<K, V>` - å­—å…¸/å°æ˜ 

```dart
// Map å®£å‘Šæ–¹å¼
Map<String, String> userInfo = {
  'name': 'å¼µå°æ˜',
  'email': 'ming@example.com',
  'phone': '0912-345-678'
};

Map<String, int> scores = {
  'åœ‹æ–‡': 85,
  'è‹±æ–‡': 92,
  'æ•¸å­¸': 78
};

// ç©º Map
Map<String, String> emptyMap = {};
Map<String, String> emptyMap2 = <String, String>{};

// Map æ“ä½œ
userInfo['address'] = 'å°åŒ—å¸‚ä¿¡ç¾©å€';     // æ–°å¢/æ›´æ–°
userInfo.remove('phone');               // ç§»é™¤
bool hasEmail = userInfo.containsKey('email'); // æª¢æŸ¥éµæ˜¯å¦å­˜åœ¨
bool hasValue = userInfo.containsValue('å¼µå°æ˜'); // æª¢æŸ¥å€¼æ˜¯å¦å­˜åœ¨

// Map å±¬æ€§å’Œæ–¹æ³•
int length = userInfo.length;           // å–å¾—å¤§å°
bool isEmpty = userInfo.isEmpty;        // æª¢æŸ¥æ˜¯å¦ç‚ºç©º
Iterable<String> keys = userInfo.keys;  // å–å¾—æ‰€æœ‰éµ
Iterable<String> values = userInfo.values; // å–å¾—æ‰€æœ‰å€¼

// Map éæ­·
userInfo.forEach((key, value) {
  print('$key: $value');
});

for (String key in userInfo.keys) {
  print('$key: ${userInfo[key]}');
}

// å®‰å…¨å–å€¼ï¼ˆé¿å… nullï¼‰
String? email = userInfo['email'];      // å¯èƒ½ç‚º null
String emailSafe = userInfo['email'] ?? 'æœªè¨­å®š'; // æä¾›é è¨­å€¼

// ç¯„ä¾‹ï¼šä½¿ç”¨è€…è¨­å®š Widget
class UserProfile extends StatelessWidget {
  final Map<String, dynamic> profile = {
    'avatar': 'assets/images/avatar.png',
    'name': 'å¼µå°æ˜',
    'age': 25,
    'isVip': true,
    'joinDate': DateTime(2023, 1, 15),
  };
  
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        CircleAvatar(
          backgroundImage: AssetImage(profile['avatar']),
          radius: 50,
        ),
        SizedBox(height: 16),
        Text(
          profile['name'],
          style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
        ),
        Text('å¹´é½¡ï¼š${profile['age']}'),
        if (profile['isVip']) 
          Chip(
            label: Text('VIP æœƒå“¡'),
            backgroundColor: Colors.gold,
          ),
      ],
    );
  }
}
```

#### `Set<T>` - é›†åˆï¼ˆä¸é‡è¤‡å…ƒç´ ï¼‰

```dart
// Set å®£å‘Š
Set<String> uniqueFruits = {'è˜‹æœ', 'é¦™è•‰', 'æ©˜å­'};
Set<int> uniqueNumbers = {1, 2, 3, 3, 4}; // é‡è¤‡çš„ 3 åªæœƒä¿ç•™ä¸€å€‹

// Set æ“ä½œ
uniqueFruits.add('è‘¡è„');               // æ–°å¢
uniqueFruits.addAll(['èŠ’æœ', 'è˜‹æœ']);   // æ–°å¢å¤šå€‹ï¼ˆé‡è¤‡çš„æœƒè¢«å¿½ç•¥ï¼‰
uniqueFruits.remove('é¦™è•‰');            // ç§»é™¤
bool contains = uniqueFruits.contains('è˜‹æœ'); // æª¢æŸ¥æ˜¯å¦åŒ…å«

// Set é‹ç®—
Set<int> set1 = {1, 2, 3, 4};
Set<int> set2 = {3, 4, 5, 6};

Set<int> union = set1.union(set2);           // è¯é›† {1, 2, 3, 4, 5, 6}
Set<int> intersection = set1.intersection(set2); // äº¤é›† {3, 4}
Set<int> difference = set1.difference(set2);     // å·®é›† {1, 2}

// è½‰æ›
List<String> fruitList = uniqueFruits.toList(); // Set è½‰ List
Set<String> fruitSet = fruitList.toSet();       // List è½‰ Setï¼ˆå»é‡è¤‡ï¼‰
```

------

## ğŸ”„ å‡½æ•¸èˆ‡å›å‚³å‹åˆ¥

### 1. **void - ç„¡å›å‚³å€¼**

```dart
// void è¡¨ç¤ºå‡½æ•¸ä¸å›å‚³ä»»ä½•å€¼
void printWelcome() {
  print('æ­¡è¿ä½¿ç”¨ Flutter æ‡‰ç”¨ç¨‹å¼ï¼');
  // æ²’æœ‰ return èªå¥ï¼Œæˆ–è€… return; ï¼ˆä¸å›å‚³å€¼ï¼‰
}

void updateUserInfo(String name, int age) {
  print('æ›´æ–°ä½¿ç”¨è€…è³‡è¨Šï¼š$name, $age æ­²');
  // åŸ·è¡Œæ›´æ–°é‚è¼¯ï¼Œä½†ä¸å›å‚³çµæœ
}

void showDialog(BuildContext context, String message) {
  showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('æç¤º'),
      content: Text(message),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('ç¢ºå®š'),
        ),
      ],
    ),
  );
}

// åœ¨ Widget ä¸­çš„ä½¿ç”¨
class MyWidget extends StatelessWidget {
  void _handleButtonPress() {  // void å‡½æ•¸
    print('æŒ‰éˆ•è¢«é»æ“Šäº†');
    // åŸ·è¡ŒæŸäº›å‹•ä½œï¼Œä½†ä¸éœ€è¦å›å‚³å€¼
  }
  
  @override
  Widget build(BuildContext context) {
    return ElevatedButton(
      onPressed: _handleButtonPress, // å‚³é void å‡½æ•¸
      child: Text('é»æ“Šæˆ‘'),
    );
  }
}
```

### 2. **å…·é«”å‹åˆ¥å›å‚³**

```dart
// String å›å‚³å‹åˆ¥
String getUserName() {
  return 'å¼µå°æ˜';
}

String formatDate(DateTime date) {
  return '${date.year}å¹´${date.month}æœˆ${date.day}æ—¥';
}

// int å›å‚³å‹åˆ¥
int calculateAge(DateTime birthDate) {
  DateTime now = DateTime.now();
  int age = now.year - birthDate.year;
  if (now.month < birthDate.month || 
      (now.month == birthDate.month && now.day < birthDate.day)) {
    age--;
  }
  return age;
}

// bool å›å‚³å‹åˆ¥
bool isEmailValid(String email) {
  return RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$').hasMatch(email);
}

bool isAdult(int age) {
  return age >= 18;
}

// List å›å‚³å‹åˆ¥
List<String> getWeekdays() {
  return ['æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­', 'æ˜ŸæœŸæ—¥'];
}

List<int> generateNumbers(int count) {
  return List.generate(count, (index) => index + 1);
}

// Map å›å‚³å‹åˆ¥
Map<String, dynamic> createUserData(String name, int age, String email) {
  return {
    'name': name,
    'age': age,
    'email': email,
    'createdAt': DateTime.now().toIso8601String(),
    'isActive': true,
  };
}

// å¯¦éš›ä½¿ç”¨ç¯„ä¾‹
class UserService {
  // å–å¾—ä½¿ç”¨è€…é¡¯ç¤ºåç¨±
  String getDisplayName(Map<String, dynamic> user) {
    String firstName = user['firstName'] ?? '';
    String lastName = user['lastName'] ?? '';
    return '$lastName $firstName'.trim();
  }
  
  // æª¢æŸ¥ä½¿ç”¨è€…æ¬Šé™
  bool hasPermission(Map<String, dynamic> user, String permission) {
    List<String> permissions = List<String>.from(user['permissions'] ?? []);
    return permissions.contains(permission);
  }
  
  // å–å¾—ä½¿ç”¨è€…çš„æœ‹å‹æ¸…å–®
  List<String> getFriendNames(Map<String, dynamic> user) {
    List<Map<String, dynamic>> friends = 
        List<Map<String, dynamic>>.from(user['friends'] ?? []);
    return friends.map((friend) => friend['name'] as String).toList();
  }
}
```

### 3. **Future<T> - ç•°æ­¥å›å‚³å‹åˆ¥**

```dart
// Future<void> - ç•°æ­¥æ“ä½œä½†ä¸å›å‚³å€¼
Future<void> loadUserData() async {
  print('é–‹å§‹è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™...');
  await Future.delayed(Duration(seconds: 2)); // æ¨¡æ“¬ç¶²è·¯å»¶é²
  print('ä½¿ç”¨è€…è³‡æ–™è¼‰å…¥å®Œæˆ');
  // ä¸å›å‚³ä»»ä½•å€¼ï¼Œåªæ˜¯åŸ·è¡Œç•°æ­¥æ“ä½œ
}

Future<void> saveToDatabase(Map<String, dynamic> data) async {
  // æ¨¡æ“¬å„²å­˜åˆ°è³‡æ–™åº«
  await Future.delayed(Duration(milliseconds: 500));
  print('è³‡æ–™å·²å„²å­˜ï¼š$data');
}

// Future<String> - ç•°æ­¥å›å‚³å­—ä¸²
Future<String> fetchUserName(String userId) async {
  // æ¨¡æ“¬ API å‘¼å«
  await Future.delayed(Duration(seconds: 1));
  return 'ä½¿ç”¨è€…_$userId';
}

Future<String> downloadFile(String url) async {
  print('é–‹å§‹ä¸‹è¼‰ï¼š$url');
  await Future.delayed(Duration(seconds: 3));
  return '/downloads/file_${DateTime.now().millisecondsSinceEpoch}.zip';
}

// Future<bool> - ç•°æ­¥å›å‚³å¸ƒæ—å€¼
Future<bool> authenticateUser(String username, String password) async {
  await Future.delayed(Duration(seconds: 1)); // æ¨¡æ“¬é©—è­‰éç¨‹
  
  // ç°¡å–®çš„é©—è­‰é‚è¼¯
  if (username == 'admin' && password == '123456') {
    return true;
  }
  return false;
}

Future<bool> checkNetworkConnection() async {
  // æª¢æŸ¥ç¶²è·¯é€£ç·šç‹€æ…‹
  await Future.delayed(Duration(milliseconds: 200));
  return true; // å‡è¨­æœ‰ç¶²è·¯é€£ç·š
}

// Future<List<T>> - ç•°æ­¥å›å‚³åˆ—è¡¨
Future<List<String>> fetchNotifications() async {
  await Future.delayed(Duration(seconds: 2));
  return [
    'æ‚¨æœ‰æ–°çš„è¨Šæ¯',
    'ç³»çµ±ç¶­è­·é€šçŸ¥',
    'å¥½å‹é‚€è«‹',
    'æ´»å‹•æé†’'
  ];
}

Future<List<Map<String, dynamic>>> fetchProducts() async {
  await Future.delayed(Duration(seconds: 1));
  return [
    {'id': 1, 'name': 'iPhone 15', 'price': 30900},
    {'id': 2, 'name': 'iPad Air', 'price': 19900},
    {'id': 3, 'name': 'MacBook Pro', 'price': 65900},
  ];
}

// Future<Map<K, V>> - ç•°æ­¥å›å‚³å°æ˜ 
Future<Map<String, dynamic>> fetchWeatherData(String city) async {
  await Future.delayed(Duration(milliseconds: 800));
  return {
    'city': city,
    'temperature': 25.6,
    'humidity': 65,
    'condition': 'æ™´æœ—',
    'forecast': ['ä»Šæ—¥æ™´', 'æ˜æ—¥é™°', 'å¾Œæ—¥é›¨'],
    'lastUpdated': DateTime.now().toIso8601String(),
  };
}

// åœ¨ Widget ä¸­ä½¿ç”¨ Future
class AsyncDataWidget extends StatefulWidget {
  @override
  _AsyncDataWidgetState createState() => _AsyncDataWidgetState();
}

class _AsyncDataWidgetState extends State<AsyncDataWidget> {
  String userName = '';
  List<String> notifications = [];
  bool isLoading = false;
  
  @override
  void initState() {
    super.initState();
    _loadData(); // åœ¨åˆå§‹åŒ–æ™‚è¼‰å…¥è³‡æ–™
  }
  
  // è¼‰å…¥è³‡æ–™çš„ç•°æ­¥æ–¹æ³•
  Future<void> _loadData() async {
    setState(() {
      isLoading = true;
    });
    
    try {
      // ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹ç•°æ­¥æ“ä½œ
      final results = await Future.wait([
        fetchUserName('user123'),
        fetchNotifications(),
      ]);
      
      setState(() {
        userName = results[0] as String;
        notifications = results[1] as List<String>;
        isLoading = false;
      });
    } catch (error) {
      print('è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š$error');
      setState(() {
        isLoading = false;
      });
    }
  }
  
  // é‡æ–°æ•´ç†è³‡æ–™
  Future<void> _refreshData() async {
    await _loadData();
  }
  
  @override
  Widget build(BuildContext context) {
    if (isLoading) {
      return Center(child: CircularProgressIndicator());
    }
    
    return RefreshIndicator(
      onRefresh: _refreshData,
      child: Column(
        children: [
          Text('æ­¡è¿ï¼Œ$userName'),
          SizedBox(height: 16),
          Text('é€šçŸ¥ (${notifications.length})ï¼š'),
          Expanded(
            child: ListView.builder(
              itemCount: notifications.length,
              itemBuilder: (context, index) {
                return ListTile(
                  leading: Icon(Icons.notifications),
                  title: Text(notifications[index]),
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}

// ç•°æ­¥æ“ä½œçš„éŒ¯èª¤è™•ç†
class ApiService {
  // å¸¶éŒ¯èª¤è™•ç†çš„ç•°æ­¥æ–¹æ³•
  Future<Map<String, dynamic>?> loginUser(String email, String password) async {
    try {
      // æ¨¡æ“¬ç™»å…¥ API å‘¼å«
      await Future.delayed(Duration(seconds: 2));
      
      if (email.isEmpty || password.isEmpty) {
        throw Exception('é›»å­éƒµä»¶å’Œå¯†ç¢¼ä¸èƒ½ç‚ºç©º');
      }
      
      if (!isEmailValid(email)) {
        throw Exception('é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º');
      }
      
      bool isAuthenticated = await authenticateUser(email, password);
      if (!isAuthenticated) {
        throw Exception('é›»å­éƒµä»¶æˆ–å¯†ç¢¼éŒ¯èª¤');
      }
      
      return {
        'success': true,
        'user': {
          'email': email,
          'name': 'å¼µå°æ˜',
          'token': 'jwt_token_here',
        }
      };
    } catch (error) {
      print('ç™»å…¥å¤±æ•—ï¼š$error');
      return {
        'success': false,
        'error': error.toString(),
      };
    }
  }
  
  // ä½¿ç”¨ async/await è™•ç†å¤šå€‹ç•°æ­¥æ“ä½œ
  Future<bool> updateUserProfile(String userId, Map<String, dynamic> profileData) async {
    try {
      // 1. é©—è­‰è³‡æ–™
      if (profileData.isEmpty) {
        throw Exception('æ›´æ–°è³‡æ–™ä¸èƒ½ç‚ºç©º');
      }
      
      // 2. ä¸Šå‚³é ­åƒï¼ˆå¦‚æœæœ‰ï¼‰
      if (profileData.containsKey('avatar')) {
        String avatarUrl = await uploadAvatar(profileData['avatar']);
        profileData['avatarUrl'] = avatarUrl;
      }
      
      // 3. æ›´æ–°ä½¿ç”¨è€…è³‡æ–™
      await updateDatabase(userId, profileData);
      
      // 4. æ¸…é™¤å¿«å–
      await clearUserCache(userId);
      
      return true;
    } catch (error) {
      print('æ›´æ–°å€‹äººè³‡æ–™å¤±æ•—ï¼š$error');
      return false;
    }
  }
  
  // è¼”åŠ©æ–¹æ³•
  Future<String> uploadAvatar(String imagePath) async {
    await Future.delayed(Duration(seconds: 1));
    return 'https://cdn.example.com/avatars/user_avatar.jpg';
  }
  
  Future<void> updateDatabase(String userId, Map<String, dynamic> data) async {
    await Future.delayed(Duration(milliseconds: 500));
    print('è³‡æ–™åº«å·²æ›´æ–°ï¼šä½¿ç”¨è€… $userId');
  }
  
  Future<void> clearUserCache(String userId) async {
    await Future.delayed(Duration(milliseconds: 100));
    print('å¿«å–å·²æ¸…é™¤ï¼šä½¿ç”¨è€… $userId');
  }
}
```

------

## ğŸ”§ é¡å‹å®‰å…¨èˆ‡ Null Safety

### 1. **å¯ç‚ºç©ºçš„å‹åˆ¥ï¼ˆNullable Typesï¼‰**

```dart
// å¯ç‚ºç©ºçš„å‹åˆ¥ï¼ˆåœ¨å‹åˆ¥å¾ŒåŠ  ?ï¼‰
String? nullableName;           // å¯ä»¥æ˜¯ String æˆ– null
int? nullableAge;               // å¯ä»¥æ˜¯ int æˆ– null
List<String>? nullableList;     // å¯ä»¥æ˜¯ List<String> æˆ– null

// ä¸å¯ç‚ºç©ºçš„å‹åˆ¥ï¼ˆé è¨­ï¼‰
String name = 'Flutter';        // å¿…é ˆæœ‰å€¼ï¼Œä¸èƒ½æ˜¯ null
int age = 25;                   // å¿…é ˆæœ‰å€¼ï¼Œä¸èƒ½æ˜¯ null

// æª¢æŸ¥å’Œä½¿ç”¨å¯ç‚ºç©ºçš„å€¼
String? getUserName() {
  // å¯èƒ½å›å‚³ null
  return null;
}

void handleUserName() {
  String? name = getUserName();
  
  // æ–¹æ³•1ï¼šä½¿ç”¨ if æª¢æŸ¥
  if (name != null) {
    print('ä½¿ç”¨è€…åç¨±ï¼š$name');
    print('åç¨±é•·åº¦ï¼š${name.length}'); // å®‰å…¨å­˜å–
  }
  
  // æ–¹æ³•2ï¼šä½¿ç”¨ null-aware é‹ç®—å­
  print('åç¨±é•·åº¦ï¼š${name?.length}');      // å¦‚æœ name ç‚º nullï¼Œçµæœç‚º null
  print('ä½¿ç”¨è€…åç¨±ï¼š${name ?? "è¨ªå®¢"}');   // å¦‚æœ name ç‚º nullï¼Œä½¿ç”¨é è¨­å€¼
  
  // æ–¹æ³•3ï¼šå¼·åˆ¶æ–·è¨€ï¼ˆéœ€ç¢ºä¿ä¸ç‚º nullï¼‰
  // print('åç¨±é•·åº¦ï¼š${name!.length}');   // å±éšªï¼å¦‚æœ name ç‚º null æœƒæ‹‹å‡ºç•°å¸¸
}

// å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹
class UserProfile {
  String name;                    // å¿…å¡«
  int age;                        // å¿…å¡«
  String? email;                  // å¯é¸
  String? phone;                  // å¯é¸
  List<String>? hobbies;          // å¯é¸
  
  UserProfile({
    required this.name,           // å¿…é ˆæä¾›
    required this.age,            // å¿…é ˆæä¾›
    this.email,                   // å¯é¸åƒæ•¸
    this.phone,                   // å¯é¸åƒæ•¸
    this.hobbies,                 // å¯é¸åƒæ•¸
  });
  
  // å®‰å…¨å–å¾—é›»å­éƒµä»¶
  String getEmailDisplay() {
    return email ?? 'æœªè¨­å®š';
  }
  
  // å®‰å…¨å–å¾—æ„›å¥½æ•¸é‡
  int getHobbyCount() {
    return hobbies?.length ?? 0;
  }
  
  // æª¢æŸ¥æ˜¯å¦æœ‰è¯çµ¡è³‡è¨Š
  bool hasContactInfo() {
    return email != null || phone != null;
  }
}
```

### 2. **å‹åˆ¥è½‰æ›èˆ‡æª¢æŸ¥**

```dart
// å‹åˆ¥æª¢æŸ¥
dynamic value = 'Hello World';

if (value is String) {
  print('é€™æ˜¯å­—ä¸²ï¼š$value');
  print('é•·åº¦ï¼š${value.length}'); // è‡ªå‹•è½‰å‹ï¼Œå¯ä»¥å®‰å…¨ä½¿ç”¨ String æ–¹æ³•
}

if (value is! int) {
  print('é€™ä¸æ˜¯æ•´æ•¸');
}

// å®‰å…¨çš„å‹åˆ¥è½‰æ›
String convertToString(dynamic value) {
  if (value is String) {
    return value;
  } else if (value is int) {
    return value.toString();
  } else if (value is double) {
    return value.toString();
  } else {
    return 'unknown';
  }
}

// ä½¿ç”¨ as é€²è¡Œå¼·åˆ¶è½‰å‹ï¼ˆéœ€è¦ç¢ºä¿å‹åˆ¥æ­£ç¢ºï¼‰
Object obj = 'Flutter';
String str = obj as String;  // å¼·åˆ¶è½‰ç‚º String

// å®‰å…¨çš„è½‰å‹ï¼ˆå¦‚æœè½‰å‹å¤±æ•—æœƒå›å‚³ nullï¼‰
String? safeStr = obj as String?;

// æ³›å‹å‹åˆ¥è½‰æ›
List<dynamic> dynamicList = ['apple', 'banana', 'orange'];
List<String> stringList = dynamicList.cast<String>(); // è½‰ç‚º String åˆ—è¡¨

// å¾ JSON è§£æçš„å¯¦éš›ç¯„ä¾‹
Map<String, dynamic> jsonData = {
  'name': 'å¼µå°æ˜',
  'age': 25,
  'isActive': true,
  'scores': [85, 92, 78],
  'profile': {
    'email': 'ming@example.com',
    'phone': '0912-345-678'
  }
};

class JsonParser {
  static String getString(Map<String, dynamic> json, String key, [String defaultValue = '']) {
    final value = json[key];
    return value is String ? value : defaultValue;
  }
  
  static int getInt(Map<String, dynamic> json, String key, [int defaultValue = 0]) {
    final value = json[key];
    if (value is int) return value;
    if (value is double) return value.toInt();
    if (value is String) return int.tryParse(value) ?? defaultValue;
    return defaultValue;
  }
  
  static bool getBool(Map<String, dynamic> json, String key, [bool defaultValue = false]) {
    final value = json[key];
    return value is bool ? value : defaultValue;
  }
  
  static List<T> getList<T>(Map<String, dynamic> json, String key) {
    final value = json[key];
    if (value is List) {
      return value.cast<T>();
    }
    return <T>[];
  }
}

// ä½¿ç”¨ç¯„ä¾‹
void parseUserData() {
  String name = JsonParser.getString(jsonData, 'name');
  int age = JsonParser.getInt(jsonData, 'age');
  bool isActive = JsonParser.getBool(jsonData, 'isActive');
  List<int> scores = JsonParser.getList<int>(jsonData, 'scores');
  
  print('å§“åï¼š$name');
  print('å¹´é½¡ï¼š$age');
  print('ç‹€æ…‹ï¼š${isActive ? "æ´»èº" : "éæ´»èº"}');
  print('æˆç¸¾ï¼š$scores');
}
```

------

## ğŸ¯ å‡½æ•¸åƒæ•¸å‹åˆ¥

### 1. **å¿…è¦åƒæ•¸ï¼ˆRequired Parametersï¼‰**

```dart
// ä½ç½®åƒæ•¸ï¼ˆé †åºå¾ˆé‡è¦ï¼‰
String createFullName(String firstName, String lastName) {
  return '$firstName $lastName';
}

int add(int a, int b) {
  return a + b;
}

// ä½¿ç”¨æ–¹å¼
String name = createFullName('John', 'Doe');  // å¿…é ˆæŒ‰é †åºå‚³å…¥
int sum = add(10, 20);                        // ç¬¬ä¸€å€‹åƒæ•¸æ˜¯ aï¼Œç¬¬äºŒå€‹æ˜¯ b

// å…·åå¿…è¦åƒæ•¸ï¼ˆä½¿ç”¨ required é—œéµå­—ï¼‰
Widget createButton({
  required String text,           // å¿…é ˆæä¾›
  required VoidCallback onPressed, // å¿…é ˆæä¾›
  required Color backgroundColor,  // å¿…é ˆæä¾›
}) {
  return ElevatedButton(
    onPressed: onPressed,
    style: ElevatedButton.styleFrom(primary: backgroundColor),
    child: Text(text),
  );
}

// ä½¿ç”¨å…·åå¿…è¦åƒæ•¸
Widget button = createButton(
  text: 'é»æ“Šæˆ‘',
  onPressed: () => print('æŒ‰éˆ•è¢«é»æ“Š'),
  backgroundColor: Colors.blue,
);
```

### 2. **å¯é¸åƒæ•¸ï¼ˆOptional Parametersï¼‰**

```dart
// ä½ç½®å¯é¸åƒæ•¸ï¼ˆç”¨ [] åŒ…åœï¼‰
String greetUser(String name, [String? title, int age = 0]) {
  String greeting = 'ä½ å¥½';
  if (title != null) {
    greeting += ' $title';
  }
  greeting += ' $name';
  if (age > 0) {
    greeting += 'ï¼Œæ‚¨ä»Šå¹´ $age æ­²';
  }
  return greeting;
}

// ä½¿ç”¨æ–¹å¼
String msg1 = greetUser('å°æ˜');                    // ä½ å¥½ å°æ˜
String msg2 = greetUser('å°æ˜', 'å…ˆç”Ÿ');             // ä½ å¥½ å…ˆç”Ÿ å°æ˜
String msg3 = greetUser('å°æ˜', 'å…ˆç”Ÿ', 25);         // ä½ å¥½ å…ˆç”Ÿ å°æ˜ï¼Œæ‚¨ä»Šå¹´ 25 æ­²
String msg4 = greetUser('å°æ˜', null, 30);         // ä½ å¥½ å°æ˜ï¼Œæ‚¨ä»Šå¹´ 30 æ­²

// å…·åå¯é¸åƒæ•¸ï¼ˆç”¨ {} åŒ…åœï¼‰
Widget createCard({
  required String title,           // å¿…è¦åƒæ•¸
  String? subtitle,               // å¯é¸åƒæ•¸
  Color backgroundColor = Colors.white, // æœ‰é è¨­å€¼çš„å¯é¸åƒæ•¸
  double elevation = 2.0,         // æœ‰é è¨­å€¼çš„å¯é¸åƒæ•¸
  bool isEnabled = true,          // æœ‰é è¨­å€¼çš„å¯é¸åƒæ•¸
  VoidCallback? onTap,           // å¯é¸åƒæ•¸
}) {
  return Card(
    color: backgroundColor,
    elevation: elevation,
    child: InkWell(
      onTap: isEnabled ? onTap : null,
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              title,
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
                color: isEnabled ? Colors.black : Colors.grey,
              ),
            ),
            if (subtitle != null) ...[
              SizedBox(height: 8),
              Text(
                subtitle,
                style: TextStyle(
                  fontSize: 14,
                  color: isEnabled ? Colors.grey[600] : Colors.grey[400],
                ),
              ),
            ],
          ],
        ),
      ),
    ),
  );
}

// ä½¿ç”¨å…·åå¯é¸åƒæ•¸ï¼ˆå¯ä»¥ä»»æ„é †åºï¼‰
Widget card1 = createCard(title: 'åŸºæœ¬å¡ç‰‡');

Widget card2 = createCard(
  title: 'é€²éšå¡ç‰‡',
  subtitle: 'é€™æ˜¯å‰¯æ¨™é¡Œ',
  backgroundColor: Colors.blue[50],
  elevation: 4.0,
);

Widget card3 = createCard(
  title: 'äº’å‹•å¡ç‰‡',
  onTap: () => print('å¡ç‰‡è¢«é»æ“Š'),
  isEnabled: true,
  backgroundColor: Colors.green[100],
);
```

### 3. **å‡½æ•¸å‹åˆ¥åƒæ•¸**

```dart
// å‡½æ•¸ä½œç‚ºåƒæ•¸
void executeOperation(int a, int b, int Function(int, int) operation) {
  int result = operation(a, b);
  print('é‹ç®—çµæœï¼š$result');
}

// å®šç¾©ä¸åŒçš„é‹ç®—å‡½æ•¸
int add(int a, int b) => a + b;
int multiply(int a, int b) => a * b;
int subtract(int a, int b) => a - b;

// ä½¿ç”¨å‡½æ•¸åƒæ•¸
void performCalculations() {
  executeOperation(10, 5, add);       // é‹ç®—çµæœï¼š15
  executeOperation(10, 5, multiply);  // é‹ç®—çµæœï¼š50
  executeOperation(10, 5, subtract); // é‹ç®—çµæœï¼š5
  
  // ä½¿ç”¨åŒ¿åå‡½æ•¸
  executeOperation(10, 5, (a, b) => a ~/ b); // é‹ç®—çµæœï¼š2ï¼ˆæ•´æ•¸é™¤æ³•ï¼‰
}

// æ›´è¤‡é›œçš„å‡½æ•¸å‹åˆ¥åƒæ•¸ç¯„ä¾‹
class ListProcessor {
  // è™•ç†å­—ä¸²åˆ—è¡¨çš„é€šç”¨æ–¹æ³•
  static List<String> processStringList(
    List<String> items,
    String Function(String) processor, // è™•ç†å–®å€‹é …ç›®çš„å‡½æ•¸
  ) {
    return items.map(processor).toList();
  }
  
  // éæ¿¾åˆ—è¡¨çš„é€šç”¨æ–¹æ³•
  static List<T> filterList<T>(
    List<T> items,
    bool Function(T) predicate, // åˆ¤æ–·æ¢ä»¶çš„å‡½æ•¸
  ) {
    return items.where(predicate).toList();
  }
  
  // æ­¸ç´„åˆ—è¡¨çš„é€šç”¨æ–¹æ³•
  static T reduceList<T>(
    List<T> items,
    T Function(T previous, T current) combiner, // åˆä½µå‡½æ•¸
  ) {
    return items.reduce(combiner);
  }
}

// ä½¿ç”¨å‡½æ•¸å‹åˆ¥åƒæ•¸çš„å¯¦éš›ç¯„ä¾‹
void demonstrateFunctionParameters() {
  List<String> names = ['john doe', 'jane smith', 'bob johnson'];
  
  // ä½¿ç”¨ä¸åŒçš„è™•ç†å‡½æ•¸
  List<String> upperNames = ListProcessor.processStringList(
    names,
    (name) => name.toUpperCase(), // è½‰å¤§å¯«
  );
  
  List<String> capitalizedNames = ListProcessor.processStringList(
    names,
    (name) => name.split(' ').map((word) => 
        word[0].toUpperCase() + word.substring(1)).join(' '), // é¦–å­—æ¯å¤§å¯«
  );
  
  // éæ¿¾é•·åº¦å¤§æ–¼ 8 çš„åå­—
  List<String> longNames = ListProcessor.filterList(
    names,
    (name) => name.length > 8,
  );
  
  print('åŸå§‹ï¼š$names');
  print('å¤§å¯«ï¼š$upperNames');
  print('é¦–å­—æ¯å¤§å¯«ï¼š$capitalizedNames');
  print('é•·åå­—ï¼š$longNames');
}

// Widget å›èª¿å‡½æ•¸çš„å¯¦éš›æ‡‰ç”¨
class CustomButton extends StatelessWidget {
  final String text;
  final VoidCallback? onPressed;           // ç„¡åƒæ•¸ç„¡å›å‚³å€¼
  final ValueChanged<String>? onTextChanged; // æœ‰åƒæ•¸ç„¡å›å‚³å€¼
  final String Function()? getButtonText;   // ç„¡åƒæ•¸æœ‰å›å‚³å€¼
  final bool Function(String)? validator;   // æœ‰åƒæ•¸æœ‰å›å‚³å€¼
  
  const CustomButton({
    Key? key,
    required this.text,
    this.onPressed,
    this.onTextChanged,
    this.getButtonText,
    this.validator,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    String displayText = getButtonText?.call() ?? text;
    bool isValid = validator?.call(displayText) ?? true;
    
    return ElevatedButton(
      onPressed: isValid ? () {
        onPressed?.call();
        onTextChanged?.call(displayText);
      } : null,
      child: Text(displayText),
      style: ElevatedButton.styleFrom(
        primary: isValid ? Colors.blue : Colors.grey,
      ),
    );
  }
}

// ä½¿ç”¨è‡ªè¨‚æŒ‰éˆ•
class ButtonDemo extends StatefulWidget {
  @override
  _ButtonDemoState createState() => _ButtonDemoState();
}

class _ButtonDemoState extends State<ButtonDemo> {
  String currentText = 'é»æ“Šæˆ‘';
  int clickCount = 0;
  
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        CustomButton(
          text: 'åŸºæœ¬æŒ‰éˆ•',
          onPressed: () {
            print('åŸºæœ¬æŒ‰éˆ•è¢«é»æ“Š');
          },
        ),
        
        SizedBox(height: 16),
        
        CustomButton(
          text: 'å‹•æ…‹æŒ‰éˆ•',
          getButtonText: () => 'é»æ“Šæ¬¡æ•¸ï¼š$clickCount',
          onPressed: () {
            setState(() {
              clickCount++;
            });
          },
          onTextChanged: (text) {
            print('æŒ‰éˆ•æ–‡å­—è®Šç‚ºï¼š$text');
          },
        ),
        
        SizedBox(height: 16),
        
        CustomButton(
          text: 'é©—è­‰æŒ‰éˆ•',
          validator: (text) => clickCount > 0, // å¿…é ˆé»æ“Šéæ‰èƒ½ä½¿ç”¨
          onPressed: () {
            print('é©—è­‰æŒ‰éˆ•è¢«é»æ“Š');
          },
        ),
      ],
    );
  }
}
```

------

## ğŸ¨ æ³›å‹å‹åˆ¥ï¼ˆGeneric Typesï¼‰

### 1. **åŸºæœ¬æ³›å‹æ¦‚å¿µ**

```dart
// æ³›å‹é¡åˆ¥
class Box<T> {
  T value;
  
  Box(this.value);
  
  void setValue(T newValue) {
    value = newValue;
  }
  
  T getValue() {
    return value;
  }
  
  // å‹åˆ¥å®‰å…¨çš„æ¯”è¼ƒ
  bool isEqual(Box<T> other) {
    return value == other.value;
  }
}

// ä½¿ç”¨æ³›å‹é¡åˆ¥
void demonstrateGenerics() {
  // å­—ä¸²ç›’å­
  Box<String> stringBox = Box<String>('Hello');
  stringBox.setValue('World');
  String stringValue = stringBox.getValue(); // å‹åˆ¥å®‰å…¨ï¼Œä¸éœ€è¦è½‰å‹
  
  // æ•´æ•¸ç›’å­
  Box<int> intBox = Box<int>(42);
  intBox.setValue(100);
  int intValue = intBox.getValue();
  
  // è‡ªè¨‚ç‰©ä»¶ç›’å­
  Box<DateTime> dateBox = Box<DateTime>(DateTime.now());
  DateTime currentDate = dateBox.getValue();
  
  print('å­—ä¸²å€¼ï¼š$stringValue');
  print('æ•´æ•¸å€¼ï¼š$intValue');
  print('æ—¥æœŸå€¼ï¼š$currentDate');
}

// æ³›å‹å‡½æ•¸
T getFirst<T>(List<T> items) {
  if (items.isEmpty) {
    throw ArgumentError('åˆ—è¡¨ä¸èƒ½ç‚ºç©º');
  }
  return items.first;
}

List<T> createFilledList<T>(T value, int length) {
  return List.filled(length, value);
}

Map<K, V> createMap<K, V>(List<K> keys, List<V> values) {
  if (keys.length != values.length) {
    throw ArgumentError('éµå€¼åˆ—è¡¨é•·åº¦å¿…é ˆç›¸åŒ');
  }
  
  Map<K, V> result = {};
  for (int i = 0; i < keys.length; i++) {
    result[keys[i]] = values[i];
  }
  return result;
}

// ä½¿ç”¨æ³›å‹å‡½æ•¸
void useGenericFunctions() {
  // å–å¾—ç¬¬ä¸€å€‹å…ƒç´ 
  String firstFruit = getFirst<String>(['è˜‹æœ', 'é¦™è•‰', 'æ©˜å­']);
  int firstNumber = getFirst<int>([1, 2, 3, 4, 5]);
  
  // å‰µå»ºå¡«å……åˆ—è¡¨
  List<bool> boolList = createFilledList<bool>(true, 5); // [true, true, true, true, true]
  List<String> stringList = createFilledList<String>('Hello', 3); // ['Hello', 'Hello', 'Hello']
  
  // å‰µå»ºå°æ˜ 
  Map<String, int> scoreMap = createMap<String, int>(
    ['Alice', 'Bob', 'Charlie'],
    [95, 87, 92]
  );
  
  print('ç¬¬ä¸€å€‹æ°´æœï¼š$firstFruit');
  print('ç¬¬ä¸€å€‹æ•¸å­—ï¼š$firstNumber');
  print('å¸ƒæ—åˆ—è¡¨ï¼š$boolList');
  print('æˆç¸¾å°æ˜ ï¼š$scoreMap');
}
```

### 2. **ç´„æŸæ³›å‹ï¼ˆBounded Genericsï¼‰**

```dart
// ç´„æŸæ³›å‹å¿…é ˆç¹¼æ‰¿æŸå€‹é¡åˆ¥
abstract class Animal {
  String get name;
  void makeSound();
}

class Dog extends Animal {
  @override
  String get name => 'Dog';
  
  @override
  void makeSound() {
    print('Woof!');
  }
}

class Cat extends Animal {
  @override
  String get name => 'Cat';
  
  @override
  void makeSound() {
    print('Meow!');
  }
}

// åªæ¥å— Animal åŠå…¶å­é¡çš„æ³›å‹
class AnimalShelter<T extends Animal> {
  List<T> animals = [];
  
  void addAnimal(T animal) {
    animals.add(animal);
    print('${animal.name} å·²åŠ å…¥æ”¶å®¹æ‰€');
  }
  
  void makeAllSounds() {
    for (T animal in animals) {
      animal.makeSound(); // å¯ä»¥å®‰å…¨èª¿ç”¨ Animal çš„æ–¹æ³•
    }
  }
  
  List<T> getAllAnimals() {
    return List.from(animals);
  }
}

// ä½¿ç”¨ç´„æŸæ³›å‹
void demonstrateBoundedGenerics() {
  AnimalShelter<Dog> dogShelter = AnimalShelter<Dog>();
  dogShelter.addAnimal(Dog());
  dogShelter.addAnimal(Dog());
  
  AnimalShelter<Cat> catShelter = AnimalShelter<Cat>();
  catShelter.addAnimal(Cat());
  
  print('ç‹—æ”¶å®¹æ‰€çš„è²éŸ³ï¼š');
  dogShelter.makeAllSounds();
  
  print('è²“æ”¶å®¹æ‰€çš„è²éŸ³ï¼š');
  catShelter.makeAllSounds();
}

// æ•¸å€¼ç´„æŸçš„æ³›å‹
class Calculator<T extends num> {
  T add(T a, T b) {
    return (a + b) as T;
  }
  
  T multiply(T a, T b) {
    return (a * b) as T;
  }
  
  double divide(T a, T b) {
    return a / b;
  }
  
  bool isPositive(T value) {
    return value > 0;
  }
}

// ä½¿ç”¨æ•¸å€¼ç´„æŸæ³›å‹
void useNumericGenerics() {
  Calculator<int> intCalc = Calculator<int>();
  int sum = intCalc.add(10, 20);           // 30
  int product = intCalc.multiply(5, 6);    // 30
  double quotient = intCalc.divide(15, 3); // 5.0
  
  Calculator<double> doubleCalc = Calculator<double>();
  double decimalSum = doubleCalc.add(3.14, 2.86);      // 6.0
  double decimalProduct = doubleCalc.multiply(2.5, 4.0); // 10.0
  
  print('æ•´æ•¸è¨ˆç®—ï¼š$sum, $product, $quotient');
  print('æµ®é»æ•¸è¨ˆç®—ï¼š$decimalSum, $decimalProduct');
}
```

### 3. **æ³›å‹åœ¨ Flutter ä¸­çš„å¯¦éš›æ‡‰ç”¨**

```dart
// æ³›å‹ Widget
class GenericListWidget<T> extends StatelessWidget {
  final List<T> items;
  final Widget Function(T item, int index) itemBuilder;
  final String Function(T item)? getDisplayText;
  final void Function(T item)? onItemTap;
  
  const GenericListWidget({
    Key? key,
    required this.items,
    required this.itemBuilder,
    this.getDisplayText,
    this.onItemTap,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: items.length,
      itemBuilder: (context, index) {
        final item = items[index];
        return InkWell(
          onTap: onItemTap != null ? () => onItemTap!(item) : null,
          child: itemBuilder(item, index),
        );
      },
    );
  }
}

// è³‡æ–™æ¨¡å‹é¡åˆ¥
class Product {
  final String name;
  final double price;
  final String category;
  
  Product({required this.name, required this.price, required this.category});
  
  @override
  String toString() => '$name - \${price.toStringAsFixed(2)}';
}

class User {
  final String name;
  final String email;
  final int age;
  
  User({required this.name, required this.email, required this.age});
  
  @override
  String toString() => '$name ($email) - $age æ­²';
}

// ä½¿ç”¨æ³›å‹ Widget
class GenericListDemo extends StatelessWidget {
  final List<Product> products = [
    Product(name: 'iPhone 15', price: 30900, category: 'æ‰‹æ©Ÿ'),
    Product(name: 'iPad Air', price: 19900, category: 'å¹³æ¿'),
    Product(name: 'MacBook Pro', price: 65900, category: 'ç­†é›»'),
  ];
  
  final List<User> users = [
    User(name: 'å¼µå°æ˜', email: 'ming@example.com', age: 25),
    User(name: 'æå°è¯', email: 'hua@example.com', age: 30),
    User(name: 'ç‹å°ç¾', email: 'mei@example.com', age: 28),
  ];
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('æ³›å‹åˆ—è¡¨ç¤ºä¾‹')),
      body: Column(
        children: [
          // ç”¢å“åˆ—è¡¨
          Expanded(
            child: GenericListWidget<Product>(
              items: products,
              itemBuilder: (product, index) {
                return Card(
                  child: ListTile(
                    leading: Icon(Icons.shopping_bag),
                    title: Text(product.name),
                    subtitle: Text('${product.category} - \${product.price}'),
                    trailing: Icon(Icons.arrow_forward_ios),
                  ),
                );
              },
              onItemTap: (product) {
                print('é¸æ“‡äº†ç”¢å“ï¼š${product.name}');
              },
            ),
          ),
          
          Divider(),
          
          // ä½¿ç”¨è€…åˆ—è¡¨
          Expanded(
            child: GenericListWidget<User>(
              items: users,
              itemBuilder: (user, index) {
                return Card(
                  child: ListTile(
                    leading: CircleAvatar(child: Text(user.name[0])),
                    title: Text(user.name),
                    subtitle: Text('${user.email} - ${user.age} æ­²'),
                    trailing: Icon(Icons.person),
                  ),
                );
              },
              onItemTap: (user) {
                print('é¸æ“‡äº†ä½¿ç”¨è€…ï¼š${user.name}');
              },
            ),
          ),
        ],
      ),
    );
  }
}

// æ³›å‹ç‹€æ…‹ç®¡ç†
class GenericStateManager<T> {
  T _state;
  final List<void Function(T)> _listeners = [];
  
  GenericStateManager(this._state);
  
  T get state => _state;
  
  void setState(T newState) {
    _state = newState;
    _notifyListeners();
  }
  
  void addListener(void Function(T) listener) {
    _listeners.add(listener);
  }
  
  void removeListener(void Function(T) listener) {
    _listeners.remove(listener);
  }
  
  void _notifyListeners() {
    for (final listener in _listeners) {
      listener(_state);
    }
  }
  
  void dispose() {
    _listeners.clear();
  }
}

// ä½¿ç”¨æ³›å‹ç‹€æ…‹ç®¡ç†
class CounterState {
  final int count;
  final bool isLoading;
  
  CounterState({required this.count, required this.isLoading});
  
  CounterState copyWith({int? count, bool? isLoading}) {
    return CounterState(
      count: count ?? this.count,
      isLoading: isLoading ?? this.isLoading,
    );
  }
}

class GenericStateDemo extends StatefulWidget {
  @override
  _GenericStateDemoState createState() => _GenericStateDemoState();
}

class _GenericStateDemoState extends State<GenericStateDemo> {
  late GenericStateManager<CounterState> stateManager;
  
  @override
  void initState() {
    super.initState();
    stateManager = GenericStateManager<CounterState>(
      CounterState(count: 0, isLoading: false)
    );
    
    stateManager.addListener((state) {
      setState(() {
        // è§¸ç™¼ Widget é‡å»º
      });
    });
  }
  
  @override
  void dispose() {
    stateManager.dispose();
    super.dispose();
  }
  
  void _incrementCounter() {
    final currentState = stateManager.state;
    stateManager.setState(
      currentState.copyWith(count: currentState.count + 1)
    );
  }
  
  void _resetCounter() {
    stateManager.setState(
      CounterState(count: 0, isLoading: false)
    );
  }
  
  @override
  Widget build(BuildContext context) {
    final state = stateManager.state;
    
    return Scaffold(
      appBar: AppBar(title: Text('æ³›å‹ç‹€æ…‹ç®¡ç†')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Text(
              'è¨ˆæ•¸å™¨å€¼ï¼š${state.count}',
              style: TextStyle(fontSize: 24),
            ),
            SizedBox(height: 20),
            if (state.isLoading)
              CircularProgressIndicator()
            else
              Row(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  ElevatedButton(
                    onPressed: _incrementCounter,
                    child: Text('å¢åŠ '),
                  ),
                  SizedBox(width: 16),
                  ElevatedButton(
                    onPressed: _resetCounter,
                    child: Text('é‡è¨­'),
                  ),
                ],
              ),
          ],
        ),
      ),
    );
  }
}
```

------

## ğŸ¯ å¯¦éš›é–‹ç™¼æ‡‰ç”¨ç¯„ä¾‹

### 1. **è¡¨å–®é©—è­‰ç³»çµ±**

```dart
// é©—è­‰å™¨é¡å‹å®šç¾©
typedef Validator<T> = String? Function(T? value);

class FormValidators {
  // å­—ä¸²é©—è­‰å™¨
  static Validator<String> required([String message = 'æ­¤æ¬„ä½ç‚ºå¿…å¡«']) {
    return (String? value) {
      if (value == null || value.trim().isEmpty) {
        return message;
      }
      return null;
    };
  }
  
  static Validator<String> minLength(int minLength, [String? message]) {
    return (String? value) {
      if (value != null && value.length < minLength) {
        return message ?? 'é•·åº¦ä¸èƒ½å°‘æ–¼ $minLength å€‹å­—å…ƒ';
      }
      return null;
    };
  }
  
  static Validator<String> maxLength(int maxLength, [String? message]) {
    return (String? value) {
      if (value != null && value.length > maxLength) {
        return message ?? 'é•·åº¦ä¸èƒ½è¶…é $maxLength å€‹å­—å…ƒ';
      }
      return null;
    };
  }
  
  static Validator<String> email([String message = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶åœ°å€']) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        final emailRegex = RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4});
        if (!emailRegex.hasMatch(value)) {
          return message;
        }
      }
      return null;
    };
  }
  
  static Validator<String> phone([String message = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„æ‰‹æ©Ÿè™Ÿç¢¼']) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        final phoneRegex = RegExp(r'^09\d{8});
        if (!phoneRegex.hasMatch(value)) {
          return message;
        }
      }
      return null;
    };
  }
  
  // æ•¸å­—é©—è­‰å™¨
  static Validator<String> numeric([String message = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—']) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        if (double.tryParse(value) == null) {
          return message;
        }
      }
      return null;
    };
  }
  
  static Validator<String> range(double min, double max, [String? message]) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        final number = double.tryParse(value);
        if (number == null) {
          return 'è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—';
        }
        if (number < min || number > max) {
          return message ?? 'æ•¸å€¼å¿…é ˆåœ¨ $min åˆ° $max ä¹‹é–“';
        }
      }
      return null;
    };
  }
  
  // çµ„åˆé©—è­‰å™¨
  static Validator<String> combine(List<Validator<String>> validators) {
    return (String? value) {
      for (final validator in validators) {
        final error = validator(value);
        if (error != null) {
          return error; // å›å‚³ç¬¬ä¸€å€‹éŒ¯èª¤
        }
      }
      return null;
    };
  }
}

// ä½¿ç”¨è¡¨å–®é©—è­‰çš„å¯¦éš›ç¯„ä¾‹
class UserRegistrationForm extends StatefulWidget {
  @override
  _UserRegistrationFormState createState() => _UserRegistrationFormState();
}

class _UserRegistrationFormState extends State<UserRegistrationForm> {
  final _formKey = GlobalKey<FormState>();
  final _nameController = TextEditingController();
  final _emailController = TextEditingController();
  final _phoneController = TextEditingController();
  final _passwordController = TextEditingController();
  final _confirmPasswordController = TextEditingController();
  final _ageController = TextEditingController();
  
  @override
  void dispose() {
    _nameController.dispose();
    _emailController.dispose();
    _phoneController.dispose();
    _passwordController.dispose();
    _confirmPasswordController.dispose();
    _ageController.dispose();
    super.dispose();
  }
  
  void _submitForm() {
    if (_formKey.currentState!.validate()) {
      // è¡¨å–®é©—è­‰é€šéï¼Œè™•ç†æäº¤é‚è¼¯
      final userData = {
        'name': _nameController.text,
        'email': _emailController.text,
        'phone': _phoneController.text,
        'age': int.parse(_ageController.text),
      };
      
      print('ä½¿ç”¨è€…è¨»å†Šè³‡æ–™ï¼š$userData');
      
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('è¨»å†ŠæˆåŠŸï¼')),
      );
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('ä½¿ç”¨è€…è¨»å†Š')),
      body: Padding(
        padding: EdgeInsets.all(16),
        child: Form(
          key: _formKey,
          child: SingleChildScrollView(
            child: Column(
              children: [
                // å§“åè¼¸å…¥
                TextFormField(
                  controller: _nameController,
                  decoration: InputDecoration(
                    labelText: 'å§“å',
                    prefixIcon: Icon(Icons.person),
                    border: OutlineInputBorder(),
                  ),
                  validator: FormValidators.combine([
                    FormValidators.required('è«‹è¼¸å…¥å§“å'),
                    FormValidators.minLength(2, 'å§“åè‡³å°‘éœ€è¦ 2 å€‹å­—å…ƒ'),
                    FormValidators.maxLength(20, 'å§“åä¸èƒ½è¶…é 20 å€‹å­—å…ƒ'),
                  ]),
                ),
                
                SizedBox(height: 16),
                
                // å¯†ç¢¼è¼¸å…¥
                TextFormField(
                  controller: _passwordController,
                  obscureText: true,
                  decoration: InputDecoration(
                    labelText: 'å¯†ç¢¼',
                    prefixIcon: Icon(Icons.lock),
                    border: OutlineInputBorder(),
                  ),
                  validator: FormValidators.combine([
                    FormValidators.required('è«‹è¼¸å…¥å¯†ç¢¼'),
                    FormValidators.minLength(8, 'å¯†ç¢¼è‡³å°‘éœ€è¦ 8 å€‹å­—å…ƒ'),
                  ]),
                ),
                
                SizedBox(height: 16),
                
                // ç¢ºèªå¯†ç¢¼è¼¸å…¥
                TextFormField(
                  controller: _confirmPasswordController,
                  obscureText: true,
                  decoration: InputDecoration(
                    labelText: 'ç¢ºèªå¯†ç¢¼',
                    prefixIcon: Icon(Icons.lock_outline),
                    border: OutlineInputBorder(),
                  ),
                  validator: (value) {
                    if (value == null || value.isEmpty) {
                      return 'è«‹ç¢ºèªå¯†ç¢¼';
                    }
                    if (value != _passwordController.text) {
                      return 'å¯†ç¢¼ä¸ä¸€è‡´';
                    }
                    return null;
                  },
                ),
                
                SizedBox(height: 32),
                
                // æäº¤æŒ‰éˆ•
                SizedBox(
                  width: double.infinity,
                  height: 50,
                  child: ElevatedButton(
                    onPressed: _submitForm,
                    child: Text(
                      'è¨»å†Š',
                      style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                    ),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}
```

### 2. **HTTP è«‹æ±‚èˆ‡éŸ¿æ‡‰è™•ç†**

```dart
import 'dart:convert';
import 'package:http/http.dart' as http;

// éŸ¿æ‡‰åŒ…è£é¡
class ApiResponse<T> {
  final bool success;
  final T? data;
  final String? error;
  final int statusCode;
  
  ApiResponse({
    required this.success,
    this.data,
    this.error,
    required this.statusCode,
  });
  
  factory ApiResponse.success(T data, int statusCode) {
    return ApiResponse<T>(
      success: true,
      data: data,
      statusCode: statusCode,
    );
  }
  
  factory ApiResponse.failure(String error, int statusCode) {
    return ApiResponse<T>(
      success: false,
      error: error,
      statusCode: statusCode,
    );
  }
}

// HTTP æœå‹™é¡
class ApiService {
  static const String baseUrl = 'https://jsonplaceholder.typicode.com';
  static const Duration timeout = Duration(seconds: 30);
  
  // GET è«‹æ±‚ - å›å‚³å–®ä¸€ç‰©ä»¶
  static Future<ApiResponse<Map<String, dynamic>>> fetchUser(int userId) async {
    try {
      final response = await http.get(
        Uri.parse('$baseUrl/users/$userId'),
        headers: {'Content-Type': 'application/json'},
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        final Map<String, dynamic> userData = json.decode(response.body);
        return ApiResponse.success(userData, response.statusCode);
      } else {
        return ApiResponse.failure(
          'ç„¡æ³•å–å¾—ä½¿ç”¨è€…è³‡æ–™ï¼š${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        'ç¶²è·¯éŒ¯èª¤ï¼š$error',
        0,
      );
    }
  }
  
  // GET è«‹æ±‚ - å›å‚³é™£åˆ—
  static Future<ApiResponse<List<Map<String, dynamic>>>> fetchUsers() async {
    try {
      final response = await http.get(
        Uri.parse('$baseUrl/users'),
        headers: {'Content-Type': 'application/json'},
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        final List<dynamic> jsonList = json.decode(response.body);
        final List<Map<String, dynamic>> users = 
            jsonList.cast<Map<String, dynamic>>();
        return ApiResponse.success(users, response.statusCode);
      } else {
        return ApiResponse.failure(
          'ç„¡æ³•å–å¾—ä½¿ç”¨è€…åˆ—è¡¨ï¼š${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        'ç¶²è·¯éŒ¯èª¤ï¼š$error',
        0,
      );
    }
  }
  
  // POST è«‹æ±‚ - å»ºç«‹è³‡æº
  static Future<ApiResponse<Map<String, dynamic>>> createPost({
    required String title,
    required String body,
    required int userId,
  }) async {
    try {
      final requestBody = {
        'title': title,
        'body': body,
        'userId': userId,
      };
      
      final response = await http.post(
        Uri.parse('$baseUrl/posts'),
        headers: {'Content-Type': 'application/json'},
        body: json.encode(requestBody),
      ).timeout(timeout);
      
      if (response.statusCode == 201) {
        final Map<String, dynamic> createdPost = json.decode(response.body);
        return ApiResponse.success(createdPost, response.statusCode);
      } else {
        return ApiResponse.failure(
          'å»ºç«‹æ–‡ç« å¤±æ•—ï¼š${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        'ç¶²è·¯éŒ¯èª¤ï¼š$error',
        0,
      );
    }
  }
  
  // PUT è«‹æ±‚ - æ›´æ–°è³‡æº
  static Future<ApiResponse<Map<String, dynamic>>> updatePost({
    required int postId,
    required String title,
    required String body,
    required int userId,
  }) async {
    try {
      final requestBody = {
        'id': postId,
        'title': title,
        'body': body,
        'userId': userId,
      };
      
      final response = await http.put(
        Uri.parse('$baseUrl/posts/$postId'),
        headers: {'Content-Type': 'application/json'},
        body: json.encode(requestBody),
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        final Map<String, dynamic> updatedPost = json.decode(response.body);
        return ApiResponse.success(updatedPost, response.statusCode);
      } else {
        return ApiResponse.failure(
          'æ›´æ–°æ–‡ç« å¤±æ•—ï¼š${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        'ç¶²è·¯éŒ¯èª¤ï¼š$error',
        0,
      );
    }
  }
  
  // DELETE è«‹æ±‚ - åˆªé™¤è³‡æº
  static Future<ApiResponse<bool>> deletePost(int postId) async {
    try {
      final response = await http.delete(
        Uri.parse('$baseUrl/posts/$postId'),
        headers: {'Content-Type': 'application/json'},
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        return ApiResponse.success(true, response.statusCode);
      } else {
        return ApiResponse.failure(
          'åˆªé™¤æ–‡ç« å¤±æ•—ï¼š${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        'ç¶²è·¯éŒ¯èª¤ï¼š$error',
        0,
      );
    }
  }
}

// ä½¿ç”¨ API æœå‹™çš„å¯¦éš›ç¯„ä¾‹
class ApiDemoWidget extends StatefulWidget {
  @override
  _ApiDemoWidgetState createState() => _ApiDemoWidgetState();
}

class _ApiDemoWidgetState extends State<ApiDemoWidget> {
  List<Map<String, dynamic>> users = [];
  Map<String, dynamic>? selectedUser;
  bool isLoading = false;
  String? errorMessage;
  
  @override
  void initState() {
    super.initState();
    _loadUsers();
  }
  
  // è¼‰å…¥ä½¿ç”¨è€…åˆ—è¡¨
  Future<void> _loadUsers() async {
    setState(() {
      isLoading = true;
      errorMessage = null;
    });
    
    final response = await ApiService.fetchUsers();
    
    setState(() {
      isLoading = false;
      if (response.success) {
        users = response.data!;
      } else {
        errorMessage = response.error;
      }
    });
  }
  
  // è¼‰å…¥ç‰¹å®šä½¿ç”¨è€…
  Future<void> _loadUser(int userId) async {
    setState(() {
      isLoading = true;
      errorMessage = null;
    });
    
    final response = await ApiService.fetchUser(userId);
    
    setState(() {
      isLoading = false;
      if (response.success) {
        selectedUser = response.data;
      } else {
        errorMessage = response.error;
      }
    });
  }
  
  // å»ºç«‹æ–°æ–‡ç« 
  Future<void> _createPost() async {
    setState(() {
      isLoading = true;
    });
    
    final response = await ApiService.createPost(
      title: 'æ¸¬è©¦æ–‡ç« æ¨™é¡Œ',
      body: 'é€™æ˜¯ä¸€ç¯‡æ¸¬è©¦æ–‡ç« çš„å…§å®¹ã€‚',
      userId: selectedUser?['id'] ?? 1,
    );
    
    setState(() {
      isLoading = false;
    });
    
    if (response.success) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('æ–‡ç« å»ºç«‹æˆåŠŸï¼ID: ${response.data!['id']}')),
      );
    } else {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text('å»ºç«‹å¤±æ•—ï¼š${response.error}'),
          backgroundColor: Colors.red,
        ),
      );
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('API ç¤ºä¾‹'),
        actions: [
          IconButton(
            icon: Icon(Icons.refresh),
            onPressed: _loadUsers,
          ),
        ],
      ),
      body: Column(
        children: [
          // éŒ¯èª¤è¨Šæ¯é¡¯ç¤º
          if (errorMessage != null)
            Container(
              width: double.infinity,
              padding: EdgeInsets.all(16),
              color: Colors.red[100],
              child: Text(
                errorMessage!,
                style: TextStyle(color: Colors.red[800]),
              ),
            ),
          
          // è¼‰å…¥æŒ‡ç¤ºå™¨
          if (isLoading)
            LinearProgressIndicator(),
          
          // é¸ä¸­çš„ä½¿ç”¨è€…è³‡è¨Š
          if (selectedUser != null)
            Card(
              margin: EdgeInsets.all(16),
              child: Padding(
                padding: EdgeInsets.all(16),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      'é¸ä¸­çš„ä½¿ç”¨è€…',
                      style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                    ),
                    SizedBox(height: 8),
                    Text('å§“åï¼š${selectedUser!['name']}'),
                    Text('é›»å­éƒµä»¶ï¼š${selectedUser!['email']}'),
                    Text('é›»è©±ï¼š${selectedUser!['phone']}'),
                    Text('ç¶²ç«™ï¼š${selectedUser!['website']}'),
                    SizedBox(height: 16),
                    ElevatedButton(
                      onPressed: isLoading ? null : _createPost,
                      child: Text('ç‚ºæ­¤ä½¿ç”¨è€…å»ºç«‹æ–‡ç« '),
                    ),
                  ],
                ),
              ),
            ),
          
          // ä½¿ç”¨è€…åˆ—è¡¨
          Expanded(
            child: ListView.builder(
              itemCount: users.length,
              itemBuilder: (context, index) {
                final user = users[index];
                return ListTile(
                  leading: CircleAvatar(
                    child: Text(user['name'][0]),
                  ),
                  title: Text(user['name']),
                  subtitle: Text(user['email']),
                  trailing: Icon(Icons.arrow_forward_ios),
                  onTap: () => _loadUser(user['id']),
                  selected: selectedUser?['id'] == user['id'],
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}
```

### 3. **ç‹€æ…‹ç®¡ç†èˆ‡è³‡æ–™æµ**

```dart
// ç‹€æ…‹ç®¡ç†çš„ä¸åŒæ¨¡å¼

// 1. ç°¡å–®ç‹€æ…‹ï¼ˆbool, int, Stringï¼‰
class SimpleStateExample extends StatefulWidget {
  @override
  _SimpleStateExampleState createState() => _SimpleStateExampleState();
}

class _SimpleStateExampleState extends State<SimpleStateExample> {
  // åŸºæœ¬ç‹€æ…‹è®Šæ•¸
  bool isVisible = true;
  int counter = 0;
  String message = 'Hello Flutter';
  List<String> items = ['é …ç›®1', 'é …ç›®2', 'é …ç›®3'];
  
  // ç‹€æ…‹æ›´æ–°æ–¹æ³•
  void toggleVisibility() {
    setState(() {
      isVisible = !isVisible;
    });
  }
  
  void incrementCounter() {
    setState(() {
      counter++;
    });
  }
  
  void updateMessage(String newMessage) {
    setState(() {
      message = newMessage;
    });
  }
  
  void addItem(String item) {
    setState(() {
      items.add(item);
    });
  }
  
  void removeItem(int index) {
    setState(() {
      items.removeAt(index);
    });
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('ç°¡å–®ç‹€æ…‹ç®¡ç†')),
      body: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.stretch,
          children: [
            // é¡¯ç¤º/éš±è—æ§åˆ¶
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text('é¡¯ç¤ºç‹€æ…‹ï¼š${isVisible ? "é¡¯ç¤º" : "éš±è—"}'),
                Switch(
                  value: isVisible,
                  onChanged: (value) => setState(() => isVisible = value),
                ),
              ],
            ),
            
            SizedBox(height: 16),
            
            // è¨ˆæ•¸å™¨
            if (isVisible) ...[
              Card(
                child: Padding(
                  padding: EdgeInsets.all(16),
                  child: Column(
                    children: [
                      Text(
                        'è¨ˆæ•¸å™¨ï¼š$counter',
                        style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
                      ),
                      SizedBox(height: 16),
                      Row(
                        mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                        children: [
                          ElevatedButton(
                            onPressed: () => setState(() => counter--),
                            child: Icon(Icons.remove),
                          ),
                          ElevatedButton(
                            onPressed: incrementCounter,
                            child: Icon(Icons.add),
                          ),
                          ElevatedButton(
                            onPressed: () => setState(() => counter = 0),
                            child: Text('é‡è¨­'),
                          ),
                        ],
                      ),
                    ],
                  ),
                ),
              ),
              
              SizedBox(height: 16),
              
              // è¨Šæ¯è¼¸å…¥
              TextField(
                onChanged: updateMessage,
                decoration: InputDecoration(
                  labelText: 'è¼¸å…¥è¨Šæ¯',
                  border: OutlineInputBorder(),
                ),
              ),
              
              SizedBox(height: 8),
              
              Text('ç•¶å‰è¨Šæ¯ï¼š$message'),
              
              SizedBox(height: 16),
              
              // å‹•æ…‹åˆ—è¡¨
              Row(
                children: [
                  Expanded(
                    child: TextField(
                      onSubmitted: (value) {
                        if (value.isNotEmpty) {
                          addItem(value);
                        }
                      },
                      decoration: InputDecoration(
                        labelText: 'æ–°å¢é …ç›®',
                        border: OutlineInputBorder(),
                      ),
                    ),
                  ),
                  SizedBox(width: 8),
                  ElevatedButton(
                    onPressed: () => addItem('é …ç›®${items.length + 1}'),
                    child: Icon(Icons.add),
                  ),
                ],
              ),
              
              SizedBox(height: 16),
            ],
            
            // é …ç›®åˆ—è¡¨
            Expanded(
              child: ListView.builder(
                itemCount: items.length,
                itemBuilder: (context, index) {
                  return Card(
                    child: ListTile(
                      title: Text(items[index]),
                      trailing: IconButton(
                        icon: Icon(Icons.delete, color: Colors.red),
                        onPressed: () => removeItem(index),
                      ),
                    ),
                  );
                },
              ),
            ),
          ],
        ),
      ),
    );
  }
}

// 2. è¤‡é›œç‹€æ…‹ç‰©ä»¶
class AppState {
  final bool isLoading;
  final String? error;
  final List<Map<String, dynamic>> users;
  final Map<String, dynamic>? selectedUser;
  final Map<String, dynamic> settings;
  
  AppState({
    this.isLoading = false,
    this.error,
    this.users = const [],
    this.selectedUser,
    this.settings = const {},
  });
  
  // å»ºç«‹æ–°ç‹€æ…‹çš„ä¾¿åˆ©æ–¹æ³•
  AppState copyWith({
    bool? isLoading,
    String? error,
    List<Map<String, dynamic>>? users,
    Map<String, dynamic>? selectedUser,
    Map<String, dynamic>? settings,
  }) {
    return AppState(
      isLoading: isLoading ?? this.isLoading,
      error: error ?? this.error,
      users: users ?? this.users,
      selectedUser: selectedUser ?? this.selectedUser,
      settings: settings ?? this.settings,
    );
  }
  
  // æ¸…é™¤éŒ¯èª¤
  AppState clearError() {
    return copyWith(error: null);
  }
  
  // è¨­å®šè¼‰å…¥ç‹€æ…‹
  AppState setLoading(bool loading) {
    return copyWith(isLoading: loading, error: null);
  }
  
  // è¨­å®šéŒ¯èª¤
  AppState setError(String errorMessage) {
    return copyWith(isLoading: false, error: errorMessage);
  }
  
  // è¨­å®šä½¿ç”¨è€…åˆ—è¡¨
  AppState setUsers(List<Map<String, dynamic>> userList) {
    return copyWith(isLoading: false, users: userList, error: null);
  }
  
  // é¸æ“‡ä½¿ç”¨è€…
  AppState selectUser(Map<String, dynamic> user) {
    return copyWith(selectedUser: user);
  }
  
  // æ›´æ–°è¨­å®š
  AppState updateSettings(Map<String, dynamic> newSettings) {
    final updatedSettings = Map<String, dynamic>.from(settings);
    updatedSettings.addAll(newSettings);
    return copyWith(settings: updatedSettings);
  }
}

// ä½¿ç”¨è¤‡é›œç‹€æ…‹ç‰©ä»¶çš„ Widget
class ComplexStateExample extends StatefulWidget {
  @override
  _ComplexStateExampleState createState() => _ComplexStateExampleState();
}

class _ComplexStateExampleState extends State<ComplexStateExample> {
  AppState _state = AppState(
    settings: {
      'theme': 'light',
      'language': 'zh_TW',
      'notifications': true,
    },
  );
  
  // æ›´æ–°ç‹€æ…‹çš„çµ±ä¸€æ–¹æ³•
  void _updateState(AppState newState) {
    setState(() {
      _state = newState;
    });
  }
  
  // è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™
  Future<void> _loadUsers() async {
    _updateState(_state.setLoading(true));
    
    try {
      // æ¨¡æ“¬ API å‘¼å«
      await Future.delayed(Duration(seconds: 2));
      
      // æ¨¡æ“¬è³‡æ–™
      final users = [
        {'id': 1, 'name': 'å¼µå°æ˜', 'email': 'ming@example.com'},
        {'id': 2, 'name': 'æå°è¯', 'email': 'hua@example.com'},
        {'id': 3, 'name': 'ç‹å°ç¾', 'email': 'mei@example.com'},
      ];
      
      _updateState(_state.setUsers(users));
    } catch (error) {
      _updateState(_state.setError('è¼‰å…¥ä½¿ç”¨è€…å¤±æ•—ï¼š$error'));
    }
  }
  
  // é¸æ“‡ä½¿ç”¨è€…
  void _selectUser(Map<String, dynamic> user) {
    _updateState(_state.selectUser(user));
  }
  
  // æ›´æ–°è¨­å®š
  void _updateSetting(String key, dynamic value) {
    _updateState(_state.updateSettings({key: value}));
  }
  
  // æ¸…é™¤éŒ¯èª¤
  void _clearError() {
    _updateState(_state.clearError());
  }
  
  @override
  void initState() {
    super.initState();
    _loadUsers();
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('è¤‡é›œç‹€æ…‹ç®¡ç†'),
        actions: [
          IconButton(
            icon: Icon(Icons.refresh),
            onPressed: _loadUsers,
          ),
        ],
      ),
      body: Column(
        children: [
          // éŒ¯èª¤é¡¯ç¤º
          if (_state.error != null)
            Container(
              width: double.infinity,
              padding: EdgeInsets.all(16),
              color: Colors.red[100],
              child: Row(
                children: [
                  Expanded(
                    child: Text(
                      _state.error!,
                      style: TextStyle(color: Colors.red[800]),
                    ),
                  ),
                  IconButton(
                    icon: Icon(Icons.close),
                    onPressed: _clearError,
                  ),
                ],
              ),
            ),
          
          // è¼‰å…¥æŒ‡ç¤ºå™¨
          if (_state.isLoading)
            LinearProgressIndicator(),
          
          // è¨­å®šå€åŸŸ
          Card(
            margin: EdgeInsets.all(16),
            child: Padding(
              padding: EdgeInsets.all(16),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    'æ‡‰ç”¨ç¨‹å¼è¨­å®š',
                    style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                  ),
                  SizedBox(height: 16),
                  
                  // ä¸»é¡Œè¨­å®š
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text('ä¸»é¡Œæ¨¡å¼'),
                      DropdownButton<String>(
                        value: _state.settings['theme'],
                        items: [
                          DropdownMenuItem(value: 'light', child: Text('æ·ºè‰²')),
                          DropdownMenuItem(value: 'dark', child: Text('æ·±è‰²')),
                          DropdownMenuItem(value: 'auto', child: Text('è‡ªå‹•')),
                        ],
                        onChanged: (value) => _updateSetting('theme', value),
                      ),
                    ],
                  ),
                  
                  // é€šçŸ¥è¨­å®š
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text('æ¨é€é€šçŸ¥'),
                      Switch(
                        value: _state.settings['notifications'] ?? false,
                        onChanged: (value) => _updateSetting('notifications', value),
                      ),
                    ],
                  ),
                ],
              ),
            ),
          ),
          
          // é¸ä¸­çš„ä½¿ç”¨è€…
          if (_state.selectedUser != null)
            Card(
              margin: EdgeInsets.symmetric(horizontal: 16),
              child: ListTile(
                leading: CircleAvatar(
                  child: Text(_state.selectedUser!['name'][0]),
                ),
                title: Text(_state.selectedUser!['name']),
                subtitle: Text(_state.selectedUser!['email']),
                trailing: Icon(Icons.star, color: Colors.amber),
              ),
            ),
          
          // ä½¿ç”¨è€…åˆ—è¡¨
          Expanded(
            child: ListView.builder(
              itemCount: _state.users.length,
              itemBuilder: (context, index) {
                final user = _state.users[index];
                final isSelected = _state.selectedUser?['id'] == user['id'];
                
                return ListTile(
                  leading: CircleAvatar(
                    child: Text(user['name'][0]),
                    backgroundColor: isSelected ? Colors.blue : Colors.grey,
                  ),
                  title: Text(user['name']),
                  subtitle: Text(user['email']),
                  trailing: isSelected ? Icon(Icons.check, color: Colors.blue) : null,
                  onTap: () => _selectUser(user),
                  selected: isSelected,
                );
              },
            ),
          ),
          
          // ç‹€æ…‹è³‡è¨Šé¡¯ç¤ºï¼ˆåƒ…ä¾›é–‹ç™¼æ™‚æŸ¥çœ‹ï¼‰
          Container(
            width: double.infinity,
            padding: EdgeInsets.all(16),
            color: Colors.grey[100],
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text('ç•¶å‰ç‹€æ…‹ï¼š'),
                Text('è¼‰å…¥ä¸­ï¼š${_state.isLoading}'),
                Text('éŒ¯èª¤ï¼š${_state.error ?? "ç„¡"}'),
                Text('ä½¿ç”¨è€…æ•¸é‡ï¼š${_state.users.length}'),
                Text('é¸ä¸­ä½¿ç”¨è€…ï¼š${_state.selectedUser?['name'] ?? "ç„¡"}'),
                Text('è¨­å®šï¼š${_state.settings.toString()}'),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
```

------

## ğŸ¯ ç¸½çµèˆ‡æœ€ä½³å¯¦è¸

### å‹åˆ¥ä½¿ç”¨åŸå‰‡

```dart
// âœ… è‰¯å¥½çš„å‹åˆ¥ä½¿ç”¨
class GoodPractice {
  // 1. æ˜ç¢ºçš„å‹åˆ¥å®£å‘Š
  final String userName;              // æ¸…æ¥šçš„è®Šæ•¸å‹åˆ¥
  final List<String> hobbies;         // æ³›å‹å‹åˆ¥æ˜ç¢º
  final Map<String, int> scores;      // éµå€¼å‹åˆ¥éƒ½æ˜ç¢º
  
  // 2. å‡½æ•¸å›å‚³å‹åˆ¥æ˜ç¢º
  String getFullName(String first, String last) {
    return '$first $last';
  }
  
  Future<List<String>> fetchNotifications() async {
    // ç•°æ­¥æ“ä½œå›å‚³æ˜ç¢ºå‹åˆ¥
    return ['é€šçŸ¥1', 'é€šçŸ¥2'];
  }
  
  // 3. ä½¿ç”¨å¯ç‚ºç©ºå‹åˆ¥ä¾†è¡¨é”æ„åœ–
  String? findUserById(String id) {
    // å¯èƒ½æ‰¾ä¸åˆ°ï¼Œå›å‚³ null
    return null;
  }
  
  // 4. æ³›å‹çš„åˆç†ä½¿ç”¨
  T processData<T>(T input, T Function(T) processor) {
    return processor(input);
  }
}

// âŒ é¿å…çš„ä¸è‰¯å¯¦è¸
class BadPractice {
  // 1. éåº¦ä½¿ç”¨ dynamic
  dynamic userData;  // ä¸æ¸…æ¥šè³‡æ–™çµæ§‹
  
  // 2. å›å‚³å‹åˆ¥ä¸æ˜ç¢º
  get someData => userData;  // ä¸çŸ¥é“å›å‚³ä»€éº¼
  
  // 3. æ²’æœ‰è™•ç† null çš„æƒ…æ³
  String getName() {
    return userData['name'];  // å¯èƒ½æ‹‹å‡ºç•°å¸¸
  }
  
  // 4. æ³›å‹ä½¿ç”¨ä¸ç•¶
  processStuff(stuff) {  // æ²’æœ‰å‹åˆ¥è³‡è¨Š
    return stuff;
  }
}
```

### é–‹ç™¼å»ºè­°

1. **ç¸½æ˜¯ä½¿ç”¨æ˜ç¢ºçš„å‹åˆ¥å®£å‘Š**
   - æé«˜ç¨‹å¼ç¢¼å¯è®€æ€§
   - ç²å¾—æ›´å¥½çš„ IDE æ”¯æ´
   - é¿å…åŸ·è¡Œæ™‚å‹åˆ¥éŒ¯èª¤
2. **å–„ç”¨ Null Safety**
   - ä½¿ç”¨ `?` è¡¨ç¤ºå¯ç‚ºç©ºçš„å‹åˆ¥
   - ä½¿ç”¨ `??` é‹ç®—å­æä¾›é è¨­å€¼
   - åœ¨ç¢ºå®šä¸ç‚º null æ™‚æ‰ä½¿ç”¨ `!`
3. **åˆç†ä½¿ç”¨æ³›å‹**
   - æé«˜ç¨‹å¼ç¢¼é‡ç”¨æ€§
   - ä¿æŒå‹åˆ¥å®‰å…¨
   - ä½¿ API æ›´åŠ éˆæ´»
4. **ç•°æ­¥ç¨‹å¼è¨­è¨ˆæœ€ä½³å¯¦è¸**
   - ä½¿ç”¨ `Future<T>` è¡¨ç¤ºç•°æ­¥æ“ä½œ
   - é©ç•¶è™•ç†éŒ¯èª¤æƒ…æ³
   - ä½¿ç”¨ `async/await` è®“ç¨‹å¼ç¢¼æ›´æ˜“è®€

è¨˜ä½ï¼Œè‰¯å¥½çš„å‹åˆ¥ä½¿ç”¨ä¸åƒ…èƒ½è®“ç¨‹å¼ç¢¼æ›´å®‰å…¨ï¼Œé‚„èƒ½è®“å…¶ä»–é–‹ç™¼è€…ï¼ˆåŒ…æ‹¬æœªä¾†çš„è‡ªå·±ï¼‰æ›´å®¹æ˜“ç†è§£å’Œç¶­è­·ç¨‹å¼ç¢¼ï¼

### ğŸ‰ æ­å–œï¼

ç¾åœ¨ä½ å·²ç¶“æŒæ¡äº† Dart ä¸­å„ç¨®è³‡æ–™å‹åˆ¥çš„ä½¿ç”¨æ–¹æ³•ã€‚é€™äº›ä¸æ˜¯å‡½æ•¸ï¼Œè€Œæ˜¯æè¿°è³‡æ–™çš„å‹åˆ¥ç³»çµ±ã€‚ç†è§£é€™äº›å‹åˆ¥å°‡å¹«åŠ©ä½ ï¼š

- å¯«å‡ºæ›´å®‰å…¨çš„ç¨‹å¼ç¢¼
- ç²å¾—æ›´å¥½çš„é–‹ç™¼é«”é©—
- é¿å…å¸¸è¦‹çš„åŸ·è¡Œæ™‚éŒ¯èª¤
- å»ºæ§‹æ›´å¥å£¯çš„ Flutter æ‡‰ç”¨ç¨‹å¼

ç¹¼çºŒç·´ç¿’å’Œæ¢ç´¢ï¼Œä½ å°‡æˆç‚º Flutter é–‹ç™¼çš„å°ˆå®¶ï¼ğŸš€