# Flutter Dart 資料型別與函數完全指南

## 🎯 概念釐清

在 Dart 中，`void`、`Future<void>`、`bool`、`List<String>`、`String` 這些**不是函數**，而是**資料型別**（Data Types）。它們用來告訴程式：

- 變數可以儲存什麼類型的資料
- 函數會回傳什麼類型的值
- 參數期望接收什麼類型的資料

```dart
// 這些是型別宣告，不是函數！
String name = 'Flutter';           // String 型別的變數
bool isVisible = true;             // bool 型別的變數  
List<String> items = ['A', 'B'];   // List<String> 型別的變數

// 在函數中使用型別
String getName() {                 // 回傳 String 型別
  return 'Flutter Developer';
}

void printMessage() {              // 不回傳任何值（void）
  print('Hello World');
}
```

------

## 📝 Dart 基本資料型別

### 1. **基本型別**

#### `int` - 整數

```dart
// 整數型別
int age = 25;
int score = 100;
int negative = -10;

// 常用操作
int sum = 10 + 20;        // 加法
int difference = 30 - 15; // 減法
int product = 5 * 6;      // 乘法
int quotient = 20 ~/ 3;   // 整數除法 = 6
int remainder = 20 % 3;   // 餘數 = 2

print('年齡：$age');        // 字串插值
print('分數是否及格：${score >= 60}'); // 比較運算
```

#### `double` - 浮點數

```dart
// 浮點數型別
double height = 175.5;
double weight = 68.2;
double pi = 3.14159;

// 數學運算
double bmi = weight / ((height / 100) * (height / 100));
double area = pi * 5 * 5; // 圓面積

// 精度控制
double rounded = double.parse(bmi.toStringAsFixed(2)); // 保留兩位小數

print('BMI: ${bmi.toStringAsFixed(1)}');
```

#### `String` - 字串

```dart
// 字串宣告方式
String name = 'Flutter Developer';
String title = "應用程式開發者";
String multiLine = '''
這是多行字串
可以包含換行
非常方便
''';

// 字串操作
String firstName = 'John';
String lastName = 'Doe';
String fullName = '$firstName $lastName';        // 字串插值
String upperName = fullName.toUpperCase();       // 轉大寫
String lowerName = fullName.toLowerCase();       // 轉小寫

// 字串方法
bool isEmpty = name.isEmpty;                     // 檢查是否為空
bool contains = name.contains('Flutter');       // 包含檢查
int length = name.length;                        // 字串長度
String substring = name.substring(0, 7);        // 子字串
List<String> words = name.split(' ');           // 分割字串

// 字串比較
String str1 = 'Hello';
String str2 = 'hello';
bool isEqual = str1 == str2;                     // false (大小寫敏感)
bool isEqualIgnoreCase = str1.toLowerCase() == str2.toLowerCase(); // true

print('全名：$fullName');
print('包含 Flutter：$contains');
print('字串長度：$length');
```

#### `bool` - 布林值

```dart
// 布林值只有兩個值：true 或 false
bool isLoggedIn = false;
bool isAdmin = true;
bool isVisible = true;

// 邏輯運算
bool result1 = true && false;   // AND 運算 = false
bool result2 = true || false;   // OR 運算 = true
bool result3 = !true;           // NOT 運算 = false

// 條件判斷
int score = 85;
bool isPassed = score >= 60;    // true
bool isExcellent = score >= 90; // false

// 在條件語句中使用
if (isLoggedIn && isAdmin) {
  print('歡迎管理員');
} else if (isLoggedIn) {
  print('歡迎使用者');
} else {
  print('請先登入');
}

// 三元運算子
String status = isLoggedIn ? '已登入' : '未登入';
```

### 2. **集合型別**

#### `List<T>` - 陣列/清單

```dart
// List 宣告方式
List<String> fruits = ['蘋果', '香蕉', '橘子'];
List<int> numbers = [1, 2, 3, 4, 5];
List<bool> flags = [true, false, true];

// 空 List
List<String> emptyList = [];
List<String> emptyList2 = <String>[];
List<String> emptyList3 = List<String>.empty(growable: true);

// List 操作
fruits.add('葡萄');                    // 新增元素
fruits.addAll(['芒果', '鳳梨']);        // 新增多個元素
fruits.insert(1, '奇異果');            // 在指定位置插入
fruits.remove('香蕉');                 // 移除特定元素
fruits.removeAt(0);                   // 移除指定位置元素
fruits.clear();                       // 清空所有元素

// List 屬性
int length = fruits.length;           // 取得長度
bool isEmpty = fruits.isEmpty;        // 檢查是否為空
bool isNotEmpty = fruits.isNotEmpty;  // 檢查是否非空
String first = fruits.first;          // 第一個元素
String last = fruits.last;            // 最後一個元素

// List 遍歷
for (String fruit in fruits) {
  print('水果：$fruit');
}

for (int i = 0; i < fruits.length; i++) {
  print('第 ${i + 1} 個水果：${fruits[i]}');
}

fruits.forEach((fruit) {
  print('使用 forEach：$fruit');
});

// List 轉換
List<String> upperFruits = fruits.map((fruit) => fruit.toUpperCase()).toList();
List<String> longNames = fruits.where((fruit) => fruit.length > 2).toList();

// 範例：建立購物清單 Widget
class ShoppingList extends StatelessWidget {
  final List<String> items = ['牛奶', '麵包', '雞蛋', '蘋果'];
  
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: items.length,
      itemBuilder: (context, index) {
        return ListTile(
          leading: Icon(Icons.shopping_cart),
          title: Text(items[index]),
          trailing: IconButton(
            icon: Icon(Icons.delete),
            onPressed: () {
              // 移除項目的邏輯
            },
          ),
        );
      },
    );
  }
}
```

#### `Map<K, V>` - 字典/對映

```dart
// Map 宣告方式
Map<String, String> userInfo = {
  'name': '張小明',
  'email': 'ming@example.com',
  'phone': '0912-345-678'
};

Map<String, int> scores = {
  '國文': 85,
  '英文': 92,
  '數學': 78
};

// 空 Map
Map<String, String> emptyMap = {};
Map<String, String> emptyMap2 = <String, String>{};

// Map 操作
userInfo['address'] = '台北市信義區';     // 新增/更新
userInfo.remove('phone');               // 移除
bool hasEmail = userInfo.containsKey('email'); // 檢查鍵是否存在
bool hasValue = userInfo.containsValue('張小明'); // 檢查值是否存在

// Map 屬性和方法
int length = userInfo.length;           // 取得大小
bool isEmpty = userInfo.isEmpty;        // 檢查是否為空
Iterable<String> keys = userInfo.keys;  // 取得所有鍵
Iterable<String> values = userInfo.values; // 取得所有值

// Map 遍歷
userInfo.forEach((key, value) {
  print('$key: $value');
});

for (String key in userInfo.keys) {
  print('$key: ${userInfo[key]}');
}

// 安全取值（避免 null）
String? email = userInfo['email'];      // 可能為 null
String emailSafe = userInfo['email'] ?? '未設定'; // 提供預設值

// 範例：使用者設定 Widget
class UserProfile extends StatelessWidget {
  final Map<String, dynamic> profile = {
    'avatar': 'assets/images/avatar.png',
    'name': '張小明',
    'age': 25,
    'isVip': true,
    'joinDate': DateTime(2023, 1, 15),
  };
  
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        CircleAvatar(
          backgroundImage: AssetImage(profile['avatar']),
          radius: 50,
        ),
        SizedBox(height: 16),
        Text(
          profile['name'],
          style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
        ),
        Text('年齡：${profile['age']}'),
        if (profile['isVip']) 
          Chip(
            label: Text('VIP 會員'),
            backgroundColor: Colors.gold,
          ),
      ],
    );
  }
}
```

#### `Set<T>` - 集合（不重複元素）

```dart
// Set 宣告
Set<String> uniqueFruits = {'蘋果', '香蕉', '橘子'};
Set<int> uniqueNumbers = {1, 2, 3, 3, 4}; // 重複的 3 只會保留一個

// Set 操作
uniqueFruits.add('葡萄');               // 新增
uniqueFruits.addAll(['芒果', '蘋果']);   // 新增多個（重複的會被忽略）
uniqueFruits.remove('香蕉');            // 移除
bool contains = uniqueFruits.contains('蘋果'); // 檢查是否包含

// Set 運算
Set<int> set1 = {1, 2, 3, 4};
Set<int> set2 = {3, 4, 5, 6};

Set<int> union = set1.union(set2);           // 聯集 {1, 2, 3, 4, 5, 6}
Set<int> intersection = set1.intersection(set2); // 交集 {3, 4}
Set<int> difference = set1.difference(set2);     // 差集 {1, 2}

// 轉換
List<String> fruitList = uniqueFruits.toList(); // Set 轉 List
Set<String> fruitSet = fruitList.toSet();       // List 轉 Set（去重複）
```

------

## 🔄 函數與回傳型別

### 1. **void - 無回傳值**

```dart
// void 表示函數不回傳任何值
void printWelcome() {
  print('歡迎使用 Flutter 應用程式！');
  // 沒有 return 語句，或者 return; （不回傳值）
}

void updateUserInfo(String name, int age) {
  print('更新使用者資訊：$name, $age 歲');
  // 執行更新邏輯，但不回傳結果
}

void showDialog(BuildContext context, String message) {
  showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('提示'),
      content: Text(message),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('確定'),
        ),
      ],
    ),
  );
}

// 在 Widget 中的使用
class MyWidget extends StatelessWidget {
  void _handleButtonPress() {  // void 函數
    print('按鈕被點擊了');
    // 執行某些動作，但不需要回傳值
  }
  
  @override
  Widget build(BuildContext context) {
    return ElevatedButton(
      onPressed: _handleButtonPress, // 傳遞 void 函數
      child: Text('點擊我'),
    );
  }
}
```

### 2. **具體型別回傳**

```dart
// String 回傳型別
String getUserName() {
  return '張小明';
}

String formatDate(DateTime date) {
  return '${date.year}年${date.month}月${date.day}日';
}

// int 回傳型別
int calculateAge(DateTime birthDate) {
  DateTime now = DateTime.now();
  int age = now.year - birthDate.year;
  if (now.month < birthDate.month || 
      (now.month == birthDate.month && now.day < birthDate.day)) {
    age--;
  }
  return age;
}

// bool 回傳型別
bool isEmailValid(String email) {
  return RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$').hasMatch(email);
}

bool isAdult(int age) {
  return age >= 18;
}

// List 回傳型別
List<String> getWeekdays() {
  return ['星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期日'];
}

List<int> generateNumbers(int count) {
  return List.generate(count, (index) => index + 1);
}

// Map 回傳型別
Map<String, dynamic> createUserData(String name, int age, String email) {
  return {
    'name': name,
    'age': age,
    'email': email,
    'createdAt': DateTime.now().toIso8601String(),
    'isActive': true,
  };
}

// 實際使用範例
class UserService {
  // 取得使用者顯示名稱
  String getDisplayName(Map<String, dynamic> user) {
    String firstName = user['firstName'] ?? '';
    String lastName = user['lastName'] ?? '';
    return '$lastName $firstName'.trim();
  }
  
  // 檢查使用者權限
  bool hasPermission(Map<String, dynamic> user, String permission) {
    List<String> permissions = List<String>.from(user['permissions'] ?? []);
    return permissions.contains(permission);
  }
  
  // 取得使用者的朋友清單
  List<String> getFriendNames(Map<String, dynamic> user) {
    List<Map<String, dynamic>> friends = 
        List<Map<String, dynamic>>.from(user['friends'] ?? []);
    return friends.map((friend) => friend['name'] as String).toList();
  }
}
```

### 3. **Future<T> - 異步回傳型別**

```dart
// Future<void> - 異步操作但不回傳值
Future<void> loadUserData() async {
  print('開始載入使用者資料...');
  await Future.delayed(Duration(seconds: 2)); // 模擬網路延遲
  print('使用者資料載入完成');
  // 不回傳任何值，只是執行異步操作
}

Future<void> saveToDatabase(Map<String, dynamic> data) async {
  // 模擬儲存到資料庫
  await Future.delayed(Duration(milliseconds: 500));
  print('資料已儲存：$data');
}

// Future<String> - 異步回傳字串
Future<String> fetchUserName(String userId) async {
  // 模擬 API 呼叫
  await Future.delayed(Duration(seconds: 1));
  return '使用者_$userId';
}

Future<String> downloadFile(String url) async {
  print('開始下載：$url');
  await Future.delayed(Duration(seconds: 3));
  return '/downloads/file_${DateTime.now().millisecondsSinceEpoch}.zip';
}

// Future<bool> - 異步回傳布林值
Future<bool> authenticateUser(String username, String password) async {
  await Future.delayed(Duration(seconds: 1)); // 模擬驗證過程
  
  // 簡單的驗證邏輯
  if (username == 'admin' && password == '123456') {
    return true;
  }
  return false;
}

Future<bool> checkNetworkConnection() async {
  // 檢查網路連線狀態
  await Future.delayed(Duration(milliseconds: 200));
  return true; // 假設有網路連線
}

// Future<List<T>> - 異步回傳列表
Future<List<String>> fetchNotifications() async {
  await Future.delayed(Duration(seconds: 2));
  return [
    '您有新的訊息',
    '系統維護通知',
    '好友邀請',
    '活動提醒'
  ];
}

Future<List<Map<String, dynamic>>> fetchProducts() async {
  await Future.delayed(Duration(seconds: 1));
  return [
    {'id': 1, 'name': 'iPhone 15', 'price': 30900},
    {'id': 2, 'name': 'iPad Air', 'price': 19900},
    {'id': 3, 'name': 'MacBook Pro', 'price': 65900},
  ];
}

// Future<Map<K, V>> - 異步回傳對映
Future<Map<String, dynamic>> fetchWeatherData(String city) async {
  await Future.delayed(Duration(milliseconds: 800));
  return {
    'city': city,
    'temperature': 25.6,
    'humidity': 65,
    'condition': '晴朗',
    'forecast': ['今日晴', '明日陰', '後日雨'],
    'lastUpdated': DateTime.now().toIso8601String(),
  };
}

// 在 Widget 中使用 Future
class AsyncDataWidget extends StatefulWidget {
  @override
  _AsyncDataWidgetState createState() => _AsyncDataWidgetState();
}

class _AsyncDataWidgetState extends State<AsyncDataWidget> {
  String userName = '';
  List<String> notifications = [];
  bool isLoading = false;
  
  @override
  void initState() {
    super.initState();
    _loadData(); // 在初始化時載入資料
  }
  
  // 載入資料的異步方法
  Future<void> _loadData() async {
    setState(() {
      isLoading = true;
    });
    
    try {
      // 並行執行多個異步操作
      final results = await Future.wait([
        fetchUserName('user123'),
        fetchNotifications(),
      ]);
      
      setState(() {
        userName = results[0] as String;
        notifications = results[1] as List<String>;
        isLoading = false;
      });
    } catch (error) {
      print('載入資料時發生錯誤：$error');
      setState(() {
        isLoading = false;
      });
    }
  }
  
  // 重新整理資料
  Future<void> _refreshData() async {
    await _loadData();
  }
  
  @override
  Widget build(BuildContext context) {
    if (isLoading) {
      return Center(child: CircularProgressIndicator());
    }
    
    return RefreshIndicator(
      onRefresh: _refreshData,
      child: Column(
        children: [
          Text('歡迎，$userName'),
          SizedBox(height: 16),
          Text('通知 (${notifications.length})：'),
          Expanded(
            child: ListView.builder(
              itemCount: notifications.length,
              itemBuilder: (context, index) {
                return ListTile(
                  leading: Icon(Icons.notifications),
                  title: Text(notifications[index]),
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}

// 異步操作的錯誤處理
class ApiService {
  // 帶錯誤處理的異步方法
  Future<Map<String, dynamic>?> loginUser(String email, String password) async {
    try {
      // 模擬登入 API 呼叫
      await Future.delayed(Duration(seconds: 2));
      
      if (email.isEmpty || password.isEmpty) {
        throw Exception('電子郵件和密碼不能為空');
      }
      
      if (!isEmailValid(email)) {
        throw Exception('電子郵件格式不正確');
      }
      
      bool isAuthenticated = await authenticateUser(email, password);
      if (!isAuthenticated) {
        throw Exception('電子郵件或密碼錯誤');
      }
      
      return {
        'success': true,
        'user': {
          'email': email,
          'name': '張小明',
          'token': 'jwt_token_here',
        }
      };
    } catch (error) {
      print('登入失敗：$error');
      return {
        'success': false,
        'error': error.toString(),
      };
    }
  }
  
  // 使用 async/await 處理多個異步操作
  Future<bool> updateUserProfile(String userId, Map<String, dynamic> profileData) async {
    try {
      // 1. 驗證資料
      if (profileData.isEmpty) {
        throw Exception('更新資料不能為空');
      }
      
      // 2. 上傳頭像（如果有）
      if (profileData.containsKey('avatar')) {
        String avatarUrl = await uploadAvatar(profileData['avatar']);
        profileData['avatarUrl'] = avatarUrl;
      }
      
      // 3. 更新使用者資料
      await updateDatabase(userId, profileData);
      
      // 4. 清除快取
      await clearUserCache(userId);
      
      return true;
    } catch (error) {
      print('更新個人資料失敗：$error');
      return false;
    }
  }
  
  // 輔助方法
  Future<String> uploadAvatar(String imagePath) async {
    await Future.delayed(Duration(seconds: 1));
    return 'https://cdn.example.com/avatars/user_avatar.jpg';
  }
  
  Future<void> updateDatabase(String userId, Map<String, dynamic> data) async {
    await Future.delayed(Duration(milliseconds: 500));
    print('資料庫已更新：使用者 $userId');
  }
  
  Future<void> clearUserCache(String userId) async {
    await Future.delayed(Duration(milliseconds: 100));
    print('快取已清除：使用者 $userId');
  }
}
```

------

## 🔧 類型安全與 Null Safety

### 1. **可為空的型別（Nullable Types）**

```dart
// 可為空的型別（在型別後加 ?）
String? nullableName;           // 可以是 String 或 null
int? nullableAge;               // 可以是 int 或 null
List<String>? nullableList;     // 可以是 List<String> 或 null

// 不可為空的型別（預設）
String name = 'Flutter';        // 必須有值，不能是 null
int age = 25;                   // 必須有值，不能是 null

// 檢查和使用可為空的值
String? getUserName() {
  // 可能回傳 null
  return null;
}

void handleUserName() {
  String? name = getUserName();
  
  // 方法1：使用 if 檢查
  if (name != null) {
    print('使用者名稱：$name');
    print('名稱長度：${name.length}'); // 安全存取
  }
  
  // 方法2：使用 null-aware 運算子
  print('名稱長度：${name?.length}');      // 如果 name 為 null，結果為 null
  print('使用者名稱：${name ?? "訪客"}');   // 如果 name 為 null，使用預設值
  
  // 方法3：強制斷言（需確保不為 null）
  // print('名稱長度：${name!.length}');   // 危險！如果 name 為 null 會拋出異常
}

// 實際應用範例
class UserProfile {
  String name;                    // 必填
  int age;                        // 必填
  String? email;                  // 可選
  String? phone;                  // 可選
  List<String>? hobbies;          // 可選
  
  UserProfile({
    required this.name,           // 必須提供
    required this.age,            // 必須提供
    this.email,                   // 可選參數
    this.phone,                   // 可選參數
    this.hobbies,                 // 可選參數
  });
  
  // 安全取得電子郵件
  String getEmailDisplay() {
    return email ?? '未設定';
  }
  
  // 安全取得愛好數量
  int getHobbyCount() {
    return hobbies?.length ?? 0;
  }
  
  // 檢查是否有聯絡資訊
  bool hasContactInfo() {
    return email != null || phone != null;
  }
}
```

### 2. **型別轉換與檢查**

```dart
// 型別檢查
dynamic value = 'Hello World';

if (value is String) {
  print('這是字串：$value');
  print('長度：${value.length}'); // 自動轉型，可以安全使用 String 方法
}

if (value is! int) {
  print('這不是整數');
}

// 安全的型別轉換
String convertToString(dynamic value) {
  if (value is String) {
    return value;
  } else if (value is int) {
    return value.toString();
  } else if (value is double) {
    return value.toString();
  } else {
    return 'unknown';
  }
}

// 使用 as 進行強制轉型（需要確保型別正確）
Object obj = 'Flutter';
String str = obj as String;  // 強制轉為 String

// 安全的轉型（如果轉型失敗會回傳 null）
String? safeStr = obj as String?;

// 泛型型別轉換
List<dynamic> dynamicList = ['apple', 'banana', 'orange'];
List<String> stringList = dynamicList.cast<String>(); // 轉為 String 列表

// 從 JSON 解析的實際範例
Map<String, dynamic> jsonData = {
  'name': '張小明',
  'age': 25,
  'isActive': true,
  'scores': [85, 92, 78],
  'profile': {
    'email': 'ming@example.com',
    'phone': '0912-345-678'
  }
};

class JsonParser {
  static String getString(Map<String, dynamic> json, String key, [String defaultValue = '']) {
    final value = json[key];
    return value is String ? value : defaultValue;
  }
  
  static int getInt(Map<String, dynamic> json, String key, [int defaultValue = 0]) {
    final value = json[key];
    if (value is int) return value;
    if (value is double) return value.toInt();
    if (value is String) return int.tryParse(value) ?? defaultValue;
    return defaultValue;
  }
  
  static bool getBool(Map<String, dynamic> json, String key, [bool defaultValue = false]) {
    final value = json[key];
    return value is bool ? value : defaultValue;
  }
  
  static List<T> getList<T>(Map<String, dynamic> json, String key) {
    final value = json[key];
    if (value is List) {
      return value.cast<T>();
    }
    return <T>[];
  }
}

// 使用範例
void parseUserData() {
  String name = JsonParser.getString(jsonData, 'name');
  int age = JsonParser.getInt(jsonData, 'age');
  bool isActive = JsonParser.getBool(jsonData, 'isActive');
  List<int> scores = JsonParser.getList<int>(jsonData, 'scores');
  
  print('姓名：$name');
  print('年齡：$age');
  print('狀態：${isActive ? "活躍" : "非活躍"}');
  print('成績：$scores');
}
```

------

## 🎯 函數參數型別

### 1. **必要參數（Required Parameters）**

```dart
// 位置參數（順序很重要）
String createFullName(String firstName, String lastName) {
  return '$firstName $lastName';
}

int add(int a, int b) {
  return a + b;
}

// 使用方式
String name = createFullName('John', 'Doe');  // 必須按順序傳入
int sum = add(10, 20);                        // 第一個參數是 a，第二個是 b

// 具名必要參數（使用 required 關鍵字）
Widget createButton({
  required String text,           // 必須提供
  required VoidCallback onPressed, // 必須提供
  required Color backgroundColor,  // 必須提供
}) {
  return ElevatedButton(
    onPressed: onPressed,
    style: ElevatedButton.styleFrom(primary: backgroundColor),
    child: Text(text),
  );
}

// 使用具名必要參數
Widget button = createButton(
  text: '點擊我',
  onPressed: () => print('按鈕被點擊'),
  backgroundColor: Colors.blue,
);
```

### 2. **可選參數（Optional Parameters）**

```dart
// 位置可選參數（用 [] 包圍）
String greetUser(String name, [String? title, int age = 0]) {
  String greeting = '你好';
  if (title != null) {
    greeting += ' $title';
  }
  greeting += ' $name';
  if (age > 0) {
    greeting += '，您今年 $age 歲';
  }
  return greeting;
}

// 使用方式
String msg1 = greetUser('小明');                    // 你好 小明
String msg2 = greetUser('小明', '先生');             // 你好 先生 小明
String msg3 = greetUser('小明', '先生', 25);         // 你好 先生 小明，您今年 25 歲
String msg4 = greetUser('小明', null, 30);         // 你好 小明，您今年 30 歲

// 具名可選參數（用 {} 包圍）
Widget createCard({
  required String title,           // 必要參數
  String? subtitle,               // 可選參數
  Color backgroundColor = Colors.white, // 有預設值的可選參數
  double elevation = 2.0,         // 有預設值的可選參數
  bool isEnabled = true,          // 有預設值的可選參數
  VoidCallback? onTap,           // 可選參數
}) {
  return Card(
    color: backgroundColor,
    elevation: elevation,
    child: InkWell(
      onTap: isEnabled ? onTap : null,
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              title,
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
                color: isEnabled ? Colors.black : Colors.grey,
              ),
            ),
            if (subtitle != null) ...[
              SizedBox(height: 8),
              Text(
                subtitle,
                style: TextStyle(
                  fontSize: 14,
                  color: isEnabled ? Colors.grey[600] : Colors.grey[400],
                ),
              ),
            ],
          ],
        ),
      ),
    ),
  );
}

// 使用具名可選參數（可以任意順序）
Widget card1 = createCard(title: '基本卡片');

Widget card2 = createCard(
  title: '進階卡片',
  subtitle: '這是副標題',
  backgroundColor: Colors.blue[50],
  elevation: 4.0,
);

Widget card3 = createCard(
  title: '互動卡片',
  onTap: () => print('卡片被點擊'),
  isEnabled: true,
  backgroundColor: Colors.green[100],
);
```

### 3. **函數型別參數**

```dart
// 函數作為參數
void executeOperation(int a, int b, int Function(int, int) operation) {
  int result = operation(a, b);
  print('運算結果：$result');
}

// 定義不同的運算函數
int add(int a, int b) => a + b;
int multiply(int a, int b) => a * b;
int subtract(int a, int b) => a - b;

// 使用函數參數
void performCalculations() {
  executeOperation(10, 5, add);       // 運算結果：15
  executeOperation(10, 5, multiply);  // 運算結果：50
  executeOperation(10, 5, subtract); // 運算結果：5
  
  // 使用匿名函數
  executeOperation(10, 5, (a, b) => a ~/ b); // 運算結果：2（整數除法）
}

// 更複雜的函數型別參數範例
class ListProcessor {
  // 處理字串列表的通用方法
  static List<String> processStringList(
    List<String> items,
    String Function(String) processor, // 處理單個項目的函數
  ) {
    return items.map(processor).toList();
  }
  
  // 過濾列表的通用方法
  static List<T> filterList<T>(
    List<T> items,
    bool Function(T) predicate, // 判斷條件的函數
  ) {
    return items.where(predicate).toList();
  }
  
  // 歸約列表的通用方法
  static T reduceList<T>(
    List<T> items,
    T Function(T previous, T current) combiner, // 合併函數
  ) {
    return items.reduce(combiner);
  }
}

// 使用函數型別參數的實際範例
void demonstrateFunctionParameters() {
  List<String> names = ['john doe', 'jane smith', 'bob johnson'];
  
  // 使用不同的處理函數
  List<String> upperNames = ListProcessor.processStringList(
    names,
    (name) => name.toUpperCase(), // 轉大寫
  );
  
  List<String> capitalizedNames = ListProcessor.processStringList(
    names,
    (name) => name.split(' ').map((word) => 
        word[0].toUpperCase() + word.substring(1)).join(' '), // 首字母大寫
  );
  
  // 過濾長度大於 8 的名字
  List<String> longNames = ListProcessor.filterList(
    names,
    (name) => name.length > 8,
  );
  
  print('原始：$names');
  print('大寫：$upperNames');
  print('首字母大寫：$capitalizedNames');
  print('長名字：$longNames');
}

// Widget 回調函數的實際應用
class CustomButton extends StatelessWidget {
  final String text;
  final VoidCallback? onPressed;           // 無參數無回傳值
  final ValueChanged<String>? onTextChanged; // 有參數無回傳值
  final String Function()? getButtonText;   // 無參數有回傳值
  final bool Function(String)? validator;   // 有參數有回傳值
  
  const CustomButton({
    Key? key,
    required this.text,
    this.onPressed,
    this.onTextChanged,
    this.getButtonText,
    this.validator,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    String displayText = getButtonText?.call() ?? text;
    bool isValid = validator?.call(displayText) ?? true;
    
    return ElevatedButton(
      onPressed: isValid ? () {
        onPressed?.call();
        onTextChanged?.call(displayText);
      } : null,
      child: Text(displayText),
      style: ElevatedButton.styleFrom(
        primary: isValid ? Colors.blue : Colors.grey,
      ),
    );
  }
}

// 使用自訂按鈕
class ButtonDemo extends StatefulWidget {
  @override
  _ButtonDemoState createState() => _ButtonDemoState();
}

class _ButtonDemoState extends State<ButtonDemo> {
  String currentText = '點擊我';
  int clickCount = 0;
  
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        CustomButton(
          text: '基本按鈕',
          onPressed: () {
            print('基本按鈕被點擊');
          },
        ),
        
        SizedBox(height: 16),
        
        CustomButton(
          text: '動態按鈕',
          getButtonText: () => '點擊次數：$clickCount',
          onPressed: () {
            setState(() {
              clickCount++;
            });
          },
          onTextChanged: (text) {
            print('按鈕文字變為：$text');
          },
        ),
        
        SizedBox(height: 16),
        
        CustomButton(
          text: '驗證按鈕',
          validator: (text) => clickCount > 0, // 必須點擊過才能使用
          onPressed: () {
            print('驗證按鈕被點擊');
          },
        ),
      ],
    );
  }
}
```

------

## 🎨 泛型型別（Generic Types）

### 1. **基本泛型概念**

```dart
// 泛型類別
class Box<T> {
  T value;
  
  Box(this.value);
  
  void setValue(T newValue) {
    value = newValue;
  }
  
  T getValue() {
    return value;
  }
  
  // 型別安全的比較
  bool isEqual(Box<T> other) {
    return value == other.value;
  }
}

// 使用泛型類別
void demonstrateGenerics() {
  // 字串盒子
  Box<String> stringBox = Box<String>('Hello');
  stringBox.setValue('World');
  String stringValue = stringBox.getValue(); // 型別安全，不需要轉型
  
  // 整數盒子
  Box<int> intBox = Box<int>(42);
  intBox.setValue(100);
  int intValue = intBox.getValue();
  
  // 自訂物件盒子
  Box<DateTime> dateBox = Box<DateTime>(DateTime.now());
  DateTime currentDate = dateBox.getValue();
  
  print('字串值：$stringValue');
  print('整數值：$intValue');
  print('日期值：$currentDate');
}

// 泛型函數
T getFirst<T>(List<T> items) {
  if (items.isEmpty) {
    throw ArgumentError('列表不能為空');
  }
  return items.first;
}

List<T> createFilledList<T>(T value, int length) {
  return List.filled(length, value);
}

Map<K, V> createMap<K, V>(List<K> keys, List<V> values) {
  if (keys.length != values.length) {
    throw ArgumentError('鍵值列表長度必須相同');
  }
  
  Map<K, V> result = {};
  for (int i = 0; i < keys.length; i++) {
    result[keys[i]] = values[i];
  }
  return result;
}

// 使用泛型函數
void useGenericFunctions() {
  // 取得第一個元素
  String firstFruit = getFirst<String>(['蘋果', '香蕉', '橘子']);
  int firstNumber = getFirst<int>([1, 2, 3, 4, 5]);
  
  // 創建填充列表
  List<bool> boolList = createFilledList<bool>(true, 5); // [true, true, true, true, true]
  List<String> stringList = createFilledList<String>('Hello', 3); // ['Hello', 'Hello', 'Hello']
  
  // 創建對映
  Map<String, int> scoreMap = createMap<String, int>(
    ['Alice', 'Bob', 'Charlie'],
    [95, 87, 92]
  );
  
  print('第一個水果：$firstFruit');
  print('第一個數字：$firstNumber');
  print('布林列表：$boolList');
  print('成績對映：$scoreMap');
}
```

### 2. **約束泛型（Bounded Generics）**

```dart
// 約束泛型必須繼承某個類別
abstract class Animal {
  String get name;
  void makeSound();
}

class Dog extends Animal {
  @override
  String get name => 'Dog';
  
  @override
  void makeSound() {
    print('Woof!');
  }
}

class Cat extends Animal {
  @override
  String get name => 'Cat';
  
  @override
  void makeSound() {
    print('Meow!');
  }
}

// 只接受 Animal 及其子類的泛型
class AnimalShelter<T extends Animal> {
  List<T> animals = [];
  
  void addAnimal(T animal) {
    animals.add(animal);
    print('${animal.name} 已加入收容所');
  }
  
  void makeAllSounds() {
    for (T animal in animals) {
      animal.makeSound(); // 可以安全調用 Animal 的方法
    }
  }
  
  List<T> getAllAnimals() {
    return List.from(animals);
  }
}

// 使用約束泛型
void demonstrateBoundedGenerics() {
  AnimalShelter<Dog> dogShelter = AnimalShelter<Dog>();
  dogShelter.addAnimal(Dog());
  dogShelter.addAnimal(Dog());
  
  AnimalShelter<Cat> catShelter = AnimalShelter<Cat>();
  catShelter.addAnimal(Cat());
  
  print('狗收容所的聲音：');
  dogShelter.makeAllSounds();
  
  print('貓收容所的聲音：');
  catShelter.makeAllSounds();
}

// 數值約束的泛型
class Calculator<T extends num> {
  T add(T a, T b) {
    return (a + b) as T;
  }
  
  T multiply(T a, T b) {
    return (a * b) as T;
  }
  
  double divide(T a, T b) {
    return a / b;
  }
  
  bool isPositive(T value) {
    return value > 0;
  }
}

// 使用數值約束泛型
void useNumericGenerics() {
  Calculator<int> intCalc = Calculator<int>();
  int sum = intCalc.add(10, 20);           // 30
  int product = intCalc.multiply(5, 6);    // 30
  double quotient = intCalc.divide(15, 3); // 5.0
  
  Calculator<double> doubleCalc = Calculator<double>();
  double decimalSum = doubleCalc.add(3.14, 2.86);      // 6.0
  double decimalProduct = doubleCalc.multiply(2.5, 4.0); // 10.0
  
  print('整數計算：$sum, $product, $quotient');
  print('浮點數計算：$decimalSum, $decimalProduct');
}
```

### 3. **泛型在 Flutter 中的實際應用**

```dart
// 泛型 Widget
class GenericListWidget<T> extends StatelessWidget {
  final List<T> items;
  final Widget Function(T item, int index) itemBuilder;
  final String Function(T item)? getDisplayText;
  final void Function(T item)? onItemTap;
  
  const GenericListWidget({
    Key? key,
    required this.items,
    required this.itemBuilder,
    this.getDisplayText,
    this.onItemTap,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: items.length,
      itemBuilder: (context, index) {
        final item = items[index];
        return InkWell(
          onTap: onItemTap != null ? () => onItemTap!(item) : null,
          child: itemBuilder(item, index),
        );
      },
    );
  }
}

// 資料模型類別
class Product {
  final String name;
  final double price;
  final String category;
  
  Product({required this.name, required this.price, required this.category});
  
  @override
  String toString() => '$name - \${price.toStringAsFixed(2)}';
}

class User {
  final String name;
  final String email;
  final int age;
  
  User({required this.name, required this.email, required this.age});
  
  @override
  String toString() => '$name ($email) - $age 歲';
}

// 使用泛型 Widget
class GenericListDemo extends StatelessWidget {
  final List<Product> products = [
    Product(name: 'iPhone 15', price: 30900, category: '手機'),
    Product(name: 'iPad Air', price: 19900, category: '平板'),
    Product(name: 'MacBook Pro', price: 65900, category: '筆電'),
  ];
  
  final List<User> users = [
    User(name: '張小明', email: 'ming@example.com', age: 25),
    User(name: '李小華', email: 'hua@example.com', age: 30),
    User(name: '王小美', email: 'mei@example.com', age: 28),
  ];
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('泛型列表示例')),
      body: Column(
        children: [
          // 產品列表
          Expanded(
            child: GenericListWidget<Product>(
              items: products,
              itemBuilder: (product, index) {
                return Card(
                  child: ListTile(
                    leading: Icon(Icons.shopping_bag),
                    title: Text(product.name),
                    subtitle: Text('${product.category} - \${product.price}'),
                    trailing: Icon(Icons.arrow_forward_ios),
                  ),
                );
              },
              onItemTap: (product) {
                print('選擇了產品：${product.name}');
              },
            ),
          ),
          
          Divider(),
          
          // 使用者列表
          Expanded(
            child: GenericListWidget<User>(
              items: users,
              itemBuilder: (user, index) {
                return Card(
                  child: ListTile(
                    leading: CircleAvatar(child: Text(user.name[0])),
                    title: Text(user.name),
                    subtitle: Text('${user.email} - ${user.age} 歲'),
                    trailing: Icon(Icons.person),
                  ),
                );
              },
              onItemTap: (user) {
                print('選擇了使用者：${user.name}');
              },
            ),
          ),
        ],
      ),
    );
  }
}

// 泛型狀態管理
class GenericStateManager<T> {
  T _state;
  final List<void Function(T)> _listeners = [];
  
  GenericStateManager(this._state);
  
  T get state => _state;
  
  void setState(T newState) {
    _state = newState;
    _notifyListeners();
  }
  
  void addListener(void Function(T) listener) {
    _listeners.add(listener);
  }
  
  void removeListener(void Function(T) listener) {
    _listeners.remove(listener);
  }
  
  void _notifyListeners() {
    for (final listener in _listeners) {
      listener(_state);
    }
  }
  
  void dispose() {
    _listeners.clear();
  }
}

// 使用泛型狀態管理
class CounterState {
  final int count;
  final bool isLoading;
  
  CounterState({required this.count, required this.isLoading});
  
  CounterState copyWith({int? count, bool? isLoading}) {
    return CounterState(
      count: count ?? this.count,
      isLoading: isLoading ?? this.isLoading,
    );
  }
}

class GenericStateDemo extends StatefulWidget {
  @override
  _GenericStateDemoState createState() => _GenericStateDemoState();
}

class _GenericStateDemoState extends State<GenericStateDemo> {
  late GenericStateManager<CounterState> stateManager;
  
  @override
  void initState() {
    super.initState();
    stateManager = GenericStateManager<CounterState>(
      CounterState(count: 0, isLoading: false)
    );
    
    stateManager.addListener((state) {
      setState(() {
        // 觸發 Widget 重建
      });
    });
  }
  
  @override
  void dispose() {
    stateManager.dispose();
    super.dispose();
  }
  
  void _incrementCounter() {
    final currentState = stateManager.state;
    stateManager.setState(
      currentState.copyWith(count: currentState.count + 1)
    );
  }
  
  void _resetCounter() {
    stateManager.setState(
      CounterState(count: 0, isLoading: false)
    );
  }
  
  @override
  Widget build(BuildContext context) {
    final state = stateManager.state;
    
    return Scaffold(
      appBar: AppBar(title: Text('泛型狀態管理')),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Text(
              '計數器值：${state.count}',
              style: TextStyle(fontSize: 24),
            ),
            SizedBox(height: 20),
            if (state.isLoading)
              CircularProgressIndicator()
            else
              Row(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  ElevatedButton(
                    onPressed: _incrementCounter,
                    child: Text('增加'),
                  ),
                  SizedBox(width: 16),
                  ElevatedButton(
                    onPressed: _resetCounter,
                    child: Text('重設'),
                  ),
                ],
              ),
          ],
        ),
      ),
    );
  }
}
```

------

## 🎯 實際開發應用範例

### 1. **表單驗證系統**

```dart
// 驗證器類型定義
typedef Validator<T> = String? Function(T? value);

class FormValidators {
  // 字串驗證器
  static Validator<String> required([String message = '此欄位為必填']) {
    return (String? value) {
      if (value == null || value.trim().isEmpty) {
        return message;
      }
      return null;
    };
  }
  
  static Validator<String> minLength(int minLength, [String? message]) {
    return (String? value) {
      if (value != null && value.length < minLength) {
        return message ?? '長度不能少於 $minLength 個字元';
      }
      return null;
    };
  }
  
  static Validator<String> maxLength(int maxLength, [String? message]) {
    return (String? value) {
      if (value != null && value.length > maxLength) {
        return message ?? '長度不能超過 $maxLength 個字元';
      }
      return null;
    };
  }
  
  static Validator<String> email([String message = '請輸入有效的電子郵件地址']) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        final emailRegex = RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4});
        if (!emailRegex.hasMatch(value)) {
          return message;
        }
      }
      return null;
    };
  }
  
  static Validator<String> phone([String message = '請輸入有效的手機號碼']) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        final phoneRegex = RegExp(r'^09\d{8});
        if (!phoneRegex.hasMatch(value)) {
          return message;
        }
      }
      return null;
    };
  }
  
  // 數字驗證器
  static Validator<String> numeric([String message = '請輸入有效的數字']) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        if (double.tryParse(value) == null) {
          return message;
        }
      }
      return null;
    };
  }
  
  static Validator<String> range(double min, double max, [String? message]) {
    return (String? value) {
      if (value != null && value.isNotEmpty) {
        final number = double.tryParse(value);
        if (number == null) {
          return '請輸入有效的數字';
        }
        if (number < min || number > max) {
          return message ?? '數值必須在 $min 到 $max 之間';
        }
      }
      return null;
    };
  }
  
  // 組合驗證器
  static Validator<String> combine(List<Validator<String>> validators) {
    return (String? value) {
      for (final validator in validators) {
        final error = validator(value);
        if (error != null) {
          return error; // 回傳第一個錯誤
        }
      }
      return null;
    };
  }
}

// 使用表單驗證的實際範例
class UserRegistrationForm extends StatefulWidget {
  @override
  _UserRegistrationFormState createState() => _UserRegistrationFormState();
}

class _UserRegistrationFormState extends State<UserRegistrationForm> {
  final _formKey = GlobalKey<FormState>();
  final _nameController = TextEditingController();
  final _emailController = TextEditingController();
  final _phoneController = TextEditingController();
  final _passwordController = TextEditingController();
  final _confirmPasswordController = TextEditingController();
  final _ageController = TextEditingController();
  
  @override
  void dispose() {
    _nameController.dispose();
    _emailController.dispose();
    _phoneController.dispose();
    _passwordController.dispose();
    _confirmPasswordController.dispose();
    _ageController.dispose();
    super.dispose();
  }
  
  void _submitForm() {
    if (_formKey.currentState!.validate()) {
      // 表單驗證通過，處理提交邏輯
      final userData = {
        'name': _nameController.text,
        'email': _emailController.text,
        'phone': _phoneController.text,
        'age': int.parse(_ageController.text),
      };
      
      print('使用者註冊資料：$userData');
      
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('註冊成功！')),
      );
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('使用者註冊')),
      body: Padding(
        padding: EdgeInsets.all(16),
        child: Form(
          key: _formKey,
          child: SingleChildScrollView(
            child: Column(
              children: [
                // 姓名輸入
                TextFormField(
                  controller: _nameController,
                  decoration: InputDecoration(
                    labelText: '姓名',
                    prefixIcon: Icon(Icons.person),
                    border: OutlineInputBorder(),
                  ),
                  validator: FormValidators.combine([
                    FormValidators.required('請輸入姓名'),
                    FormValidators.minLength(2, '姓名至少需要 2 個字元'),
                    FormValidators.maxLength(20, '姓名不能超過 20 個字元'),
                  ]),
                ),
                
                SizedBox(height: 16),
                
                // 密碼輸入
                TextFormField(
                  controller: _passwordController,
                  obscureText: true,
                  decoration: InputDecoration(
                    labelText: '密碼',
                    prefixIcon: Icon(Icons.lock),
                    border: OutlineInputBorder(),
                  ),
                  validator: FormValidators.combine([
                    FormValidators.required('請輸入密碼'),
                    FormValidators.minLength(8, '密碼至少需要 8 個字元'),
                  ]),
                ),
                
                SizedBox(height: 16),
                
                // 確認密碼輸入
                TextFormField(
                  controller: _confirmPasswordController,
                  obscureText: true,
                  decoration: InputDecoration(
                    labelText: '確認密碼',
                    prefixIcon: Icon(Icons.lock_outline),
                    border: OutlineInputBorder(),
                  ),
                  validator: (value) {
                    if (value == null || value.isEmpty) {
                      return '請確認密碼';
                    }
                    if (value != _passwordController.text) {
                      return '密碼不一致';
                    }
                    return null;
                  },
                ),
                
                SizedBox(height: 32),
                
                // 提交按鈕
                SizedBox(
                  width: double.infinity,
                  height: 50,
                  child: ElevatedButton(
                    onPressed: _submitForm,
                    child: Text(
                      '註冊',
                      style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                    ),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}
```

### 2. **HTTP 請求與響應處理**

```dart
import 'dart:convert';
import 'package:http/http.dart' as http;

// 響應包裝類
class ApiResponse<T> {
  final bool success;
  final T? data;
  final String? error;
  final int statusCode;
  
  ApiResponse({
    required this.success,
    this.data,
    this.error,
    required this.statusCode,
  });
  
  factory ApiResponse.success(T data, int statusCode) {
    return ApiResponse<T>(
      success: true,
      data: data,
      statusCode: statusCode,
    );
  }
  
  factory ApiResponse.failure(String error, int statusCode) {
    return ApiResponse<T>(
      success: false,
      error: error,
      statusCode: statusCode,
    );
  }
}

// HTTP 服務類
class ApiService {
  static const String baseUrl = 'https://jsonplaceholder.typicode.com';
  static const Duration timeout = Duration(seconds: 30);
  
  // GET 請求 - 回傳單一物件
  static Future<ApiResponse<Map<String, dynamic>>> fetchUser(int userId) async {
    try {
      final response = await http.get(
        Uri.parse('$baseUrl/users/$userId'),
        headers: {'Content-Type': 'application/json'},
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        final Map<String, dynamic> userData = json.decode(response.body);
        return ApiResponse.success(userData, response.statusCode);
      } else {
        return ApiResponse.failure(
          '無法取得使用者資料：${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        '網路錯誤：$error',
        0,
      );
    }
  }
  
  // GET 請求 - 回傳陣列
  static Future<ApiResponse<List<Map<String, dynamic>>>> fetchUsers() async {
    try {
      final response = await http.get(
        Uri.parse('$baseUrl/users'),
        headers: {'Content-Type': 'application/json'},
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        final List<dynamic> jsonList = json.decode(response.body);
        final List<Map<String, dynamic>> users = 
            jsonList.cast<Map<String, dynamic>>();
        return ApiResponse.success(users, response.statusCode);
      } else {
        return ApiResponse.failure(
          '無法取得使用者列表：${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        '網路錯誤：$error',
        0,
      );
    }
  }
  
  // POST 請求 - 建立資源
  static Future<ApiResponse<Map<String, dynamic>>> createPost({
    required String title,
    required String body,
    required int userId,
  }) async {
    try {
      final requestBody = {
        'title': title,
        'body': body,
        'userId': userId,
      };
      
      final response = await http.post(
        Uri.parse('$baseUrl/posts'),
        headers: {'Content-Type': 'application/json'},
        body: json.encode(requestBody),
      ).timeout(timeout);
      
      if (response.statusCode == 201) {
        final Map<String, dynamic> createdPost = json.decode(response.body);
        return ApiResponse.success(createdPost, response.statusCode);
      } else {
        return ApiResponse.failure(
          '建立文章失敗：${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        '網路錯誤：$error',
        0,
      );
    }
  }
  
  // PUT 請求 - 更新資源
  static Future<ApiResponse<Map<String, dynamic>>> updatePost({
    required int postId,
    required String title,
    required String body,
    required int userId,
  }) async {
    try {
      final requestBody = {
        'id': postId,
        'title': title,
        'body': body,
        'userId': userId,
      };
      
      final response = await http.put(
        Uri.parse('$baseUrl/posts/$postId'),
        headers: {'Content-Type': 'application/json'},
        body: json.encode(requestBody),
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        final Map<String, dynamic> updatedPost = json.decode(response.body);
        return ApiResponse.success(updatedPost, response.statusCode);
      } else {
        return ApiResponse.failure(
          '更新文章失敗：${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        '網路錯誤：$error',
        0,
      );
    }
  }
  
  // DELETE 請求 - 刪除資源
  static Future<ApiResponse<bool>> deletePost(int postId) async {
    try {
      final response = await http.delete(
        Uri.parse('$baseUrl/posts/$postId'),
        headers: {'Content-Type': 'application/json'},
      ).timeout(timeout);
      
      if (response.statusCode == 200) {
        return ApiResponse.success(true, response.statusCode);
      } else {
        return ApiResponse.failure(
          '刪除文章失敗：${response.statusCode}',
          response.statusCode,
        );
      }
    } catch (error) {
      return ApiResponse.failure(
        '網路錯誤：$error',
        0,
      );
    }
  }
}

// 使用 API 服務的實際範例
class ApiDemoWidget extends StatefulWidget {
  @override
  _ApiDemoWidgetState createState() => _ApiDemoWidgetState();
}

class _ApiDemoWidgetState extends State<ApiDemoWidget> {
  List<Map<String, dynamic>> users = [];
  Map<String, dynamic>? selectedUser;
  bool isLoading = false;
  String? errorMessage;
  
  @override
  void initState() {
    super.initState();
    _loadUsers();
  }
  
  // 載入使用者列表
  Future<void> _loadUsers() async {
    setState(() {
      isLoading = true;
      errorMessage = null;
    });
    
    final response = await ApiService.fetchUsers();
    
    setState(() {
      isLoading = false;
      if (response.success) {
        users = response.data!;
      } else {
        errorMessage = response.error;
      }
    });
  }
  
  // 載入特定使用者
  Future<void> _loadUser(int userId) async {
    setState(() {
      isLoading = true;
      errorMessage = null;
    });
    
    final response = await ApiService.fetchUser(userId);
    
    setState(() {
      isLoading = false;
      if (response.success) {
        selectedUser = response.data;
      } else {
        errorMessage = response.error;
      }
    });
  }
  
  // 建立新文章
  Future<void> _createPost() async {
    setState(() {
      isLoading = true;
    });
    
    final response = await ApiService.createPost(
      title: '測試文章標題',
      body: '這是一篇測試文章的內容。',
      userId: selectedUser?['id'] ?? 1,
    );
    
    setState(() {
      isLoading = false;
    });
    
    if (response.success) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('文章建立成功！ID: ${response.data!['id']}')),
      );
    } else {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text('建立失敗：${response.error}'),
          backgroundColor: Colors.red,
        ),
      );
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('API 示例'),
        actions: [
          IconButton(
            icon: Icon(Icons.refresh),
            onPressed: _loadUsers,
          ),
        ],
      ),
      body: Column(
        children: [
          // 錯誤訊息顯示
          if (errorMessage != null)
            Container(
              width: double.infinity,
              padding: EdgeInsets.all(16),
              color: Colors.red[100],
              child: Text(
                errorMessage!,
                style: TextStyle(color: Colors.red[800]),
              ),
            ),
          
          // 載入指示器
          if (isLoading)
            LinearProgressIndicator(),
          
          // 選中的使用者資訊
          if (selectedUser != null)
            Card(
              margin: EdgeInsets.all(16),
              child: Padding(
                padding: EdgeInsets.all(16),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      '選中的使用者',
                      style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                    ),
                    SizedBox(height: 8),
                    Text('姓名：${selectedUser!['name']}'),
                    Text('電子郵件：${selectedUser!['email']}'),
                    Text('電話：${selectedUser!['phone']}'),
                    Text('網站：${selectedUser!['website']}'),
                    SizedBox(height: 16),
                    ElevatedButton(
                      onPressed: isLoading ? null : _createPost,
                      child: Text('為此使用者建立文章'),
                    ),
                  ],
                ),
              ),
            ),
          
          // 使用者列表
          Expanded(
            child: ListView.builder(
              itemCount: users.length,
              itemBuilder: (context, index) {
                final user = users[index];
                return ListTile(
                  leading: CircleAvatar(
                    child: Text(user['name'][0]),
                  ),
                  title: Text(user['name']),
                  subtitle: Text(user['email']),
                  trailing: Icon(Icons.arrow_forward_ios),
                  onTap: () => _loadUser(user['id']),
                  selected: selectedUser?['id'] == user['id'],
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}
```

### 3. **狀態管理與資料流**

```dart
// 狀態管理的不同模式

// 1. 簡單狀態（bool, int, String）
class SimpleStateExample extends StatefulWidget {
  @override
  _SimpleStateExampleState createState() => _SimpleStateExampleState();
}

class _SimpleStateExampleState extends State<SimpleStateExample> {
  // 基本狀態變數
  bool isVisible = true;
  int counter = 0;
  String message = 'Hello Flutter';
  List<String> items = ['項目1', '項目2', '項目3'];
  
  // 狀態更新方法
  void toggleVisibility() {
    setState(() {
      isVisible = !isVisible;
    });
  }
  
  void incrementCounter() {
    setState(() {
      counter++;
    });
  }
  
  void updateMessage(String newMessage) {
    setState(() {
      message = newMessage;
    });
  }
  
  void addItem(String item) {
    setState(() {
      items.add(item);
    });
  }
  
  void removeItem(int index) {
    setState(() {
      items.removeAt(index);
    });
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('簡單狀態管理')),
      body: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.stretch,
          children: [
            // 顯示/隱藏控制
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Text('顯示狀態：${isVisible ? "顯示" : "隱藏"}'),
                Switch(
                  value: isVisible,
                  onChanged: (value) => setState(() => isVisible = value),
                ),
              ],
            ),
            
            SizedBox(height: 16),
            
            // 計數器
            if (isVisible) ...[
              Card(
                child: Padding(
                  padding: EdgeInsets.all(16),
                  child: Column(
                    children: [
                      Text(
                        '計數器：$counter',
                        style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
                      ),
                      SizedBox(height: 16),
                      Row(
                        mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                        children: [
                          ElevatedButton(
                            onPressed: () => setState(() => counter--),
                            child: Icon(Icons.remove),
                          ),
                          ElevatedButton(
                            onPressed: incrementCounter,
                            child: Icon(Icons.add),
                          ),
                          ElevatedButton(
                            onPressed: () => setState(() => counter = 0),
                            child: Text('重設'),
                          ),
                        ],
                      ),
                    ],
                  ),
                ),
              ),
              
              SizedBox(height: 16),
              
              // 訊息輸入
              TextField(
                onChanged: updateMessage,
                decoration: InputDecoration(
                  labelText: '輸入訊息',
                  border: OutlineInputBorder(),
                ),
              ),
              
              SizedBox(height: 8),
              
              Text('當前訊息：$message'),
              
              SizedBox(height: 16),
              
              // 動態列表
              Row(
                children: [
                  Expanded(
                    child: TextField(
                      onSubmitted: (value) {
                        if (value.isNotEmpty) {
                          addItem(value);
                        }
                      },
                      decoration: InputDecoration(
                        labelText: '新增項目',
                        border: OutlineInputBorder(),
                      ),
                    ),
                  ),
                  SizedBox(width: 8),
                  ElevatedButton(
                    onPressed: () => addItem('項目${items.length + 1}'),
                    child: Icon(Icons.add),
                  ),
                ],
              ),
              
              SizedBox(height: 16),
            ],
            
            // 項目列表
            Expanded(
              child: ListView.builder(
                itemCount: items.length,
                itemBuilder: (context, index) {
                  return Card(
                    child: ListTile(
                      title: Text(items[index]),
                      trailing: IconButton(
                        icon: Icon(Icons.delete, color: Colors.red),
                        onPressed: () => removeItem(index),
                      ),
                    ),
                  );
                },
              ),
            ),
          ],
        ),
      ),
    );
  }
}

// 2. 複雜狀態物件
class AppState {
  final bool isLoading;
  final String? error;
  final List<Map<String, dynamic>> users;
  final Map<String, dynamic>? selectedUser;
  final Map<String, dynamic> settings;
  
  AppState({
    this.isLoading = false,
    this.error,
    this.users = const [],
    this.selectedUser,
    this.settings = const {},
  });
  
  // 建立新狀態的便利方法
  AppState copyWith({
    bool? isLoading,
    String? error,
    List<Map<String, dynamic>>? users,
    Map<String, dynamic>? selectedUser,
    Map<String, dynamic>? settings,
  }) {
    return AppState(
      isLoading: isLoading ?? this.isLoading,
      error: error ?? this.error,
      users: users ?? this.users,
      selectedUser: selectedUser ?? this.selectedUser,
      settings: settings ?? this.settings,
    );
  }
  
  // 清除錯誤
  AppState clearError() {
    return copyWith(error: null);
  }
  
  // 設定載入狀態
  AppState setLoading(bool loading) {
    return copyWith(isLoading: loading, error: null);
  }
  
  // 設定錯誤
  AppState setError(String errorMessage) {
    return copyWith(isLoading: false, error: errorMessage);
  }
  
  // 設定使用者列表
  AppState setUsers(List<Map<String, dynamic>> userList) {
    return copyWith(isLoading: false, users: userList, error: null);
  }
  
  // 選擇使用者
  AppState selectUser(Map<String, dynamic> user) {
    return copyWith(selectedUser: user);
  }
  
  // 更新設定
  AppState updateSettings(Map<String, dynamic> newSettings) {
    final updatedSettings = Map<String, dynamic>.from(settings);
    updatedSettings.addAll(newSettings);
    return copyWith(settings: updatedSettings);
  }
}

// 使用複雜狀態物件的 Widget
class ComplexStateExample extends StatefulWidget {
  @override
  _ComplexStateExampleState createState() => _ComplexStateExampleState();
}

class _ComplexStateExampleState extends State<ComplexStateExample> {
  AppState _state = AppState(
    settings: {
      'theme': 'light',
      'language': 'zh_TW',
      'notifications': true,
    },
  );
  
  // 更新狀態的統一方法
  void _updateState(AppState newState) {
    setState(() {
      _state = newState;
    });
  }
  
  // 載入使用者資料
  Future<void> _loadUsers() async {
    _updateState(_state.setLoading(true));
    
    try {
      // 模擬 API 呼叫
      await Future.delayed(Duration(seconds: 2));
      
      // 模擬資料
      final users = [
        {'id': 1, 'name': '張小明', 'email': 'ming@example.com'},
        {'id': 2, 'name': '李小華', 'email': 'hua@example.com'},
        {'id': 3, 'name': '王小美', 'email': 'mei@example.com'},
      ];
      
      _updateState(_state.setUsers(users));
    } catch (error) {
      _updateState(_state.setError('載入使用者失敗：$error'));
    }
  }
  
  // 選擇使用者
  void _selectUser(Map<String, dynamic> user) {
    _updateState(_state.selectUser(user));
  }
  
  // 更新設定
  void _updateSetting(String key, dynamic value) {
    _updateState(_state.updateSettings({key: value}));
  }
  
  // 清除錯誤
  void _clearError() {
    _updateState(_state.clearError());
  }
  
  @override
  void initState() {
    super.initState();
    _loadUsers();
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('複雜狀態管理'),
        actions: [
          IconButton(
            icon: Icon(Icons.refresh),
            onPressed: _loadUsers,
          ),
        ],
      ),
      body: Column(
        children: [
          // 錯誤顯示
          if (_state.error != null)
            Container(
              width: double.infinity,
              padding: EdgeInsets.all(16),
              color: Colors.red[100],
              child: Row(
                children: [
                  Expanded(
                    child: Text(
                      _state.error!,
                      style: TextStyle(color: Colors.red[800]),
                    ),
                  ),
                  IconButton(
                    icon: Icon(Icons.close),
                    onPressed: _clearError,
                  ),
                ],
              ),
            ),
          
          // 載入指示器
          if (_state.isLoading)
            LinearProgressIndicator(),
          
          // 設定區域
          Card(
            margin: EdgeInsets.all(16),
            child: Padding(
              padding: EdgeInsets.all(16),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    '應用程式設定',
                    style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                  ),
                  SizedBox(height: 16),
                  
                  // 主題設定
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text('主題模式'),
                      DropdownButton<String>(
                        value: _state.settings['theme'],
                        items: [
                          DropdownMenuItem(value: 'light', child: Text('淺色')),
                          DropdownMenuItem(value: 'dark', child: Text('深色')),
                          DropdownMenuItem(value: 'auto', child: Text('自動')),
                        ],
                        onChanged: (value) => _updateSetting('theme', value),
                      ),
                    ],
                  ),
                  
                  // 通知設定
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text('推送通知'),
                      Switch(
                        value: _state.settings['notifications'] ?? false,
                        onChanged: (value) => _updateSetting('notifications', value),
                      ),
                    ],
                  ),
                ],
              ),
            ),
          ),
          
          // 選中的使用者
          if (_state.selectedUser != null)
            Card(
              margin: EdgeInsets.symmetric(horizontal: 16),
              child: ListTile(
                leading: CircleAvatar(
                  child: Text(_state.selectedUser!['name'][0]),
                ),
                title: Text(_state.selectedUser!['name']),
                subtitle: Text(_state.selectedUser!['email']),
                trailing: Icon(Icons.star, color: Colors.amber),
              ),
            ),
          
          // 使用者列表
          Expanded(
            child: ListView.builder(
              itemCount: _state.users.length,
              itemBuilder: (context, index) {
                final user = _state.users[index];
                final isSelected = _state.selectedUser?['id'] == user['id'];
                
                return ListTile(
                  leading: CircleAvatar(
                    child: Text(user['name'][0]),
                    backgroundColor: isSelected ? Colors.blue : Colors.grey,
                  ),
                  title: Text(user['name']),
                  subtitle: Text(user['email']),
                  trailing: isSelected ? Icon(Icons.check, color: Colors.blue) : null,
                  onTap: () => _selectUser(user),
                  selected: isSelected,
                );
              },
            ),
          ),
          
          // 狀態資訊顯示（僅供開發時查看）
          Container(
            width: double.infinity,
            padding: EdgeInsets.all(16),
            color: Colors.grey[100],
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text('當前狀態：'),
                Text('載入中：${_state.isLoading}'),
                Text('錯誤：${_state.error ?? "無"}'),
                Text('使用者數量：${_state.users.length}'),
                Text('選中使用者：${_state.selectedUser?['name'] ?? "無"}'),
                Text('設定：${_state.settings.toString()}'),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
```

------

## 🎯 總結與最佳實踐

### 型別使用原則

```dart
// ✅ 良好的型別使用
class GoodPractice {
  // 1. 明確的型別宣告
  final String userName;              // 清楚的變數型別
  final List<String> hobbies;         // 泛型型別明確
  final Map<String, int> scores;      // 鍵值型別都明確
  
  // 2. 函數回傳型別明確
  String getFullName(String first, String last) {
    return '$first $last';
  }
  
  Future<List<String>> fetchNotifications() async {
    // 異步操作回傳明確型別
    return ['通知1', '通知2'];
  }
  
  // 3. 使用可為空型別來表達意圖
  String? findUserById(String id) {
    // 可能找不到，回傳 null
    return null;
  }
  
  // 4. 泛型的合理使用
  T processData<T>(T input, T Function(T) processor) {
    return processor(input);
  }
}

// ❌ 避免的不良實踐
class BadPractice {
  // 1. 過度使用 dynamic
  dynamic userData;  // 不清楚資料結構
  
  // 2. 回傳型別不明確
  get someData => userData;  // 不知道回傳什麼
  
  // 3. 沒有處理 null 的情況
  String getName() {
    return userData['name'];  // 可能拋出異常
  }
  
  // 4. 泛型使用不當
  processStuff(stuff) {  // 沒有型別資訊
    return stuff;
  }
}
```

### 開發建議

1. **總是使用明確的型別宣告**
   - 提高程式碼可讀性
   - 獲得更好的 IDE 支援
   - 避免執行時型別錯誤
2. **善用 Null Safety**
   - 使用 `?` 表示可為空的型別
   - 使用 `??` 運算子提供預設值
   - 在確定不為 null 時才使用 `!`
3. **合理使用泛型**
   - 提高程式碼重用性
   - 保持型別安全
   - 使 API 更加靈活
4. **異步程式設計最佳實踐**
   - 使用 `Future<T>` 表示異步操作
   - 適當處理錯誤情況
   - 使用 `async/await` 讓程式碼更易讀

記住，良好的型別使用不僅能讓程式碼更安全，還能讓其他開發者（包括未來的自己）更容易理解和維護程式碼！

### 🎉 恭喜！

現在你已經掌握了 Dart 中各種資料型別的使用方法。這些不是函數，而是描述資料的型別系統。理解這些型別將幫助你：

- 寫出更安全的程式碼
- 獲得更好的開發體驗
- 避免常見的執行時錯誤
- 建構更健壯的 Flutter 應用程式

繼續練習和探索，你將成為 Flutter 開發的專家！🚀