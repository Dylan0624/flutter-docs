# Flutter å°ˆæ¡ˆè¨­è¨ˆèˆ‡æ¶æ§‹ç®¡ç†å®Œå…¨æŒ‡å—

## ğŸ—ï¸ å°ˆæ¡ˆæ¶æ§‹æ¦‚è¦½

### ç‚ºä»€éº¼éœ€è¦å¥½çš„å°ˆæ¡ˆæ¶æ§‹ï¼Ÿ

ä¸€å€‹å¥½çš„å°ˆæ¡ˆæ¶æ§‹èƒ½å¤ ï¼š

- ğŸ¯ **æé«˜é–‹ç™¼æ•ˆç‡**ï¼šæ¸…æ™°çš„çµæ§‹è®“åŠŸèƒ½é–‹ç™¼æ›´å¿«é€Ÿ
- ğŸ”§ **ä¾¿æ–¼ç¶­è­·**ï¼šæ˜“æ–¼ç†è§£å’Œä¿®æ”¹ç¾æœ‰åŠŸèƒ½
- ğŸ‘¥ **åœ˜éšŠå”ä½œ**ï¼šçµ±ä¸€çš„æ¶æ§‹è¦ç¯„è®“å¤šäººå”ä½œæ›´é †æš¢
- ğŸš€ **å¯æ“´å±•æ€§**ï¼šéš¨è‘—å°ˆæ¡ˆæˆé•·èƒ½å¤ è¼•é¬†æ·»åŠ æ–°åŠŸèƒ½
- ğŸ§ª **å¯æ¸¬è©¦æ€§**ï¼šæ¸…æ™°çš„åˆ†å±¤è®“å–®å…ƒæ¸¬è©¦æ›´å®¹æ˜“ç·¨å¯«

### æ¶æ§‹è¨­è¨ˆåŸå‰‡

1. **å–®ä¸€è·è²¬åŸå‰‡**ï¼šæ¯å€‹é¡åˆ¥æˆ–æ¨¡çµ„åªè² è²¬ä¸€å€‹åŠŸèƒ½
2. **é–‹æ”¾å°é–‰åŸå‰‡**ï¼šå°æ“´å±•é–‹æ”¾ï¼Œå°ä¿®æ”¹å°é–‰
3. **ä¾è³´å€’ç½®åŸå‰‡**ï¼šé«˜å±¤æ¨¡çµ„ä¸ä¾è³´ä½å±¤æ¨¡çµ„
4. **é—œæ³¨é»åˆ†é›¢**ï¼šUIã€æ¥­å‹™é‚è¼¯ã€è³‡æ–™å±¤åˆ†é›¢
5. **å¯æ¸¬è©¦æ€§**ï¼šæ¶æ§‹è¨­è¨ˆè¦ä¾¿æ–¼å–®å…ƒæ¸¬è©¦

------

## ğŸ“ å°ˆæ¡ˆç›®éŒ„çµæ§‹è¨­è¨ˆ

### å®Œæ•´çš„å°ˆæ¡ˆç›®éŒ„æ¶æ§‹

```
my_flutter_app/
â”œâ”€â”€ android/                    # Android å¹³å°ç‰¹å®šæª”æ¡ˆ
â”œâ”€â”€ ios/                        # iOS å¹³å°ç‰¹å®šæª”æ¡ˆ
â”œâ”€â”€ web/                        # Web å¹³å°ç‰¹å®šæª”æ¡ˆ
â”œâ”€â”€ assets/                     # è³‡æºæª”æ¡ˆ
â”‚   â”œâ”€â”€ images/                 # åœ–ç‰‡è³‡æº
â”‚   â”‚   â”œâ”€â”€ icons/             # åœ–æ¨™
â”‚   â”‚   â”œâ”€â”€ backgrounds/       # èƒŒæ™¯åœ–
â”‚   â”‚   â””â”€â”€ logos/             # æ¨™èªŒåœ–ç‰‡
â”‚   â”œâ”€â”€ fonts/                 # å­—å‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ data/                  # éœæ…‹è³‡æ–™æª”æ¡ˆ
â”‚   â”‚   â”œâ”€â”€ json/              # JSON è³‡æ–™
â”‚   â”‚   â””â”€â”€ translations/      # å¤šèªè¨€æª”æ¡ˆ
â”‚   â””â”€â”€ animations/            # å‹•ç•«æª”æ¡ˆ
â”‚       â”œâ”€â”€ lottie/           # Lottie å‹•ç•«
â”‚       â””â”€â”€ rive/             # Rive å‹•ç•«
â”œâ”€â”€ lib/                       # ä¸»è¦ç¨‹å¼ç¢¼ç›®éŒ„ ğŸ”¥
â”‚   â”œâ”€â”€ main.dart             # æ‡‰ç”¨ç¨‹å¼å…¥å£
â”‚   â”œâ”€â”€ app.dart              # ä¸»æ‡‰ç”¨ç¨‹å¼ Widget
â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ constants/        # å¸¸æ•¸å®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ app_constants.dart      # æ‡‰ç”¨ç¨‹å¼å¸¸æ•¸
â”‚   â”‚   â”‚   â”œâ”€â”€ api_constants.dart      # API ç›¸é—œå¸¸æ•¸
â”‚   â”‚   â”‚   â”œâ”€â”€ storage_constants.dart  # å„²å­˜ç›¸é—œå¸¸æ•¸
â”‚   â”‚   â”‚   â””â”€â”€ route_constants.dart    # è·¯ç”±å¸¸æ•¸
â”‚   â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ app_config.dart         # æ‡‰ç”¨ç¨‹å¼é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ environment_config.dart # ç’°å¢ƒé…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ theme_config.dart       # ä¸»é¡Œé…ç½®
â”‚   â”‚   â”œâ”€â”€ errors/           # éŒ¯èª¤è™•ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ app_error.dart          # æ‡‰ç”¨ç¨‹å¼éŒ¯èª¤å®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ error_handler.dart      # éŒ¯èª¤è™•ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ exceptions.dart         # è‡ªè¨‚ä¾‹å¤–
â”‚   â”‚   â”œâ”€â”€ network/          # ç¶²è·¯å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ api_client.dart         # API å®¢æˆ¶ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ interceptors.dart       # è«‹æ±‚æ””æˆªå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ network_info.dart       # ç¶²è·¯ç‹€æ…‹æª¢æŸ¥
â”‚   â”‚   â”‚   â””â”€â”€ response_wrapper.dart   # éŸ¿æ‡‰åŒ…è£å™¨
â”‚   â”‚   â”œâ”€â”€ storage/          # æœ¬åœ°å„²å­˜
â”‚   â”‚   â”‚   â”œâ”€â”€ local_storage.dart      # æœ¬åœ°å„²å­˜ä»‹é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ shared_prefs_storage.dart # SharedPreferences å¯¦ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ secure_storage.dart     # å®‰å…¨å„²å­˜
â”‚   â”‚   â”‚   â””â”€â”€ database/               # è³‡æ–™åº«ç›¸é—œ
â”‚   â”‚   â”‚       â”œâ”€â”€ app_database.dart   # è³‡æ–™åº«å®šç¾©
â”‚   â”‚   â”‚       â”œâ”€â”€ dao/                # è³‡æ–™å­˜å–ç‰©ä»¶
â”‚   â”‚   â”‚       â””â”€â”€ entities/           # è³‡æ–™åº«å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ utils/            # å·¥å…·é¡åˆ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ date_utils.dart         # æ—¥æœŸå·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ validation_utils.dart   # é©—è­‰å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ format_utils.dart       # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ permission_utils.dart   # æ¬Šé™å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ image_utils.dart        # åœ–ç‰‡è™•ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ extensions/       # æ“´å±•æ–¹æ³•
â”‚   â”‚   â”‚   â”œâ”€â”€ string_extensions.dart  # å­—ä¸²æ“´å±•
â”‚   â”‚   â”‚   â”œâ”€â”€ date_extensions.dart    # æ—¥æœŸæ“´å±•
â”‚   â”‚   â”‚   â”œâ”€â”€ context_extensions.dart # BuildContext æ“´å±•
â”‚   â”‚   â”‚   â””â”€â”€ widget_extensions.dart  # Widget æ“´å±•
â”‚   â”‚   â””â”€â”€ injection/        # ä¾è³´æ³¨å…¥
â”‚   â”‚       â”œâ”€â”€ injection.dart          # ä¾è³´æ³¨å…¥é…ç½®
â”‚   â”‚       â””â”€â”€ injection.config.dart   # ç”Ÿæˆçš„é…ç½®æª”æ¡ˆ
â”‚   â”œâ”€â”€ data/                 # è³‡æ–™å±¤ (Repository Pattern)
â”‚   â”‚   â”œâ”€â”€ repositories/     # å„²å­˜åº«å¯¦ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_repository_impl.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repository_impl.dart
â”‚   â”‚   â”‚   â””â”€â”€ product_repository_impl.dart
â”‚   â”‚   â”œâ”€â”€ datasources/      # è³‡æ–™æº
â”‚   â”‚   â”‚   â”œâ”€â”€ remote/       # é ç«¯è³‡æ–™æº
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth_remote_datasource.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user_remote_datasource.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ product_remote_datasource.dart
â”‚   â”‚   â”‚   â””â”€â”€ local/        # æœ¬åœ°è³‡æ–™æº
â”‚   â”‚   â”‚       â”œâ”€â”€ auth_local_datasource.dart
â”‚   â”‚   â”‚       â”œâ”€â”€ user_local_datasource.dart
â”‚   â”‚   â”‚       â””â”€â”€ product_local_datasource.dart
â”‚   â”‚   â””â”€â”€ models/           # è³‡æ–™æ¨¡å‹ (DTO)
â”‚   â”‚       â”œâ”€â”€ request/      # è«‹æ±‚æ¨¡å‹
â”‚   â”‚       â”‚   â”œâ”€â”€ login_request.dart
â”‚   â”‚       â”‚   â””â”€â”€ register_request.dart
â”‚   â”‚       â”œâ”€â”€ response/     # éŸ¿æ‡‰æ¨¡å‹
â”‚   â”‚       â”‚   â”œâ”€â”€ login_response.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ user_response.dart
â”‚   â”‚       â”‚   â””â”€â”€ product_response.dart
â”‚   â”‚       â””â”€â”€ local/        # æœ¬åœ°æ¨¡å‹
â”‚   â”‚           â”œâ”€â”€ user_local_model.dart
â”‚   â”‚           â””â”€â”€ product_local_model.dart
â”‚   â”œâ”€â”€ domain/               # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”‚   â”œâ”€â”€ entities/         # æ¥­å‹™å¯¦é«”
â”‚   â”‚   â”‚   â”œâ”€â”€ user.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ product.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ order.dart
â”‚   â”‚   â”‚   â””â”€â”€ auth_token.dart
â”‚   â”‚   â”œâ”€â”€ repositories/     # å„²å­˜åº«æŠ½è±¡ä»‹é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_repository.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repository.dart
â”‚   â”‚   â”‚   â””â”€â”€ product_repository.dart
â”‚   â”‚   â””â”€â”€ usecases/         # ç”¨ä¾‹ (æ¥­å‹™é‚è¼¯)
â”‚   â”‚       â”œâ”€â”€ auth/         # èªè­‰ç›¸é—œç”¨ä¾‹
â”‚   â”‚       â”‚   â”œâ”€â”€ login_usecase.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ logout_usecase.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ register_usecase.dart
â”‚   â”‚       â”‚   â””â”€â”€ refresh_token_usecase.dart
â”‚   â”‚       â”œâ”€â”€ user/         # ä½¿ç”¨è€…ç›¸é—œç”¨ä¾‹
â”‚   â”‚       â”‚   â”œâ”€â”€ get_user_profile_usecase.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ update_user_profile_usecase.dart
â”‚   â”‚       â”‚   â””â”€â”€ delete_user_account_usecase.dart
â”‚   â”‚       â””â”€â”€ product/      # ç”¢å“ç›¸é—œç”¨ä¾‹
â”‚   â”‚           â”œâ”€â”€ get_products_usecase.dart
â”‚   â”‚           â”œâ”€â”€ search_products_usecase.dart
â”‚   â”‚           â””â”€â”€ get_product_detail_usecase.dart
â”‚   â”œâ”€â”€ presentation/         # è¡¨ç¾å±¤ (UI)
â”‚   â”‚   â”œâ”€â”€ pages/            # é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/         # èªè­‰é é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login_page.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ register_page.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ forgot_password_page.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ home/         # é¦–é ç›¸é—œ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ home_page.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dashboard_page.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/      # å€‹äººè³‡æ–™é é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ profile_page.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ edit_profile_page.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ settings_page.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ product/      # ç”¢å“é é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ product_list_page.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ product_detail_page.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ product_search_page.dart
â”‚   â”‚   â”‚   â””â”€â”€ common/       # é€šç”¨é é¢
â”‚   â”‚   â”‚       â”œâ”€â”€ splash_page.dart
â”‚   â”‚   â”‚       â”œâ”€â”€ onboarding_page.dart
â”‚   â”‚   â”‚       â”œâ”€â”€ error_page.dart
â”‚   â”‚   â”‚       â””â”€â”€ no_internet_page.dart
â”‚   â”‚   â”œâ”€â”€ widgets/          # å¯é‡ç”¨ Widget
â”‚   â”‚   â”‚   â”œâ”€â”€ common/       # é€šç”¨ Widget
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_button.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_text_field.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_card.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_loading.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_error.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app_empty_state.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ app_image.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ forms/        # è¡¨å–®ç›¸é—œ Widget
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login_form.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ register_form.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ profile_form.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ lists/        # åˆ—è¡¨ç›¸é—œ Widget
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ product_list_item.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user_list_item.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ infinite_scroll_list.dart
â”‚   â”‚   â”‚   â””â”€â”€ dialogs/      # å°è©±æ¡† Widget
â”‚   â”‚   â”‚       â”œâ”€â”€ confirmation_dialog.dart
â”‚   â”‚   â”‚       â”œâ”€â”€ loading_dialog.dart
â”‚   â”‚   â”‚       â””â”€â”€ info_dialog.dart
â”‚   â”‚   â”œâ”€â”€ providers/        # ç‹€æ…‹ç®¡ç† (ä½¿ç”¨ Provider)
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_provider.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ user_provider.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ product_provider.dart
â”‚   â”‚   â”‚   â””â”€â”€ theme_provider.dart
â”‚   â”‚   â”œâ”€â”€ blocs/            # ç‹€æ…‹ç®¡ç† (ä½¿ç”¨ Blocï¼Œå¯é¸)
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth_bloc.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth_event.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth_state.dart
â”‚   â”‚   â”‚   â””â”€â”€ product/
â”‚   â”‚   â”‚       â”œâ”€â”€ product_bloc.dart
â”‚   â”‚   â”‚       â”œâ”€â”€ product_event.dart
â”‚   â”‚   â”‚       â””â”€â”€ product_state.dart
â”‚   â”‚   â””â”€â”€ routes/           # è·¯ç”±ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ app_router.dart          # ä¸»è·¯ç”±é…ç½®
â”‚   â”‚       â”œâ”€â”€ route_names.dart         # è·¯ç”±åç¨±å¸¸æ•¸
â”‚   â”‚       â””â”€â”€ route_guards.dart        # è·¯ç”±å®ˆè¡›
â”‚   â””â”€â”€ l10n/                 # åœ‹éš›åŒ–
â”‚       â”œâ”€â”€ app_localizations.dart      # æœ¬åœ°åŒ–ä¸»æª”æ¡ˆ
â”‚       â”œâ”€â”€ app_localizations_en.dart   # è‹±æ–‡
â”‚       â”œâ”€â”€ app_localizations_zh.dart   # ä¸­æ–‡
â”‚       â””â”€â”€ l10n.yaml                   # é…ç½®æª”æ¡ˆ
â”œâ”€â”€ test/                     # æ¸¬è©¦æª”æ¡ˆ
â”‚   â”œâ”€â”€ unit/                 # å–®å…ƒæ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â””â”€â”€ usecases/
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚       â””â”€â”€ providers/
â”‚   â”œâ”€â”€ widget/               # Widget æ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”œâ”€â”€ integration/          # æ•´åˆæ¸¬è©¦
â”‚   â””â”€â”€ helpers/              # æ¸¬è©¦è¼”åŠ©å·¥å…·
â”‚       â”œâ”€â”€ test_helper.dart
â”‚       â””â”€â”€ mock_data.dart
â”œâ”€â”€ tool/                     # é–‹ç™¼å·¥å…·
â”‚   â”œâ”€â”€ build_runner.dart     # ç¨‹å¼ç¢¼ç”Ÿæˆå·¥å…·
â”‚   â”œâ”€â”€ env_generator.dart    # ç’°å¢ƒæª”æ¡ˆç”Ÿæˆå™¨
â”‚   â””â”€â”€ icon_generator.dart   # åœ–æ¨™ç”Ÿæˆå™¨
â”œâ”€â”€ docs/                     # å°ˆæ¡ˆæ–‡æª”
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ CHANGELOG.md
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ DEPLOYMENT.md
â”œâ”€â”€ scripts/                  # å»ºç½®è…³æœ¬
â”‚   â”œâ”€â”€ build_android.sh
â”‚   â”œâ”€â”€ build_ios.sh
â”‚   â””â”€â”€ deploy.sh
â”œâ”€â”€ .github/                  # GitHub å·¥ä½œæµç¨‹
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml
â”‚       â””â”€â”€ cd.yml
â”œâ”€â”€ pubspec.yaml             # å¥—ä»¶ä¾è³´é…ç½®
â”œâ”€â”€ pubspec.lock             # é–å®šçš„å¥—ä»¶ç‰ˆæœ¬
â”œâ”€â”€ analysis_options.yaml    # ç¨‹å¼ç¢¼åˆ†æé…ç½®
â”œâ”€â”€ .gitignore              # Git å¿½ç•¥æª”æ¡ˆ
â”œâ”€â”€ .env.example            # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ .metadata               # Flutter å°ˆæ¡ˆå…ƒè³‡æ–™
â””â”€â”€ README.md               # å°ˆæ¡ˆèªªæ˜
```

------

## ğŸ›ï¸ MVVM æ¶æ§‹æ¨¡å¼å¯¦ä½œ

### MVVM æ¶æ§‹å±¤æ¬¡

```dart
// ğŸ“Š Model Layer (è³‡æ–™å±¤)
// ä½ç½®: lib/data/ å’Œ lib/domain/

// 1. Entity (æ¥­å‹™å¯¦é«”) - domain/entities/
class User {
  final String id;
  final String name;
  final String email;
  final DateTime? lastLoginAt;
  final UserStatus status;
  
  const User({
    required this.id,
    required this.name,
    required this.email,
    this.lastLoginAt,
    required this.status,
  });
  
  // æ¥­å‹™é‚è¼¯æ–¹æ³•
  bool get isActive => status == UserStatus.active;
  bool get isNewUser => lastLoginAt == null;
  
  String get displayName => name.isNotEmpty ? name : email.split('@').first;
  
  // è¤‡è£½æ–¹æ³• (ç”¨æ–¼ä¸å¯è®Šç‰©ä»¶)
  User copyWith({
    String? id,
    String? name,
    String? email,
    DateTime? lastLoginAt,
    UserStatus? status,
  }) {
    return User(
      id: id ?? this.id,
      name: name ?? this.name,
      email: email ?? this.email,
      lastLoginAt: lastLoginAt ?? this.lastLoginAt,
      status: status ?? this.status,
    );
  }
  
  @override
  bool operator ==(Object other) =>
      identical(this, other) ||
      other is User && runtimeType == other.runtimeType && id == other.id;
  
  @override
  int get hashCode => id.hashCode;
}

enum UserStatus { active, inactive, banned, pending }

// 2. Data Model (è³‡æ–™å‚³è¼¸ç‰©ä»¶) - data/models/
class UserResponse {
  final String id;
  final String name;
  final String email;
  final String? lastLoginAt;
  final String status;
  
  UserResponse({
    required this.id,
    required this.name,
    required this.email,
    this.lastLoginAt,
    required this.status,
  });
  
  // JSON åºåˆ—åŒ–
  factory UserResponse.fromJson(Map<String, dynamic> json) {
    return UserResponse(
      id: json['id'] as String,
      name: json['name'] as String,
      email: json['email'] as String,
      lastLoginAt: json['last_login_at'] as String?,
      status: json['status'] as String,
    );
  }
  
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'name': name,
      'email': email,
      'last_login_at': lastLoginAt,
      'status': status,
    };
  }
  
  // è½‰æ›ç‚ºæ¥­å‹™å¯¦é«”
  User toEntity() {
    return User(
      id: id,
      name: name,
      email: email,
      lastLoginAt: lastLoginAt != null 
          ? DateTime.tryParse(lastLoginAt!) 
          : null,
      status: _parseStatus(status),
    );
  }
  
  UserStatus _parseStatus(String status) {
    switch (status.toLowerCase()) {
      case 'active':
        return UserStatus.active;
      case 'inactive':
        return UserStatus.inactive;
      case 'banned':
        return UserStatus.banned;
      case 'pending':
        return UserStatus.pending;
      default:
        return UserStatus.inactive;
    }
  }
}

// 3. Repository Interface (æŠ½è±¡å„²å­˜åº«) - domain/repositories/
abstract class UserRepository {
  Future<User?> getUserById(String id);
  Future<List<User>> getUsers({int page = 1, int limit = 20});
  Future<User> createUser(User user);
  Future<User> updateUser(User user);
  Future<void> deleteUser(String id);
  Future<List<User>> searchUsers(String query);
  Stream<User> getUserStream(String id);
}

// 4. Repository Implementation (å„²å­˜åº«å¯¦ä½œ) - data/repositories/
class UserRepositoryImpl implements UserRepository {
  final UserRemoteDataSource _remoteDataSource;
  final UserLocalDataSource _localDataSource;
  final NetworkInfo _networkInfo;
  
  UserRepositoryImpl({
    required UserRemoteDataSource remoteDataSource,
    required UserLocalDataSource localDataSource,
    required NetworkInfo networkInfo,
  }) : _remoteDataSource = remoteDataSource,
       _localDataSource = localDataSource,
       _networkInfo = networkInfo;
  
  @override
  Future<User?> getUserById(String id) async {
    try {
      // å…ˆå¾æœ¬åœ°å¿«å–å–å¾—
      final localUser = await _localDataSource.getUserById(id);
      
      if (await _networkInfo.isConnected) {
        // æœ‰ç¶²è·¯æ™‚å¾é ç«¯æ›´æ–°
        final remoteUser = await _remoteDataSource.getUserById(id);
        if (remoteUser != null) {
          // æ›´æ–°æœ¬åœ°å¿«å–
          await _localDataSource.cacheUser(remoteUser);
          return remoteUser.toEntity();
        }
      }
      
      return localUser?.toEntity();
    } catch (error) {
      throw UserException('ç„¡æ³•å–å¾—ä½¿ç”¨è€…è³‡æ–™: $error');
    }
  }
  
  @override
  Future<List<User>> getUsers({int page = 1, int limit = 20}) async {
    try {
      if (await _networkInfo.isConnected) {
        final remoteUsers = await _remoteDataSource.getUsers(
          page: page,
          limit: limit,
        );
        
        // å¿«å–è³‡æ–™
        await _localDataSource.cacheUsers(remoteUsers);
        
        return remoteUsers.map((user) => user.toEntity()).toList();
      } else {
        // é›¢ç·šæ™‚å¾æœ¬åœ°å–å¾—
        final localUsers = await _localDataSource.getCachedUsers(
          page: page,
          limit: limit,
        );
        return localUsers.map((user) => user.toEntity()).toList();
      }
    } catch (error) {
      throw UserException('ç„¡æ³•å–å¾—ä½¿ç”¨è€…åˆ—è¡¨: $error');
    }
  }
  
  @override
  Future<User> createUser(User user) async {
    try {
      if (!await _networkInfo.isConnected) {
        throw NetworkException('å»ºç«‹ä½¿ç”¨è€…éœ€è¦ç¶²è·¯é€£ç·š');
      }
      
      final userResponse = UserResponse(
        id: user.id,
        name: user.name,
        email: user.email,
        lastLoginAt: user.lastLoginAt?.toIso8601String(),
        status: user.status.toString().split('.').last,
      );
      
      final createdUser = await _remoteDataSource.createUser(userResponse);
      
      // å¿«å–æ–°å»ºç«‹çš„ä½¿ç”¨è€…
      await _localDataSource.cacheUser(createdUser);
      
      return createdUser.toEntity();
    } catch (error) {
      throw UserException('å»ºç«‹ä½¿ç”¨è€…å¤±æ•—: $error');
    }
  }
  
  // å…¶ä»–æ–¹æ³•å¯¦ä½œ...
}
```

### ViewModel Layer (è¡¨ç¾é‚è¼¯å±¤)

```dart
// ğŸ“± ViewModel (ä½¿ç”¨ ChangeNotifier)
// ä½ç½®: lib/presentation/providers/

class UserViewModel extends ChangeNotifier {
  final GetUserProfileUseCase _getUserProfileUseCase;
  final UpdateUserProfileUseCase _updateUserProfileUseCase;
  final DeleteUserAccountUseCase _deleteUserAccountUseCase;
  
  UserViewModel({
    required GetUserProfileUseCase getUserProfileUseCase,
    required UpdateUserProfileUseCase updateUserProfileUseCase,
    required DeleteUserAccountUseCase deleteUserAccountUseCase,
  }) : _getUserProfileUseCase = getUserProfileUseCase,
       _updateUserProfileUseCase = updateUserProfileUseCase,
       _deleteUserAccountUseCase = deleteUserAccountUseCase;
  
  // ç‹€æ…‹è®Šæ•¸
  User? _user;
  bool _isLoading = false;
  String? _errorMessage;
  bool _isUpdating = false;
  
  // Getters (æš´éœ²çµ¦ View)
  User? get user => _user;
  bool get isLoading => _isLoading;
  String? get errorMessage => _errorMessage;
  bool get isUpdating => _isUpdating;
  bool get hasUser => _user != null;
  
  // æ¥­å‹™é‚è¼¯æ–¹æ³•
  Future<void> loadUserProfile(String userId) async {
    _setLoading(true);
    _clearError();
    
    try {
      final result = await _getUserProfileUseCase.execute(userId);
      result.fold(
        (failure) => _setError(failure.message),
        (user) => _setUser(user),
      );
    } catch (error) {
      _setError('è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™å¤±æ•—: $error');
    } finally {
      _setLoading(false);
    }
  }
  
  Future<void> updateProfile({
    required String name,
    required String email,
  }) async {
    if (_user == null) return;
    
    _setUpdating(true);
    _clearError();
    
    try {
      final updatedUser = _user!.copyWith(name: name, email: email);
      final result = await _updateUserProfileUseCase.execute(updatedUser);
      
      result.fold(
        (failure) => _setError(failure.message),
        (user) {
          _setUser(user);
          _showSuccessMessage('å€‹äººè³‡æ–™æ›´æ–°æˆåŠŸ');
        },
      );
    } catch (error) {
      _setError('æ›´æ–°å€‹äººè³‡æ–™å¤±æ•—: $error');
    } finally {
      _setUpdating(false);
    }
  }
  
  Future<bool> deleteAccount() async {
    if (_user == null) return false;
    
    _setLoading(true);
    _clearError();
    
    try {
      final result = await _deleteUserAccountUseCase.execute(_user!.id);
      return result.fold(
        (failure) {
          _setError(failure.message);
          return false;
        },
        (_) {
          _clearUser();
          return true;
        },
      );
    } catch (error) {
      _setError('åˆªé™¤å¸³è™Ÿå¤±æ•—: $error');
      return false;
    } finally {
      _setLoading(false);
    }
  }
  
  // é‡æ–°è¼‰å…¥è³‡æ–™
  Future<void> refresh() async {
    if (_user != null) {
      await loadUserProfile(_user!.id);
    }
  }
  
  // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
  void clearError() {
    _clearError();
  }
  
  // ç§æœ‰æ–¹æ³• (ç‹€æ…‹ç®¡ç†)
  void _setUser(User user) {
    _user = user;
    notifyListeners();
  }
  
  void _clearUser() {
    _user = null;
    notifyListeners();
  }
  
  void _setLoading(bool loading) {
    _isLoading = loading;
    notifyListeners();
  }
  
  void _setUpdating(bool updating) {
    _isUpdating = updating;
    notifyListeners();
  }
  
  void _setError(String error) {
    _errorMessage = error;
    notifyListeners();
  }
  
  void _clearError() {
    _errorMessage = null;
    notifyListeners();
  }
  
  void _showSuccessMessage(String message) {
    // å¯ä»¥é€šéäº‹ä»¶ç³»çµ±æˆ–å…¶ä»–æ–¹å¼é€šçŸ¥ UI é¡¯ç¤ºæˆåŠŸè¨Šæ¯
    // é€™è£¡å¯ä»¥ä½¿ç”¨ EventBus æˆ–å…¶ä»–é€šçŸ¥æ©Ÿåˆ¶
  }
  
  @override
  void dispose() {
    // æ¸…ç†è³‡æº
    super.dispose();
  }
}

// ä½¿ç”¨ Riverpod çš„ ViewModel å¯¦ä½œ (å¯é¸)
class UserNotifier extends StateNotifier<UserState> {
  final GetUserProfileUseCase _getUserProfileUseCase;
  final UpdateUserProfileUseCase _updateUserProfileUseCase;
  
  UserNotifier({
    required GetUserProfileUseCase getUserProfileUseCase,
    required UpdateUserProfileUseCase updateUserProfileUseCase,
  }) : _getUserProfileUseCase = getUserProfileUseCase,
       _updateUserProfileUseCase = updateUserProfileUseCase,
       super(const UserState.initial());
  
  Future<void> loadUser(String userId) async {
    state = const UserState.loading();
    
    final result = await _getUserProfileUseCase.execute(userId);
    state = result.fold(
      (failure) => UserState.error(failure.message),
      (user) => UserState.loaded(user),
    );
  }
  
  Future<void> updateUser(User user) async {
    state = state.copyWith(isUpdating: true);
    
    final result = await _updateUserProfileUseCase.execute(user);
    state = result.fold(
      (failure) => state.copyWith(
        isUpdating: false,
        errorMessage: failure.message,
      ),
      (updatedUser) => UserState.loaded(updatedUser),
    );
  }
}

// ç‹€æ…‹é¡åˆ¥ (ç”¨æ–¼ Riverpod)
@freezed
class UserState with _$UserState {
  const factory UserState.initial() = _Initial;
  const factory UserState.loading() = _Loading;
  const factory UserState.loaded(User user) = _Loaded;
  const factory UserState.error(String message) = _Error;
  
  const factory UserState.custom({
    User? user,
    @Default(false) bool isLoading,
    @Default(false) bool isUpdating,
    String? errorMessage,
  }) = _Custom;
}
```

### View Layer (è¡¨ç¾å±¤)

```dart
// ğŸ–¼ï¸ View (UI å±¤)
// ä½ç½®: lib/presentation/pages/

class UserProfilePage extends StatefulWidget {
  final String userId;
  
  const UserProfilePage({
    Key? key,
    required this.userId,
  }) : super(key: key);
  
  @override
  State<UserProfilePage> createState() => _UserProfilePageState();
}

class _UserProfilePageState extends State<UserProfilePage> {
  late UserViewModel _viewModel;
  
  @override
  void initState() {
    super.initState();
    // å¾ä¾è³´æ³¨å…¥å®¹å™¨å–å¾— ViewModel
    _viewModel = getIt<UserViewModel>();
    
    // è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™
    WidgetsBinding.instance.addPostFrameCallback((_) {
      _viewModel.loadUserProfile(widget.userId);
    });
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('å€‹äººè³‡æ–™'),
        actions: [
          IconButton(
            icon: Icon(Icons.refresh),
            onPressed: _handleRefresh,
          ),
          PopupMenuButton<String>(
            onSelected: _handleMenuAction,
            itemBuilder: (context) => [
              PopupMenuItem(value: 'edit', child: Text('ç·¨è¼¯')),
              PopupMenuItem(value: 'delete', child: Text('åˆªé™¤å¸³è™Ÿ')),
            ],
          ),
        ],
      ),
      body: ChangeNotifierProvider.value(
        value: _viewModel,
        child: Consumer<UserViewModel>(
          builder: (context, viewModel, child) {
            return _buildBody(viewModel);
          },
        ),
      ),
    );
  }
  
  Widget _buildBody(UserViewModel viewModel) {
    if (viewModel.isLoading && !viewModel.hasUser) {
      return _buildLoadingState();
    }
    
    if (viewModel.errorMessage != null && !viewModel.hasUser) {
      return _buildErrorState(viewModel.errorMessage!);
    }
    
    if (viewModel.hasUser) {
      return _buildUserProfile(viewModel);
    }
    
    return _buildEmptyState();
  }
  
  Widget _buildLoadingState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          CircularProgressIndicator(),
          SizedBox(height: 16),
          Text('è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™ä¸­...'),
        ],
      ),
    );
  }
  
  Widget _buildErrorState(String error) {
    return Center(
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              Icons.error_outline,
              size: 64,
              color: Colors.red,
            ),
            SizedBox(height: 16),
            Text(
              'è¼‰å…¥å¤±æ•—',
              style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
            ),
            SizedBox(height: 8),
            Text(
              error,
              textAlign: TextAlign.center,
              style: TextStyle(color: Colors.grey[600]),
            ),
            SizedBox(height: 24),
            ElevatedButton(
              onPressed: () => _viewModel.loadUserProfile(widget.userId),
              child: Text('é‡æ–°è¼‰å…¥'),
            ),
          ],
        ),
      ),
    );
  }
  
  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.person_outline,
            size: 64,
            color: Colors.grey,
          ),
          SizedBox(height: 16),
          Text('æœªæ‰¾åˆ°ä½¿ç”¨è€…è³‡æ–™'),
        ],
      ),
    );
  }
  
  Widget _buildUserProfile(UserViewModel viewModel) {
    final user = viewModel.user!;
    
    return RefreshIndicator(
      onRefresh: _handleRefresh,
      child: SingleChildScrollView(
        physics: AlwaysScrollableScrollPhysics(),
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // éŒ¯èª¤è¨Šæ¯é¡¯ç¤º
            if (viewModel.errorMessage != null)
              _buildErrorBanner(viewModel.errorMessage!),
            
            // ä½¿ç”¨è€…é ­åƒå’ŒåŸºæœ¬è³‡è¨Š
            _buildUserHeader(user),
            
            SizedBox(height: 24),
            
            // ä½¿ç”¨è€…è©³ç´°è³‡è¨Š
            _buildUserDetails(user),
            
            SizedBox(height: 24),
            
            // æ“ä½œæŒ‰éˆ•
            _buildActionButtons(viewModel),
          ],
        ),
      ),
    );
  }
  
  Widget _buildErrorBanner(String error) {
    return Container(
      width: double.infinity,
      padding: EdgeInsets.all(12),
      margin: EdgeInsets.only(bottom: 16),
      decoration: BoxDecoration(
        color: Colors.red[100],
        borderRadius: BorderRadius.circular(8),
        border: Border.all(color: Colors.red[300]!),
      ),
      child: Row(
        children: [
          Icon(Icons.error, color: Colors.red[700]),
          SizedBox(width: 8),
          Expanded(
            child: Text(
              error,
              style: TextStyle(color: Colors.red[700]),
            ),
          ),
          IconButton(
            icon: Icon(Icons.close, color: Colors.red[700]),
            onPressed: _viewModel.clearError,
            constraints: BoxConstraints(minWidth: 24, minHeight: 24),
            padding: EdgeInsets.zero,
          ),
        ],
      ),
    );
  }
  
  Widget _buildUserHeader(User user) {
    return Card(
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Row(
          children: [
            // é ­åƒ
            CircleAvatar(
              radius: 40,
              backgroundColor: Colors.blue[100],
              child: Text(
                user.displayName[0].toUpperCase(),
                style: TextStyle(
                  fontSize: 32,
                  fontWeight: FontWeight.bold,
                  color: Colors.blue[700],
                ),
              ),
            ),
            SizedBox(width: 16),
            
            // åŸºæœ¬è³‡è¨Š
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    user.displayName,
                    style: TextStyle(
                      fontSize: 20,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                  SizedBox(height: 4),
                  Text(
                    user.email,
                    style: TextStyle(
                      fontSize: 14,
                      color: Colors.grey[600],
                    ),
                  ),
                  SizedBox(height: 8),
                  
                  // ç‹€æ…‹æ¨™ç±¤
                  _buildStatusChip(user.status),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }
  
  Widget _buildStatusChip(UserStatus status) {
    Color backgroundColor;
    Color textColor;
    String text;
    
    switch (status) {
      case UserStatus.active:
        backgroundColor = Colors.green[100]!;
        textColor = Colors.green[700]!;
        text = 'æ´»èº';
        break;
      case UserStatus.inactive:
        backgroundColor = Colors.grey[100]!;
        textColor = Colors.grey[700]!;
        text = 'éæ´»èº';
        break;
      case UserStatus.banned:
        backgroundColor = Colors.red[100]!;
        textColor = Colors.red[700]!;
        text = 'å·²å°é–';
        break;
      case UserStatus.pending:
        backgroundColor = Colors.orange[100]!;
        textColor = Colors.orange[700]!;
        text = 'ç­‰å¾…ä¸­';
        break;
    }
    
    return Container(
      padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4),
      decoration: BoxDecoration(
        color: backgroundColor,
        borderRadius: BorderRadius.circular(12),
      ),
      child: Text(
        text,
        style: TextStyle(
          color: textColor,
          fontSize: 12,
          fontWeight: FontWeight.w500,
        ),
      ),
    );
  }
  
  Widget _buildUserDetails(User user) {
    return Card(
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              'è©³ç´°è³‡è¨Š',
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
              ),
            ),
            SizedBox(height: 16),
            
            _buildDetailItem(
              icon: Icons.person,
              label: 'ä½¿ç”¨è€… ID',
              value: user.id,
            ),
            
            _buildDetailItem(
              icon: Icons.email,
              label: 'é›»å­éƒµä»¶',
              value: user.email,
            ),
            
            _buildDetailItem(
              icon: Icons.access_time,
              label: 'æœ€å¾Œç™»å…¥',
              value: user.lastLoginAt != null
                  ? _formatDateTime(user.lastLoginAt!)
                  : 'å¾æœªç™»å…¥',
            ),
            
            _buildDetailItem(
              icon: Icons.info,
              label: 'å¸³è™Ÿç‹€æ…‹',
              value: user.isActive ? 'æ­£å¸¸' : 'éæ´»èº',
            ),
            
            if (user.isNewUser)
              _buildDetailItem(
                icon: Icons.new_releases,
                label: 'å¸³è™Ÿé¡å‹',
                value: 'æ–°ä½¿ç”¨è€…',
              ),
          ],
        ),
      ),
    );
  }
  
  Widget _buildDetailItem({
    required IconData icon,
    required String label,
    required String value,
  }) {
    return Padding(
      padding: EdgeInsets.only(bottom: 12),
      child: Row(
        children: [
          Icon(icon, size: 20, color: Colors.grey[600]),
          SizedBox(width: 12),
          Expanded(
            flex: 2,
            child: Text(
              label,
              style: TextStyle(
                fontWeight: FontWeight.w500,
                color: Colors.grey[700],
              ),
            ),
          ),
          Expanded(
            flex: 3,
            child: Text(
              value,
              style: TextStyle(fontWeight: FontWeight.w400),
            ),
          ),
        ],
      ),
    );
  }
  
  Widget _buildActionButtons(UserViewModel viewModel) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.stretch,
      children: [
        ElevatedButton.icon(
          onPressed: viewModel.isUpdating ? null : _handleEditProfile,
          icon: Icon(Icons.edit),
          label: Text('ç·¨è¼¯å€‹äººè³‡æ–™'),
          style: ElevatedButton.styleFrom(
            padding: EdgeInsets.symmetric(vertical: 12),
          ),
        ),
        
        SizedBox(height: 12),
        
        OutlinedButton.icon(
          onPressed: viewModel.isLoading ? null : _handleChangePassword,
          icon: Icon(Icons.lock),
          label: Text('æ›´æ”¹å¯†ç¢¼'),
          style: OutlinedButton.styleFrom(
            padding: EdgeInsets.symmetric(vertical: 12),
          ),
        ),
        
        SizedBox(height: 12),
        
        TextButton.icon(
          onPressed: viewModel.isLoading ? null : _handleDeleteAccount,
          icon: Icon(Icons.delete, color: Colors.red),
          label: Text(
            'åˆªé™¤å¸³è™Ÿ',
            style: TextStyle(color: Colors.red),
          ),
          style: TextButton.styleFrom(
            padding: EdgeInsets.symmetric(vertical: 12),
          ),
        ),
        
        // è¼‰å…¥æŒ‡ç¤ºå™¨
        if (viewModel.isUpdating)
          Padding(
            padding: EdgeInsets.only(top: 16),
            child: Center(
              child: Column(
                children: [
                  SizedBox(
                    width: 20,
                    height: 20,
                    child: CircularProgressIndicator(strokeWidth: 2),
                  ),
                  SizedBox(height: 8),
                  Text(
                    'æ›´æ–°ä¸­...',
                    style: TextStyle(fontSize: 12, color: Colors.grey[600]),
                  ),
                ],
              ),
            ),
          ),
      ],
    );
  }
  
  // äº‹ä»¶è™•ç†æ–¹æ³•
  Future<void> _handleRefresh() async {
    await _viewModel.refresh();
  }
  
  void _handleMenuAction(String action) {
    switch (action) {
      case 'edit':
        _handleEditProfile();
        break;
      case 'delete':
        _handleDeleteAccount();
        break;
    }
  }
  
  void _handleEditProfile() {
    if (_viewModel.user == null) return;
    
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => EditProfilePage(user: _viewModel.user!),
      ),
    ).then((result) {
      // å¦‚æœç·¨è¼¯æˆåŠŸï¼Œé‡æ–°è¼‰å…¥è³‡æ–™
      if (result == true) {
        _viewModel.refresh();
      }
    });
  }
  
  void _handleChangePassword() {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => ChangePasswordPage(),
      ),
    );
  }
  
  void _handleDeleteAccount() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text('åˆªé™¤å¸³è™Ÿ'),
        content: Text(
          'ç¢ºå®šè¦åˆªé™¤æ­¤å¸³è™Ÿå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: Text('å–æ¶ˆ'),
          ),
          TextButton(
            onPressed: () async {
              Navigator.pop(context);
              final success = await _viewModel.deleteAccount();
              if (success) {
                _showSuccessSnackBar('å¸³è™Ÿå·²æˆåŠŸåˆªé™¤');
                Navigator.pop(context); // è¿”å›ä¸Šä¸€é 
              }
            },
            child: Text(
              'åˆªé™¤',
              style: TextStyle(color: Colors.red),
            ),
          ),
        ],
      ),
    );
  }
  
  void _showSuccessSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: Colors.green,
        behavior: SnackBarBehavior.floating,
      ),
    );
  }
  
  String _formatDateTime(DateTime dateTime) {
    final now = DateTime.now();
    final difference = now.difference(dateTime);
    
    if (difference.inDays > 0) {
      return '${difference.inDays} å¤©å‰';
    } else if (difference.inHours > 0) {
      return '${difference.inHours} å°æ™‚å‰';
    } else if (difference.inMinutes > 0) {
      return '${difference.inMinutes} åˆ†é˜å‰';
    } else {
      return 'å‰›å‰›';
    }
  }
  
  @override
  void dispose() {
    // æ¸…ç†è³‡æº
    super.dispose();
  }
}
```

------

## ğŸ”„ UseCase å±¤ (æ¥­å‹™é‚è¼¯)

```dart
// ğŸ“‹ UseCase (ç”¨ä¾‹å±¤)
// ä½ç½®: lib/domain/usecases/

// åŸºç¤ UseCase æŠ½è±¡é¡åˆ¥
abstract class UseCase<Type, Params> {
  Future<Either<Failure, Type>> execute(Params params);
}

abstract class UseCaseNoParams<Type> {
  Future<Either<Failure, Type>> execute();
}

// å–å¾—ä½¿ç”¨è€…å€‹äººè³‡æ–™ç”¨ä¾‹
class GetUserProfileUseCase implements UseCase<User, String> {
  final UserRepository _repository;
  
  GetUserProfileUseCase(this._repository);
  
  @override
  Future<Either<Failure, User>> execute(String userId) async {
    try {
      // é©—è­‰è¼¸å…¥åƒæ•¸
      if (userId.isEmpty) {
        return Left(ValidationFailure('ä½¿ç”¨è€… ID ä¸èƒ½ç‚ºç©º'));
      }
      
      // å‘¼å«å„²å­˜åº«
      final user = await _repository.getUserById(userId);
      
      if (user == null) {
        return Left(NotFoundFailure('æ‰¾ä¸åˆ°æŒ‡å®šçš„ä½¿ç”¨è€…'));
      }
      
      return Right(user);
    } catch (error) {
      return Left(ServerFailure('å–å¾—ä½¿ç”¨è€…è³‡æ–™å¤±æ•—: $error'));
    }
  }
}

// æ›´æ–°ä½¿ç”¨è€…å€‹äººè³‡æ–™ç”¨ä¾‹
class UpdateUserProfileUseCase implements UseCase<User, UpdateUserParams> {
  final UserRepository _repository;
  final ValidationService _validationService;
  
  UpdateUserProfileUseCase(
    this._repository,
    this._validationService,
  );
  
  @override
  Future<Either<Failure, User>> execute(UpdateUserParams params) async {
    try {
      // é©—è­‰è¼¸å…¥è³‡æ–™
      final validationResult = _validationService.validateUser(params.user);
      if (!validationResult.isValid) {
        return Left(ValidationFailure(validationResult.errorMessage));
      }
      
      // æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦å­˜åœ¨
      final existingUser = await _repository.getUserById(params.user.id);
      if (existingUser == null) {
        return Left(NotFoundFailure('ä½¿ç”¨è€…ä¸å­˜åœ¨'));
      }
      
      // æª¢æŸ¥é›»å­éƒµä»¶æ˜¯å¦å·²è¢«å…¶ä»–ä½¿ç”¨è€…ä½¿ç”¨
      if (params.user.email != existingUser.email) {
        final emailExists = await _repository.isEmailExists(params.user.email);
        if (emailExists) {
          return Left(ValidationFailure('æ­¤é›»å­éƒµä»¶å·²è¢«ä½¿ç”¨'));
        }
      }
      
      // åŸ·è¡Œæ›´æ–°
      final updatedUser = await _repository.updateUser(params.user);
      
      return Right(updatedUser);
    } catch (error) {
      return Left(ServerFailure('æ›´æ–°ä½¿ç”¨è€…è³‡æ–™å¤±æ•—: $error'));
    }
  }
}

// åƒæ•¸é¡åˆ¥
class UpdateUserParams {
  final User user;
  
  UpdateUserParams({required this.user});
}

// æœå°‹ä½¿ç”¨è€…ç”¨ä¾‹
class SearchUsersUseCase implements UseCase<List<User>, SearchUsersParams> {
  final UserRepository _repository;
  
  SearchUsersUseCase(this._repository);
  
  @override
  Future<Either<Failure, List<User>>> execute(SearchUsersParams params) async {
    try {
      // é©—è­‰æœå°‹æŸ¥è©¢
      if (params.query.trim().length < 2) {
        return Left(ValidationFailure('æœå°‹é—œéµå­—è‡³å°‘éœ€è¦ 2 å€‹å­—å…ƒ'));
      }
      
      // åŸ·è¡Œæœå°‹
      final users = await _repository.searchUsers(
        params.query,
        page: params.page,
        limit: params.limit,
      );
      
      return Right(users);
    } catch (error) {
      return Left(ServerFailure('æœå°‹ä½¿ç”¨è€…å¤±æ•—: $error'));
    }
  }
}

class SearchUsersParams {
  final String query;
  final int page;
  final int limit;
  
  SearchUsersParams({
    required this.query,
    this.page = 1,
    this.limit = 20,
  });
}

// åˆªé™¤ä½¿ç”¨è€…å¸³è™Ÿç”¨ä¾‹
class DeleteUserAccountUseCase implements UseCase<void, String> {
  final UserRepository _repository;
  final AuthRepository _authRepository;
  
  DeleteUserAccountUseCase(
    this._repository,
    this._authRepository,
  );
  
  @override
  Future<Either<Failure, void>> execute(String userId) async {
    try {
      // æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦å­˜åœ¨
      final user = await _repository.getUserById(userId);
      if (user == null) {
        return Left(NotFoundFailure('ä½¿ç”¨è€…ä¸å­˜åœ¨'));
      }
      
      // æª¢æŸ¥æ˜¯å¦ç‚ºç•¶å‰ç™»å…¥ä½¿ç”¨è€…
      final currentUser = await _authRepository.getCurrentUser();
      if (currentUser?.id != userId) {
        return Left(UnauthorizedFailure('åªèƒ½åˆªé™¤è‡ªå·±çš„å¸³è™Ÿ'));
      }
      
      // åŸ·è¡Œåˆªé™¤æ“ä½œ
      await _repository.deleteUser(userId);
      
      // ç™»å‡ºä½¿ç”¨è€…
      await _authRepository.logout();
      
      return Right(null);
    } catch (error) {
      return Left(ServerFailure('åˆªé™¤å¸³è™Ÿå¤±æ•—: $error'));
    }
  }
}
```

------

## ğŸ—ƒï¸ è³‡æ–™æºè¨­è¨ˆ

```dart
// ğŸŒ Remote Data Source (é ç«¯è³‡æ–™æº)
// ä½ç½®: lib/data/datasources/remote/

abstract class UserRemoteDataSource {
  Future<UserResponse> getUserById(String id);
  Future<List<UserResponse>> getUsers({int page = 1, int limit = 20});
  Future<UserResponse> createUser(UserResponse user);
  Future<UserResponse> updateUser(UserResponse user);
  Future<void> deleteUser(String id);
  Future<List<UserResponse>> searchUsers(String query, {int page = 1, int limit = 20});
  Future<bool> isEmailExists(String email);
}

class UserRemoteDataSourceImpl implements UserRemoteDataSource {
  final ApiClient _apiClient;
  final String _baseUrl = '/api/v1/users';
  
  UserRemoteDataSourceImpl({required ApiClient apiClient})
      : _apiClient = apiClient;
  
  @override
  Future<UserResponse> getUserById(String id) async {
    try {
      final response = await _apiClient.get('$_baseUrl/$id');
      
      if (response.statusCode == 200) {
        return UserResponse.fromJson(response.data);
      } else {
        throw ServerException('å–å¾—ä½¿ç”¨è€…è³‡æ–™å¤±æ•—: ${response.statusCode}');
      }
    } catch (error) {
      throw ServerException('ç¶²è·¯éŒ¯èª¤: $error');
    }
  }
  
  @override
  Future<List<UserResponse>> getUsers({int page = 1, int limit = 20}) async {
    try {
      final response = await _apiClient.get(
        _baseUrl,
        queryParameters: {
          'page': page,
          'limit': limit,
        },
      );
      
      if (response.statusCode == 200) {
        final List<dynamic> jsonList = response.data['data'];
        return jsonList.map((json) => UserResponse.fromJson(json)).toList();
      } else {
        throw ServerException('å–å¾—ä½¿ç”¨è€…åˆ—è¡¨å¤±æ•—: ${response.statusCode}');
      }
    } catch (error) {
      throw ServerException('ç¶²è·¯éŒ¯èª¤: $error');
    }
  }
  
  @override
  Future<UserResponse> createUser(UserResponse user) async {
    try {
      final response = await _apiClient.post(
        _baseUrl,
        data: user.toJson(),
      );
      
      if (response.statusCode == 201) {
        return UserResponse.fromJson(response.data);
      } else {
        throw ServerException('å»ºç«‹ä½¿ç”¨è€…å¤±æ•—: ${response.statusCode}');
      }
    } catch (error) {
      throw ServerException('ç¶²è·¯éŒ¯èª¤: $error');
    }
  }
  
  @override
  Future<UserResponse> updateUser(UserResponse user) async {
    try {
      final response = await _apiClient.put(
        '$_baseUrl/${user.id}',
        data: user.toJson(),
      );
      
      if (response.statusCode == 200) {
        return UserResponse.fromJson(response.data);
      } else {
        throw ServerException('æ›´æ–°ä½¿ç”¨è€…å¤±æ•—: ${response.statusCode}');
      }
    } catch (error) {
      throw ServerException('ç¶²è·¯éŒ¯èª¤: $error');
    }
  }
  
  @override
  Future<void> deleteUser(String id) async {
    try {
      final response = await _apiClient.delete('$_baseUrl/$id');
      
      if (response.statusCode != 204) {
        throw ServerException('åˆªé™¤ä½¿ç”¨è€…å¤±æ•—: ${response.statusCode}');
      }
    } catch (error) {
      throw ServerException('ç¶²è·¯éŒ¯èª¤: $error');
    }
  }
  
  @override
  Future<List<UserResponse>> searchUsers(
    String query, {
    int page = 1,
    int limit = 20,
  }) async {
    try {
      final response = await _apiClient.get(
        '$_baseUrl/search',
        queryParameters: {
          'q': query,
          'page': page,
          'limit': limit,
        },
      );
      
      if (response.statusCode == 200) {
        final List<dynamic> jsonList = response.data['data'];
        return jsonList.map((json) => UserResponse.fromJson(json)).toList();
      } else {
        throw ServerException('æœå°‹ä½¿ç”¨è€…å¤±æ•—: ${response.statusCode}');
      }
    } catch (error) {
      throw ServerException('ç¶²è·¯éŒ¯èª¤: $error');
    }
  }
  
  @override
  Future<bool> isEmailExists(String email) async {
    try {
      final response = await _apiClient.get(
        '$_baseUrl/check-email',
        queryParameters: {'email': email},
      );
      
      if (response.statusCode == 200) {
        return response.data['exists'] == true;
      } else {
        throw ServerException('æª¢æŸ¥é›»å­éƒµä»¶å¤±æ•—: ${response.statusCode}');
      }
    } catch (error) {
      throw ServerException('ç¶²è·¯éŒ¯èª¤: $error');
    }
  }
}

// ğŸ’¾ Local Data Source (æœ¬åœ°è³‡æ–™æº)
// ä½ç½®: lib/data/datasources/local/

abstract class UserLocalDataSource {
  Future<UserResponse?> getUserById(String id);
  Future<List<UserResponse>> getCachedUsers({int page = 1, int limit = 20});
  Future<void> cacheUser(UserResponse user);
  Future<void> cacheUsers(List<UserResponse> users);
  Future<void> deleteUser(String id);
  Future<void> clearCache();
  Future<List<UserResponse>> searchCachedUsers(String query);
}

class UserLocalDataSourceImpl implements UserLocalDataSource {
  final LocalStorage _localStorage;
  final String _usersKey = 'cached_users';
  final String _userPrefix = 'user_';
  
  UserLocalDataSourceImpl({required LocalStorage localStorage})
      : _localStorage = localStorage;
  
  @override
  Future<UserResponse?> getUserById(String id) async {
    try {
      final userData = await _localStorage.getString('$_userPrefix$id');
      if (userData != null) {
        final jsonData = jsonDecode(userData);
        return UserResponse.fromJson(jsonData);
      }
      return null;
    } catch (error) {
      throw CacheException('å–å¾—å¿«å–ä½¿ç”¨è€…è³‡æ–™å¤±æ•—: $error');
    }
  }
  
  @override
  Future<List<UserResponse>> getCachedUsers({int page = 1, int limit = 20}) async {
    try {
      final usersData = await _localStorage.getString(_usersKey);
      if (usersData != null) {
        final List<dynamic> jsonList = jsonDecode(usersData);
        final users = jsonList.map((json) => UserResponse.fromJson(json)).toList();
        
        // å¯¦ä½œåˆ†é 
        final startIndex = (page - 1) * limit;
        final endIndex = startIndex + limit;
        
        if (startIndex >= users.length) {
          return [];
        }
        
        return users.sublist(
          startIndex,
          endIndex > users.length ? users.length : endIndex,
        );
      }
      return [];
    } catch (error) {
      throw CacheException('å–å¾—å¿«å–ä½¿ç”¨è€…åˆ—è¡¨å¤±æ•—: $error');
    }
  }
  
  @override
  Future<void> cacheUser(UserResponse user) async {
    try {
      // å¿«å–å€‹åˆ¥ä½¿ç”¨è€…
      await _localStorage.setString(
        '$_userPrefix${user.id}',
        jsonEncode(user.toJson()),
      );
      
      // æ›´æ–°ä½¿ç”¨è€…åˆ—è¡¨å¿«å–
      final users = await getCachedUsers(page: 1, limit: 1000); // å–å¾—æ‰€æœ‰å¿«å–çš„ä½¿ç”¨è€…
      final userIndex = users.indexWhere((u) => u.id == user.id);
      
      if (userIndex != -1) {
        users[userIndex] = user; // æ›´æ–°ç¾æœ‰ä½¿ç”¨è€…
      } else {
        users.add(user); // æ–°å¢ä½¿ç”¨è€…
      }
      
      await _localStorage.setString(
        _usersKey,
        jsonEncode(users.map((u) => u.toJson()).toList()),
      );
    } catch (error) {
      throw CacheException('å¿«å–ä½¿ç”¨è€…è³‡æ–™å¤±æ•—: $error');
    }
  }
  
  @override
  Future<void> cacheUsers(List<UserResponse> users) async {
    try {
      // å¿«å–ä½¿ç”¨è€…åˆ—è¡¨
      await _localStorage.setString(
        _usersKey,
        jsonEncode(users.map((u) => u.toJson()).toList()),
      );
      
      // å€‹åˆ¥å¿«å–æ¯å€‹ä½¿ç”¨è€…
      for (final user in users) {
        await _localStorage.setString(
          '$_userPrefix${user.id}',
          jsonEncode(user.toJson()),
        );
      }
    } catch (error) {
      throw CacheException('å¿«å–ä½¿ç”¨è€…åˆ—è¡¨å¤±æ•—: $error');
    }
  }
  
  @override
  Future<void> deleteUser(String id) async {
    try {
      // åˆªé™¤å€‹åˆ¥ä½¿ç”¨è€…å¿«å–
      await _localStorage.remove('$_userPrefix$id');
      
      // å¾ä½¿ç”¨è€…åˆ—è¡¨å¿«å–ä¸­ç§»é™¤
      final users = await getCachedUsers(page: 1, limit: 1000);
      users.removeWhere((user) => user.id == id);
      
      await _localStorage.setString(
        _usersKey,
        jsonEncode(users.map((u) => u.toJson()).toList()),
      );
    } catch (error) {
      throw CacheException('åˆªé™¤å¿«å–ä½¿ç”¨è€…å¤±æ•—: $error');
    }
  }
  
  @override
  Future<void> clearCache() async {
    try {
      await _localStorage.remove(_usersKey);
      
      // åˆªé™¤æ‰€æœ‰å€‹åˆ¥ä½¿ç”¨è€…å¿«å–
      final keys = await _localStorage.getKeys();
      for (final key in keys) {
        if (key.startsWith(_userPrefix)) {
          await _localStorage.remove(key);
        }
      }
    } catch (error) {
      throw CacheException('æ¸…é™¤ä½¿ç”¨è€…å¿«å–å¤±æ•—: $error');
    }
  }
  
  @override
  Future<List<UserResponse>> searchCachedUsers(String query) async {
    try {
      final users = await getCachedUsers(page: 1, limit: 1000);
      final lowerQuery = query.toLowerCase();
      
      return users.where((user) {
        return user.name.toLowerCase().contains(lowerQuery) ||
               user.email.toLowerCase().contains(lowerQuery);
      }).toList();
    } catch (error) {
      throw CacheException('æœå°‹å¿«å–ä½¿ç”¨è€…å¤±æ•—: $error');
    }
  }
}
```

------

## ğŸ­ ä¾è³´æ³¨å…¥è¨­å®š

```dart
// ğŸ”§ Dependency Injection Setup
// ä½ç½®: lib/core/injection/injection.dart

import 'package:get_it/get_it.dart';
import 'package:dio/dio.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'package:connectivity_plus/connectivity_plus.dart';

final GetIt getIt = GetIt.instance;

Future<void> configureDependencies() async {
  // ğŸ”Œ å¤–éƒ¨ä¾è³´ (Third-party)
  await _registerExternalDependencies();
  
  // ğŸ—ï¸ æ ¸å¿ƒæœå‹™
  _registerCoreServices();
  
  // ğŸ—ƒï¸ è³‡æ–™å±¤
  _registerDataLayer();
  
  // ğŸ“‹ æ¥­å‹™é‚è¼¯å±¤
  _registerDomainLayer();
  
  // ğŸ¨ è¡¨ç¾å±¤
  _registerPresentationLayer();
}

Future<void> _registerExternalDependencies() async {
  // SharedPreferences
  final sharedPreferences = await SharedPreferences.getInstance();
  getIt.registerLazySingleton<SharedPreferences>(() => sharedPreferences);
  
  // Connectivity
  getIt.registerLazySingleton<Connectivity>(() => Connectivity());
  
  // Dio HTTP Client
  final dio = Dio();
  dio.options.baseUrl = AppConfig.apiBaseUrl;
  dio.options.connectTimeout = Duration(seconds: 30);
  dio.options.receiveTimeout = Duration(seconds: 30);
  
  // æ·»åŠ æ””æˆªå™¨
  dio.interceptors.add(AuthInterceptor());
  dio.interceptors.add(LoggingInterceptor());
  dio.interceptors.add(ErrorInterceptor());
  
  getIt.registerLazySingleton<Dio>(() => dio);
}

void _registerCoreServices() {
  // ğŸŒ ç¶²è·¯ç›¸é—œ
  getIt.registerLazySingleton<NetworkInfo>(
    () => NetworkInfoImpl(connectivity: getIt()),
  );
  
  getIt.registerLazySingleton<ApiClient>(
    () => ApiClientImpl(dio: getIt()),
  );
  
  // ğŸ’¾ å„²å­˜ç›¸é—œ
  getIt.registerLazySingleton<LocalStorage>(
    () => SharedPrefsStorage(sharedPreferences: getIt()),
  );
  
  getIt.registerLazySingleton<SecureStorage>(
    () => SecureStorageImpl(),
  );
  
  // ğŸ›¡ï¸ å®‰å…¨å’Œé©—è­‰
  getIt.registerLazySingleton<ValidationService>(
    () => ValidationServiceImpl(),
  );
  
  getIt.registerLazySingleton<EncryptionService>(
    () => EncryptionServiceImpl(),
  );
  
  // ğŸ“Š åˆ†æå’Œæ—¥èªŒ
  getIt.registerLazySingleton<LoggingService>(
    () => LoggingServiceImpl(),
  );
  
  getIt.registerLazySingleton<AnalyticsService>(
    () => AnalyticsServiceImpl(),
  );
}

void _registerDataLayer() {
  // ğŸŒ Remote Data Sources
  getIt.registerLazySingleton<AuthRemoteDataSource>(
    () => AuthRemoteDataSourceImpl(apiClient: getIt()),
  );
  
  getIt.registerLazySingleton<UserRemoteDataSource>(
    () => UserRemoteDataSourceImpl(apiClient: getIt()),
  );
  
  getIt.registerLazySingleton<ProductRemoteDataSource>(
    () => ProductRemoteDataSourceImpl(apiClient: getIt()),
  );
  
  // ğŸ’¾ Local Data Sources
  getIt.registerLazySingleton<AuthLocalDataSource>(
    () => AuthLocalDataSourceImpl(
      localStorage: getIt(),
      secureStorage: getIt(),
    ),
  );
  
  getIt.registerLazySingleton<UserLocalDataSource>(
    () => UserLocalDataSourceImpl(localStorage: getIt()),
  );
  
  getIt.registerLazySingleton<ProductLocalDataSource>(
    () => ProductLocalDataSourceImpl(localStorage: getIt()),
  );
  
  // ğŸ—ƒï¸ Repositories
  getIt.registerLazySingleton<AuthRepository>(
    () => AuthRepositoryImpl(
      remoteDataSource: getIt(),
      localDataSource: getIt(),
      networkInfo: getIt(),
    ),
  );
  
  getIt.registerLazySingleton<UserRepository>(
    () => UserRepositoryImpl(
      remoteDataSource: getIt(),
      localDataSource: getIt(),
      networkInfo: getIt(),
    ),
  );
  
  getIt.registerLazySingleton<ProductRepository>(
    () => ProductRepositoryImpl(
      remoteDataSource: getIt(),
      localDataSource: getIt(),
      networkInfo: getIt(),
    ),
  );
}

void _registerDomainLayer() {
  // ğŸ” Authentication Use Cases
  getIt.registerLazySingleton<LoginUseCase>(
    () => LoginUseCase(
      repository: getIt(),
      validationService: getIt(),
    ),
  );
  
  getIt.registerLazySingleton<LogoutUseCase>(
    () => LogoutUseCase(repository: getIt()),
  );
  
  getIt.registerLazySingleton<RegisterUseCase>(
    () => RegisterUseCase(
      repository: getIt(),
      validationService: getIt(),
    ),
  );
  
  getIt.registerLazySingleton<RefreshTokenUseCase>(
    () => RefreshTokenUseCase(repository: getIt()),
  );
  
  // ğŸ‘¤ User Use Cases
  getIt.registerLazySingleton<GetUserProfileUseCase>(
    () => GetUserProfileUseCase(getIt()),
  );
  
  getIt.registerLazySingleton<UpdateUserProfileUseCase>(
    () => UpdateUserProfileUseCase(
      getIt(),
      getIt<ValidationService>(),
    ),
  );
  
  getIt.registerLazySingleton<DeleteUserAccountUseCase>(
    () => DeleteUserAccountUseCase(
      getIt<UserRepository>(),
      getIt<AuthRepository>(),
    ),
  );
  
  getIt.registerLazySingleton<SearchUsersUseCase>(
    () => SearchUsersUseCase(getIt()),
  );
  
  // ğŸ›ï¸ Product Use Cases
  getIt.registerLazySingleton<GetProductsUseCase>(
    () => GetProductsUseCase(getIt()),
  );
  
  getIt.registerLazySingleton<GetProductDetailUseCase>(
    () => GetProductDetailUseCase(getIt()),
  );
  
  getIt.registerLazySingleton<SearchProductsUseCase>(
    () => SearchProductsUseCase(getIt()),
  );
}

void _registerPresentationLayer() {
  // ğŸ” Authentication ViewModels
  getIt.registerFactory<AuthViewModel>(
    () => AuthViewModel(
      loginUseCase: getIt(),
      logoutUseCase: getIt(),
      registerUseCase: getIt(),
      refreshTokenUseCase: getIt(),
    ),
  );
  
  // ğŸ‘¤ User ViewModels
  getIt.registerFactory<UserViewModel>(
    () => UserViewModel(
      getUserProfileUseCase: getIt(),
      updateUserProfileUseCase: getIt(),
      deleteUserAccountUseCase: getIt(),
    ),
  );
  
  getIt.registerFactory<UserListViewModel>(
    () => UserListViewModel(
      searchUsersUseCase: getIt(),
    ),
  );
  
  // ğŸ›ï¸ Product ViewModels
  getIt.registerFactory<ProductViewModel>(
    () => ProductViewModel(
      getProductsUseCase: getIt(),
      getProductDetailUseCase: getIt(),
      searchProductsUseCase: getIt(),
    ),
  );
  
  // ğŸ¨ UI Services
  getIt.registerLazySingleton<NavigationService>(
    () => NavigationServiceImpl(),
  );
  
  getIt.registerLazySingleton<DialogService>(
    () => DialogServiceImpl(),
  );
  
  getIt.registerLazySingleton<SnackBarService>(
    () => SnackBarServiceImpl(),
  );
  
  getIt.registerLazySingleton<ThemeService>(
    () => ThemeServiceImpl(localStorage: getIt()),
  );
}

// ğŸ§¹ æ¸…ç†ä¾è³´ (ç”¨æ–¼æ¸¬è©¦)
Future<void> resetDependencies() async {
  await getIt.reset();
}
```

------

## ğŸ”€ ç‹€æ…‹ç®¡ç†ç­–ç•¥

### Provider ç‹€æ…‹ç®¡ç†å¯¦ä½œ

```dart
// ğŸ¯ å¤š Provider è¨­å®š
// ä½ç½®: lib/main.dart

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // é…ç½®ä¾è³´æ³¨å…¥
  await configureDependencies();
  
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MultiProvider(
      providers: [
        // ğŸ” èªè­‰ç‹€æ…‹
        ChangeNotifierProvider<AuthViewModel>(
          create: (_) => getIt<AuthViewModel>(),
        ),
        
        // ğŸ‘¤ ä½¿ç”¨è€…ç‹€æ…‹
        ChangeNotifierProvider<UserViewModel>(
          create: (_) => getIt<UserViewModel>(),
        ),
        
        // ğŸ›ï¸ ç”¢å“ç‹€æ…‹
        ChangeNotifierProvider<ProductViewModel>(
          create: (_) => getIt<ProductViewModel>(),
        ),
        
        // ğŸ¨ ä¸»é¡Œç‹€æ…‹
        ChangeNotifierProvider<ThemeViewModel>(
          create: (_) => getIt<ThemeViewModel>(),
        ),
        
        // ğŸŒ æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
        ChangeNotifierProvider<AppViewModel>(
          create: (_) => getIt<AppViewModel>(),
        ),
      ],
      child: Consumer<ThemeViewModel>(
        builder: (context, themeViewModel, child) {
          return MaterialApp(
            title: 'Flutter MVVM App',
            theme: themeViewModel.lightTheme,
            darkTheme: themeViewModel.darkTheme,
            themeMode: themeViewModel.themeMode,
            initialRoute: AppRoutes.splash,
            onGenerateRoute: AppRouter.generateRoute,
            navigatorKey: getIt<NavigationService>().navigatorKey,
            builder: (context, child) {
              return AppErrorBoundary(
                child: child ?? Container(),
              );
            },
          );
        },
      ),
    );
  }
}

// ğŸ¨ ä¸»é¡Œç®¡ç† ViewModel
class ThemeViewModel extends ChangeNotifier {
  final ThemeService _themeService;
  
  ThemeViewModel({required ThemeService themeService})
      : _themeService = themeService {
    _loadThemeMode();
  }
  
  ThemeMode _themeMode = ThemeMode.system;
  ThemeData? _customLightTheme;
  ThemeData? _customDarkTheme;
  
  ThemeMode get themeMode => _themeMode;
  
  ThemeData get lightTheme => _customLightTheme ?? AppTheme.lightTheme;
  ThemeData get darkTheme => _customDarkTheme ?? AppTheme.darkTheme;
  
  bool get isDarkMode => _themeMode == ThemeMode.dark;
  bool get isSystemMode => _themeMode == ThemeMode.system;
  
  Future<void> _loadThemeMode() async {
    _themeMode = await _themeService.getThemeMode();
    notifyListeners();
  }
  
  Future<void> setThemeMode(ThemeMode mode) async {
    _themeMode = mode;
    await _themeService.setThemeMode(mode);
    notifyListeners();
  }
  
  Future<void> toggleTheme() async {
    final newMode = _themeMode == ThemeMode.light 
        ? ThemeMode.dark 
        : ThemeMode.light;
    await setThemeMode(newMode);
  }
  
  void setCustomTheme({ThemeData? light, ThemeData? dark}) {
    _customLightTheme = light;
    _customDarkTheme = dark;
    notifyListeners();
  }
}

// ğŸŒ æ‡‰ç”¨ç¨‹å¼å…¨åŸŸç‹€æ…‹
class AppViewModel extends ChangeNotifier {
  final NetworkInfo _networkInfo;
  final AnalyticsService _analyticsService;
  
  AppViewModel({
    required NetworkInfo networkInfo,
    required AnalyticsService analyticsService,
  }) : _networkInfo = networkInfo,
       _analyticsService = analyticsService {
    _initializeApp();
  }
  
  bool _isInitialized = false;
  bool _isConnected = true;
  String? _appVersion;
  Map<String, dynamic> _featureFlags = {};
  
  // Getters
  bool get isInitialized => _isInitialized;
  bool get isConnected => _isConnected;
  String? get appVersion => _appVersion;
  Map<String, dynamic> get featureFlags => _featureFlags;
  
  Future<void> _initializeApp() async {
    try {
      // è¼‰å…¥æ‡‰ç”¨ç¨‹å¼ç‰ˆæœ¬
      _appVersion = await _getAppVersion();
      
      // æª¢æŸ¥ç¶²è·¯é€£ç·š
      await _checkConnectivity();
      
      // è¼‰å…¥åŠŸèƒ½é–‹é—œ
      await _loadFeatureFlags();
      
      // åˆå§‹åŒ–åˆ†ææœå‹™
      await _analyticsService.initialize();
      
      _isInitialized = true;
      notifyListeners();
    } catch (error) {
      print('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—: $error');
    }
  }
  
  Future<void> _checkConnectivity() async {
    _isConnected = await _networkInfo.isConnected;
    
    // ç›£è½ç¶²è·¯ç‹€æ…‹è®ŠåŒ–
    _networkInfo.onConnectivityChanged.listen((isConnected) {
      if (_isConnected != isConnected) {
        _isConnected = isConnected;
        notifyListeners();
        
        // è¨˜éŒ„ç¶²è·¯ç‹€æ…‹è®ŠåŒ–
        _analyticsService.logEvent('network_status_changed', {
          'is_connected': isConnected,
        });
      }
    });
  }
  
  Future<String> _getAppVersion() async {
    final packageInfo = await PackageInfo.fromPlatform();
    return '${packageInfo.version}+${packageInfo.buildNumber}';
  }
  
  Future<void> _loadFeatureFlags() async {
    // é€™è£¡å¯ä»¥å¾é ç«¯é…ç½®æœå‹™è¼‰å…¥åŠŸèƒ½é–‹é—œ
    // ä¾‹å¦‚ Firebase Remote Config
    _featureFlags = {
      'new_user_onboarding': true,
      'dark_mode_enabled': true,
      'push_notifications': true,
      'analytics_enabled': true,
    };
  }
  
  bool isFeatureEnabled(String featureName) {
    return _featureFlags[featureName] == true;
  }
  
  void updateFeatureFlag(String featureName, bool enabled) {
    _featureFlags[featureName] = enabled;
    notifyListeners();
    
    _analyticsService.logEvent('feature_flag_changed', {
      'feature_name': featureName,
      'enabled': enabled,
    });
  }
}
```

### Riverpod ç‹€æ…‹ç®¡ç†å¯¦ä½œ (æ›¿ä»£æ–¹æ¡ˆ)

```dart
// ğŸ¯ Riverpod Providers
// ä½ç½®: lib/presentation/providers/app_providers.dart

// ğŸ” èªè­‰ç›¸é—œ Providers
final authViewModelProvider = StateNotifierProvider<AuthNotifier, AuthState>(
  (ref) => AuthNotifier(
    loginUseCase: ref.read(loginUseCaseProvider),
    logoutUseCase: ref.read(logoutUseCaseProvider),
    registerUseCase: ref.read(registerUseCaseProvider),
  ),
);

final currentUserProvider = Provider<User?>((ref) {
  final authState = ref.watch(authViewModelProvider);
  return authState.maybeWhen(
    authenticated: (user) => user,
    orElse: () => null,
  );
});

// ğŸ‘¤ ä½¿ç”¨è€…ç›¸é—œ Providers
final userViewModelProvider = StateNotifierProvider.family<UserNotifier, UserState, String>(
  (ref, userId) => UserNotifier(
    userId: userId,
    getUserProfileUseCase: ref.read(getUserProfileUseCaseProvider),
    updateUserProfileUseCase: ref.read(updateUserProfileUseCaseProvider),
  ),
);

final userListViewModelProvider = StateNotifierProvider<UserListNotifier, UserListState>(
  (ref) => UserListNotifier(
    searchUsersUseCase: ref.read(searchUsersUseCaseProvider),
  ),
);

// ğŸ›ï¸ ç”¢å“ç›¸é—œ Providers
final productListProvider = StateNotifierProvider<ProductListNotifier, ProductListState>(
  (ref) => ProductListNotifier(
    getProductsUseCase: ref.read(getProductsUseCaseProvider),
  ),
);

final productDetailProvider = StateNotifierProvider.family<ProductDetailNotifier, ProductDetailState, String>(
  (ref, productId) => ProductDetailNotifier(
    productId: productId,
    getProductDetailUseCase: ref.read(getProductDetailUseCaseProvider),
  ),
);

// ğŸ¨ ä¸»é¡Œ Provider
final themeProvider = StateNotifierProvider<ThemeNotifier, ThemeState>(
  (ref) => ThemeNotifier(
    themeService: ref.read(themeServiceProvider),
  ),
);

// ğŸŒ æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ Provider
final appStateProvider = StateNotifierProvider<AppStateNotifier, AppState>(
  (ref) => AppStateNotifier(
    networkInfo: ref.read(networkInfoProvider),
    analyticsService: ref.read(analyticsServiceProvider),
  ),
);

// ä½¿ç”¨ç¯„ä¾‹
class MyRiverpodApp extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final themeState = ref.watch(themeProvider);
    final appState = ref.watch(appStateProvider);
    
    if (!appState.isInitialized) {
      return MaterialApp(
        home: Scaffold(
          body: Center(
            child: CircularProgressIndicator(),
          ),
        ),
      );
    }
    
    return MaterialApp(
      title: 'Riverpod MVVM App',
      theme: themeState.lightTheme,
      darkTheme: themeState.darkTheme,
      themeMode: themeState.themeMode,
      initialRoute: AppRoutes.splash,
      onGenerateRoute: AppRouter.generateRoute,
    );
  }
}
```

------

## ğŸ§© éŒ¯èª¤è™•ç†èˆ‡ç•°å¸¸ç®¡ç†

```dart
// ğŸš¨ éŒ¯èª¤è™•ç†ç³»çµ±
// ä½ç½®: lib/core/errors/

// åŸºç¤éŒ¯èª¤é¡åˆ¥
abstract class Failure {
  final String message;
  final int? code;
  final dynamic originalError;
  
  const Failure({
    required this.message,
    this.code,
    this.originalError,
  });
  
  @override
  String toString() => 'Failure(message: $message, code: $code)';
}

// å…·é«”éŒ¯èª¤é¡å‹
class ServerFailure extends Failure {
  const ServerFailure(String message, {int? code, dynamic originalError})
      : super(message: message, code: code, originalError: originalError);
}

class NetworkFailure extends Failure {
  const NetworkFailure(String message, {int? code, dynamic originalError})
      : super(message: message, code: code, originalError: originalError);
}

class ValidationFailure extends Failure {
  const ValidationFailure(String message, {int? code, dynamic originalError})
      : super(message: message, code: code, originalError: originalError);
}

class AuthenticationFailure extends Failure {
  const AuthenticationFailure(String message, {int? code, dynamic originalError})
      : super(message: message, code: code, originalError: originalError);
}

class AuthorizationFailure extends Failure {
  const AuthorizationFailure(String message, {int? code, dynamic originalError})
      : super(message: message, code: code, originalError: originalError);
}

class NotFoundFailure extends Failure {
  const NotFoundFailure(String message, {int? code, dynamic originalError})
      : super(message: message, code: code, originalError: originalError);
}

class CacheFailure extends Failure {
  const CacheFailure(String message, {int? code, dynamic originalError})
      : super(message: message, code: code, originalError: originalError);
}

// ç•°å¸¸é¡åˆ¥
class ServerException implements Exception {
  final String message;
  final int? statusCode;
  
  ServerException(this.message, {this.statusCode});
  
  @override
  String toString() => 'ServerException: $message (Code: $statusCode)';
}

class NetworkException implements Exception {
  final String message;
  
  NetworkException(this.message);
  
  @override
  String toString() => 'NetworkException: $message';
}

class CacheException implements Exception {
  final String message;
  
  CacheException(this.message);
  
  @override
  String toString() => 'CacheException: $message';
}

class ValidationException implements Exception {
  final String message;
  final Map<String, String>? fieldErrors;
  
  ValidationException(this.message, {this.fieldErrors});
  
  @override
  String toString() => 'ValidationException: $message';
}

// éŒ¯èª¤è™•ç†å™¨
class ErrorHandler {
  static Failure handleError(dynamic error) {
    if (error is ServerException) {
      return ServerFailure(
        error.message,
        code: error.statusCode,
        originalError: error,
      );
    } else if (error is NetworkException) {
      return NetworkFailure(
        error.message,
        originalError: error,
      );
    } else if (error is CacheException) {
      return CacheFailure(
        error.message,
        originalError: error,
      );
    } else if (error is ValidationException) {
      return ValidationFailure(
        error.message,
        originalError: error,
      );
    } else if (error is DioError) {
      return _handleDioError(error);
    } else {
      return ServerFailure(
        'æœªçŸ¥éŒ¯èª¤: ${error.toString()}',
        originalError: error,
      );
    }
  }
  
  static Failure _handleDioError(DioError error) {
    switch (error.type) {
      case DioErrorType.connectionTimeout:
      case DioErrorType.sendTimeout:
      case DioErrorType.receiveTimeout:
        return NetworkFailure('é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
        
      case DioErrorType.badResponse:
        final statusCode = error.response?.statusCode;
        final message = error.response?.data?['message'] ?? 'ä¼ºæœå™¨éŒ¯èª¤';
        
        switch (statusCode) {
          case 400:
            return ValidationFailure('è«‹æ±‚åƒæ•¸éŒ¯èª¤: $message', code: statusCode);
          case 401:
            return AuthenticationFailure('èº«ä»½é©—è­‰å¤±æ•—', code: statusCode);
          case 403:
            return AuthorizationFailure('æ¬Šé™ä¸è¶³', code: statusCode);
          case 404:
            return NotFoundFailure('è³‡æºæœªæ‰¾åˆ°', code: statusCode);
          case 500:
          default:
            return ServerFailure('ä¼ºæœå™¨éŒ¯èª¤: $message', code: statusCode);
        }
        
      case DioErrorType.cancel:
        return NetworkFailure('è«‹æ±‚å·²å–æ¶ˆ');
        
      case DioErrorType.unknown:
      default:
        if (error.error is SocketException) {
          return NetworkFailure('ç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®š');
        }
        return ServerFailure('æœªçŸ¥ç¶²è·¯éŒ¯èª¤: ${error.message}');
    }
  }
}

// å…¨åŸŸéŒ¯èª¤é‚Šç•Œ Widget
class AppErrorBoundary extends StatefulWidget {
  final Widget child;
  
  const AppErrorBoundary({Key? key, required this.child}) : super(key: key);
  
  @override
  State<AppErrorBoundary> createState() => _AppErrorBoundaryState();
}

class _AppErrorBoundaryState extends State<AppErrorBoundary> {
  ErrorWidgetBuilder? _oldErrorWidgetBuilder;
  
  @override
  void initState() {
    super.initState();
    
    // è¨­å®šå…¨åŸŸéŒ¯èª¤è™•ç†
    _oldErrorWidgetBuilder = ErrorWidget.builder;
    ErrorWidget.builder = (FlutterErrorDetails details) {
      // è¨˜éŒ„éŒ¯èª¤
      getIt<LoggingService>().logError(
        details.exception,
        details.stack,
        details.context?.toString(),
      );
      
      // å›å‚³è‡ªè¨‚éŒ¯èª¤ Widget
      return _buildErrorWidget(details);
    };
    
    // è¨­å®š Flutter éŒ¯èª¤è™•ç†
    FlutterError.onError = (FlutterErrorDetails details) {
      getIt<LoggingService>().logError(
        details.exception,
        details.stack,
        details.context?.toString(),
      );
      
      // åœ¨ debug æ¨¡å¼ä¸‹é¡¯ç¤ºè©³ç´°éŒ¯èª¤
      if (kDebugMode) {
        FlutterError.presentError(details);
      }
    };
  }
  
  @override
  void dispose() {
    // æ¢å¾©åŸå§‹éŒ¯èª¤è™•ç†å™¨
    ErrorWidget.builder = _oldErrorWidgetBuilder!;
    super.dispose();
  }
  
  Widget _buildErrorWidget(FlutterErrorDetails details) {
    return Material(
      child: Container(
        padding: EdgeInsets.all(16),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              Icons.error_outline,
              size: 48,
              color: Colors.red,
            ),
            SizedBox(height: 16),
            Text(
              'æ‡‰ç”¨ç¨‹å¼ç™¼ç”ŸéŒ¯èª¤',
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
              ),
            ),
            SizedBox(height: 8),
            if (kDebugMode) ...[
              Text(
                details.exception.toString(),
                textAlign: TextAlign.center,
                style: TextStyle(fontSize: 12),
              ),
              SizedBox(height: 16),
            ],
            ElevatedButton(
              onPressed: () {
                // é‡æ–°å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
                runApp(MyApp());
              },
              child: Text('é‡æ–°å•Ÿå‹•'),
            ),
          ],
        ),
      ),
    );
  }
  
  @override
  Widget build(BuildContext context) {
    return widget.child;
  }
}
```

## ğŸ§ª æ¸¬è©¦åŸºç¤è¨­å®š

```dart
// ğŸ§ª æ¸¬è©¦åŸºç¤è¨­å®š
// ä½ç½®: test/helpers/test_helper.dart

import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:mockito/annotations.dart';
import 'package:provider/provider.dart';
import 'package:network_image_mock/network_image_mock.dart';

// æ¸¬è©¦è¼”åŠ©å·¥å…·
class TestHelper {
  // Mock è³‡æ–™
  static User createMockUser({
    String? id,
    String? name,
    String? email,
    UserStatus? status,
  }) {
    return User(
      id: id ?? 'test_user_id',
      name: name ?? 'Test User',
      email: email ?? 'test@example.com',
      status: status ?? UserStatus.active,
      lastLoginAt: DateTime.now(),
    );
  }
  
  static List<User> createMockUserList(int count) {
    return List.generate(count, (index) => createMockUser(
      id: 'user_$index',
      name: 'User $index',
      email: 'user$index@example.com',
    ));
  }
  
  static AuthToken createMockAuthToken({
    String? token,
    DateTime? expiresAt,
  }) {
    return AuthToken(
      accessToken: token ?? 'mock_access_token',
      refreshToken: 'mock_refresh_token',
      tokenType: 'Bearer',
      expiresAt: expiresAt ?? DateTime.now().add(Duration(hours: 1)),
    );
  }
  
  static ApiResponse<T> createMockApiResponse<T>({
    required T data,
    bool success = true,
    int statusCode = 200,
    String? error,
  }) {
    if (success) {
      return ApiResponse.success(data, statusCode);
    } else {
      return ApiResponse.failure(error ?? 'Mock error', statusCode);
    }
  }
  
  // æ¸¬è©¦ç”¨çš„ Widget åŒ…è£å™¨
  static Widget wrapWithMaterialApp(
    Widget child, {
    ThemeData? theme,
    Locale? locale,
    List<Locale>? supportedLocales,
    NavigatorObserver? navigatorObserver,
  }) {
    return MaterialApp(
      theme: theme,
      locale: locale,
      supportedLocales: supportedLocales ?? [Locale('en', 'US')],
      navigatorObservers: navigatorObserver != null ? [navigatorObserver] : [],
      home: Scaffold(body: child),
    );
  }
  
  static Widget wrapWithProviders(
    Widget child, {
    UserViewModel? userViewModel,
    AuthViewModel? authViewModel,
    ThemeViewModel? themeViewModel,
  }) {
    return MultiProvider(
      providers: [
        ChangeNotifierProvider<UserViewModel>(
          create: (_) => userViewModel ?? MockUserViewModel(),
        ),
        ChangeNotifierProvider<AuthViewModel>(
          create: (_) => authViewModel ?? MockAuthViewModel(),
        ),
        ChangeNotifierProvider<ThemeViewModel>(
          create: (_) => themeViewModel ?? MockThemeViewModel(),
        ),
      ],
      child: wrapWithMaterialApp(child),
    );
  }
  
  static Widget wrapWithMediaQuery(
    Widget child, {
    double width = 400,
    double height = 800,
    double devicePixelRatio = 1.0,
    Brightness platformBrightness = Brightness.light,
  }) {
    return MediaQuery(
      data: MediaQueryData(
        size: Size(width, height),
        devicePixelRatio: devicePixelRatio,
        platformBrightness: platformBrightness,
      ),
      child: child,
    );
  }
  
  // éåŒæ­¥æ“ä½œè¼”åŠ©
  static Future<void> pumpAndSettle(
    WidgetTester tester, {
    Duration timeout = const Duration(seconds: 10),
  }) async {
    await tester.pumpAndSettle(timeout);
  }
  
  static Future<void> pumpFrames(
    WidgetTester tester,
    int frames, {
    Duration duration = const Duration(milliseconds: 16),
  }) async {
    for (int i = 0; i < frames; i++) {
      await tester.pump(duration);
    }
  }
  
  // æ‰‹å‹¢æ¨¡æ“¬
  static Future<void> tapAndSettle(
    WidgetTester tester,
    Finder finder, {
    bool warnIfMissed = true,
  }) async {
    await tester.tap(finder, warnIfMissed: warnIfMissed);
    await pumpAndSettle(tester);
  }
  
  static Future<void> longPressAndSettle(
    WidgetTester tester,
    Finder finder, {
    bool warnIfMissed = true,
  }) async {
    await tester.longPress(finder, warnIfMissed: warnIfMissed);
    await pumpAndSettle(tester);
  }
  
  static Future<void> dragAndSettle(
    WidgetTester tester,
    Finder finder,
    Offset offset, {
    bool warnIfMissed = true,
  }) async {
    await tester.drag(finder, offset, warnIfMissed: warnIfMissed);
    await pumpAndSettle(tester);
  }
  
  // è¼¸å…¥æ¨¡æ“¬
  static Future<void> enterTextAndSettle(
    WidgetTester tester,
    Finder finder,
    String text,
  ) async {
    await tester.enterText(finder, text);
    await pumpAndSettle(tester);
  }
  
  // ç¶²è·¯åœ–ç‰‡æ¨¡æ“¬
  static Future<void> mockNetworkImages(
    Future<void> Function() testCode,
  ) async {
    return mockNetworkImagesFor(testCode);
  }
  
  // é©—è­‰è¼”åŠ©
  static void expectWidgetExists(Finder finder, {String? reason}) {
    expect(finder, findsOneWidget, reason: reason);
  }
  
  static void expectWidgetNotExists(Finder finder, {String? reason}) {
    expect(finder, findsNothing, reason: reason);
  }
  
  static void expectWidgetCount(Finder finder, int count, {String? reason}) {
    expect(finder, findsNWidgets(count), reason: reason);
  }
  
  static void expectTextExists(String text, {String? reason}) {
    expect(find.text(text), findsOneWidget, reason: reason);
  }
  
  // æ¸¬è©¦è³‡æ–™é‡ç½®
  static void resetMockData() {
    // é‡ç½®æ‰€æœ‰éœæ…‹æ¸¬è©¦è³‡æ–™
  }
  
  // æ¸¬è©¦ç’°å¢ƒè¨­å®š
  static void setUpTestEnvironment() {
    // è¨­å®šæ¸¬è©¦ç’°å¢ƒè®Šæ•¸
    TestWidgetsFlutterBinding.ensureInitialized();
  }
  
  static void tearDownTestEnvironment() {
    // æ¸…ç†æ¸¬è©¦ç’°å¢ƒ
    resetMockData();
  }
}

// Mock é¡åˆ¥ç”Ÿæˆå™¨è¨»è§£
@GenerateMocks([
  UserRepository,
  UserRemoteDataSource,
  UserLocalDataSource,
  AuthRepository,
  AuthRemoteDataSource,
  AuthLocalDataSource,
  NetworkInfo,
  ValidationService,
  LocalStorage,
  ApiClient,
  AnalyticsService,
  LoggingService,
])
void main() {}

// æ‰‹å‹• Mock é¡åˆ¥ (è¤‡é›œè¡Œç‚ºæ¨¡æ“¬)
class MockUserViewModel extends Mock implements UserViewModel {
  @override
  User? user;
  
  @override
  bool isLoading = false;
  
  @override
  String? errorMessage;
  
  @override
  bool isUpdating = false;
  
  @override
  bool get hasUser => user != null;
  
  void setMockState({
    User? mockUser,
    bool mockIsLoading = false,
    String? mockError,
    bool mockIsUpdating = false,
  }) {
    user = mockUser;
    isLoading = mockIsLoading;
    errorMessage = mockError;
    isUpdating = mockIsUpdating;
    notifyListeners();
  }
}

class MockAuthViewModel extends Mock implements AuthViewModel {
  @override
  User? currentUser;
  
  @override
  bool isAuthenticated = false;
  
  @override
  bool isLoading = false;
  
  @override
  String? errorMessage;
  
  void setMockAuthState({
    User? mockUser,
    bool mockIsAuthenticated = false,
    bool mockIsLoading = false,
    String? mockError,
  }) {
    currentUser = mockUser;
    isAuthenticated = mockIsAuthenticated;
    isLoading = mockIsLoading;
    errorMessage = mockError;
    notifyListeners();
  }
}

class MockThemeViewModel extends Mock implements ThemeViewModel {
  @override
  ThemeMode themeMode = ThemeMode.light;
  
  @override
  bool get isDarkMode => themeMode == ThemeMode.dark;
  
  void setMockTheme(ThemeMode mode) {
    themeMode = mode;
    notifyListeners();
  }
}
```

------

## ğŸ”¬ å–®å…ƒæ¸¬è©¦è¨­è¨ˆ

### UseCase æ¸¬è©¦ç¯„ä¾‹

```dart
// ä½ç½®: test/unit/domain/usecases/get_user_profile_usecase_test.dart

import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:dartz/dartz.dart';

import '../../../helpers/test_helper.dart';
import '../../../helpers/test_helper.mocks.dart';

void main() {
  late GetUserProfileUseCase useCase;
  late MockUserRepository mockRepository;
  
  setUp(() {
    TestHelper.setUpTestEnvironment();
    mockRepository = MockUserRepository();
    useCase = GetUserProfileUseCase(mockRepository);
  });
  
  tearDown(() {
    TestHelper.tearDownTestEnvironment();
  });
  
  group('GetUserProfileUseCase', () {
    const String testUserId = 'test_user_id';
    final User testUser = TestHelper.createMockUser(id: testUserId);
    
    test('should return User when repository call is successful', () async {
      // arrange
      when(mockRepository.getUserById(testUserId))
          .thenAnswer((_) async => testUser);
      
      // act
      final result = await useCase.execute(testUserId);
      
      // assert
      expect(result, equals(Right(testUser)));
      verify(mockRepository.getUserById(testUserId));
      verifyNoMoreInteractions(mockRepository);
    });
    
    test('should return NotFoundFailure when user does not exist', () async {
      // arrange
      when(mockRepository.getUserById(testUserId))
          .thenAnswer((_) async => null);
      
      // act
      final result = await useCase.execute(testUserId);
      
      // assert
      expect(result, equals(Left(NotFoundFailure('æ‰¾ä¸åˆ°æŒ‡å®šçš„ä½¿ç”¨è€…'))));
      verify(mockRepository.getUserById(testUserId));
      verifyNoMoreInteractions(mockRepository);
    });
    
    test('should return ValidationFailure when userId is empty', () async {
      // act
      final result = await useCase.execute('');
      
      // assert
      expect(result, equals(Left(ValidationFailure('ä½¿ç”¨è€… ID ä¸èƒ½ç‚ºç©º'))));
      verifyNever(mockRepository.getUserById(any));
    });
    
    test('should return ServerFailure when repository throws exception', () async {
      // arrange
      when(mockRepository.getUserById(testUserId))
          .thenThrow(ServerException('Database connection failed'));
      
      // act
      final result = await useCase.execute(testUserId);
      
      // assert
      expect(result.isLeft(), true);
      result.fold(
        (failure) {
          expect(failure, isA<ServerFailure>());
          expect(failure.message, contains('å–å¾—ä½¿ç”¨è€…è³‡æ–™å¤±æ•—'));
        },
        (user) => fail('Should return failure'),
      );
      verify(mockRepository.getUserById(testUserId));
    });
    
    test('should handle multiple concurrent calls correctly', () async {
      // arrange
      when(mockRepository.getUserById(any))
          .thenAnswer((_) async {
            await Future.delayed(Duration(milliseconds: 100));
            return testUser;
          });
      
      // act
      final futures = List.generate(
        5,
        (_) => useCase.execute(testUserId),
      );
      final results = await Future.wait(futures);
      
      // assert
      for (final result in results) {
        expect(result, equals(Right(testUser)));
      }
      verify(mockRepository.getUserById(testUserId)).called(5);
    });
  });
  
  group('Edge Cases', () {
    test('should handle null userId gracefully', () async {
      // act
      final result = await useCase.execute(null as dynamic);
      
      // assert
      expect(result.isLeft(), true);
      result.fold(
        (failure) => expect(failure, isA<ValidationFailure>()),
        (user) => fail('Should return validation failure'),
      );
    });
    
    test('should handle very long userId', () async {
      // arrange
      final longUserId = 'a' * 1000;
      when(mockRepository.getUserById(longUserId))
          .thenAnswer((_) async => TestHelper.createMockUser(id: longUserId));
      
      // act
      final result = await useCase.execute(longUserId);
      
      // assert
      expect(result.isRight(), true);
    });
  });
}
```

### Repository æ¸¬è©¦ç¯„ä¾‹

```dart
// ä½ç½®: test/unit/data/repositories/user_repository_impl_test.dart

import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';

import '../../../helpers/test_helper.dart';
import '../../../helpers/test_helper.mocks.dart';

void main() {
  late UserRepositoryImpl repository;
  late MockUserRemoteDataSource mockRemoteDataSource;
  late MockUserLocalDataSource mockLocalDataSource;
  late MockNetworkInfo mockNetworkInfo;
  
  setUp(() {
    TestHelper.setUpTestEnvironment();
    mockRemoteDataSource = MockUserRemoteDataSource();
    mockLocalDataSource = MockUserLocalDataSource();
    mockNetworkInfo = MockNetworkInfo();
    
    repository = UserRepositoryImpl(
      remoteDataSource: mockRemoteDataSource,
      localDataSource: mockLocalDataSource,
      networkInfo: mockNetworkInfo,
    );
  });
  
  tearDown(() {
    TestHelper.tearDownTestEnvironment();
  });
  
  group('getUserById', () {
    const String testUserId = 'test_user_id';
    final UserResponse testUserResponse = UserResponse(
      id: testUserId,
      name: 'Test User',
      email: 'test@example.com',
      status: 'active',
    );
    final User testUser = testUserResponse.toEntity();
    
    test('should return remote data when device is online', () async {
      // arrange
      when(mockNetworkInfo.isConnected).thenAnswer((_) async => true);
      when(mockRemoteDataSource.getUserById(testUserId))
          .thenAnswer((_) async => testUserResponse);
      when(mockLocalDataSource.cacheUser(testUserResponse))
          .thenAnswer((_) async {});
      
      // act
      final result = await repository.getUserById(testUserId);
      
      // assert
      expect(result, equals(testUser));
      verify(mockNetworkInfo.isConnected);
      verify(mockRemoteDataSource.getUserById(testUserId));
      verify(mockLocalDataSource.cacheUser(testUserResponse));
    });
    
    test('should return cached data when device is offline', () async {
      // arrange
      when(mockNetworkInfo.isConnected).thenAnswer((_) async => false);
      when(mockLocalDataSource.getUserById(testUserId))
          .thenAnswer((_) async => testUserResponse);
      
      // act
      final result = await repository.getUserById(testUserId);
      
      // assert
      expect(result, equals(testUser));
      verify(mockNetworkInfo.isConnected);
      verify(mockLocalDataSource.getUserById(testUserId));
      verifyNever(mockRemoteDataSource.getUserById(any));
    });
    
    test('should fallback to cached data when remote fails', () async {
      // arrange
      when(mockNetworkInfo.isConnected).thenAnswer((_) async => true);
      when(mockRemoteDataSource.getUserById(testUserId))
          .thenThrow(ServerException('Network error'));
      when(mockLocalDataSource.getUserById(testUserId))
          .thenAnswer((_) async => testUserResponse);
      
      // act
      final result = await repository.getUserById(testUserId);
      
      // assert
      expect(result, equals(testUser));
      verify(mockNetworkInfo.isConnected);
      verify(mockRemoteDataSource.getUserById(testUserId));
      verify(mockLocalDataSource.getUserById(testUserId));
    });
    
    test('should throw UserException when both remote and local fail', () async {
      // arrange
      when(mockNetworkInfo.isConnected).thenAnswer((_) async => true);
      when(mockRemoteDataSource.getUserById(testUserId))
          .thenThrow(ServerException('Network error'));
      when(mockLocalDataSource.getUserById(testUserId))
          .thenThrow(CacheException('Cache error'));
      
      // act & assert
      expect(
        () => repository.getUserById(testUserId),
        throwsA(isA<UserException>()),
      );
    });
    
    test('should update cache with latest remote data', () async {
      // arrange
      final cachedUserResponse = UserResponse(
        id: testUserId,
        name: 'Cached User',
        email: 'cached@example.com',
        status: 'inactive',
      );
      
      when(mockNetworkInfo.isConnected).thenAnswer((_) async => true);
      when(mockLocalDataSource.getUserById(testUserId))
          .thenAnswer((_) async => cachedUserResponse);
      when(mockRemoteDataSource.getUserById(testUserId))
          .thenAnswer((_) async => testUserResponse);
      when(mockLocalDataSource.cacheUser(testUserResponse))
          .thenAnswer((_) async {});
      
      // act
      final result = await repository.getUserById(testUserId);
      
      // assert
      expect(result, equals(testUser));
      expect(result?.name, equals('Test User')); // ç¢ºä¿æ˜¯é ç«¯è³‡æ–™
      verify(mockLocalDataSource.cacheUser(testUserResponse));
    });
  });
  
  group('createUser', () {
    final User newUser = TestHelper.createMockUser(
      id: 'new_user_id',
      name: 'New User',
    );
    
    test('should create user successfully when online', () async {
      // arrange
      when(mockNetworkInfo.isConnected).thenAnswer((_) async => true);
      final userResponse = UserResponse(
        id: newUser.id,
        name: newUser.name,
        email: newUser.email,
        status: newUser.status.toString().split('.').last,
      );
      when(mockRemoteDataSource.createUser(any))
          .thenAnswer((_) async => userResponse);
      when(mockLocalDataSource.cacheUser(userResponse))
          .thenAnswer((_) async {});
      
      // act
      final result = await repository.createUser(newUser);
      
      // assert
      expect(result.id, equals(newUser.id));
      verify(mockNetworkInfo.isConnected);
      verify(mockRemoteDataSource.createUser(any));
      verify(mockLocalDataSource.cacheUser(userResponse));
    });
    
    test('should throw NetworkException when offline', () async {
      // arrange
      when(mockNetworkInfo.isConnected).thenAnswer((_) async => false);
      
      // act & assert
      expect(
        () => repository.createUser(newUser),
        throwsA(isA<NetworkException>()),
      );
      
      verifyNever(mockRemoteDataSource.createUser(any));
      verifyNever(mockLocalDataSource.cacheUser(any));
    });
  });
}
```

### ViewModel æ¸¬è©¦ç¯„ä¾‹

```dart
// ä½ç½®: test/unit/presentation/providers/user_view_model_test.dart

import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:dartz/dartz.dart';

import '../../../helpers/test_helper.dart';
import '../../../helpers/test_helper.mocks.dart';

void main() {
  late UserViewModel viewModel;
  late MockGetUserProfileUseCase mockGetUserProfileUseCase;
  late MockUpdateUserProfileUseCase mockUpdateUserProfileUseCase;
  late MockDeleteUserAccountUseCase mockDeleteUserAccountUseCase;
  
  setUp(() {
    TestHelper.setUpTestEnvironment();
    mockGetUserProfileUseCase = MockGetUserProfileUseCase();
    mockUpdateUserProfileUseCase = MockUpdateUserProfileUseCase();
    mockDeleteUserAccountUseCase = MockDeleteUserAccountUseCase();
    
    viewModel = UserViewModel(
      getUserProfileUseCase: mockGetUserProfileUseCase,
      updateUserProfileUseCase: mockUpdateUserProfileUseCase,
      deleteUserAccountUseCase: mockDeleteUserAccountUseCase,
    );
  });
  
  tearDown(() {
    viewModel.dispose();
    TestHelper.tearDownTestEnvironment();
  });
  
  group('loadUserProfile', () {
    const String testUserId = 'test_user_id';
    final User testUser = TestHelper.createMockUser(id: testUserId);
    
    test('should load user profile successfully', () async {
      // arrange
      when(mockGetUserProfileUseCase.execute(testUserId))
          .thenAnswer((_) async => Right(testUser));
      
      // act
      await viewModel.loadUserProfile(testUserId);
      
      // assert
      expect(viewModel.user, equals(testUser));
      expect(viewModel.isLoading, false);
      expect(viewModel.errorMessage, isNull);
      expect(viewModel.hasUser, true);
      
      verify(mockGetUserProfileUseCase.execute(testUserId));
    });
    
    test('should set loading state correctly', () async {
      // arrange
      when(mockGetUserProfileUseCase.execute(testUserId))
          .thenAnswer((_) async {
            await Future.delayed(Duration(milliseconds: 100));
            return Right(testUser);
          });
      
      // act
      final future = viewModel.loadUserProfile(testUserId);
      
      // assert - during loading
      expect(viewModel.isLoading, true);
      expect(viewModel.errorMessage, isNull);
      
      await future;
      
      // assert - after loading
      expect(viewModel.isLoading, false);
      expect(viewModel.user, equals(testUser));
    });
    
    test('should handle error correctly', () async {
      // arrange
      const errorMessage = 'Failed to load user';
      when(mockGetUserProfileUseCase.execute(testUserId))
          .thenAnswer((_) async => Left(ServerFailure(errorMessage)));
      
      // act
      await viewModel.loadUserProfile(testUserId);
      
      // assert
      expect(viewModel.user, isNull);
      expect(viewModel.isLoading, false);
      expect(viewModel.errorMessage, equals(errorMessage));
      expect(viewModel.hasUser, false);
    });
    
    test('should notify listeners when state changes', () async {
      // arrange
      int notifyCount = 0;
      viewModel.addListener(() => notifyCount++);
      
      when(mockGetUserProfileUseCase.execute(testUserId))
          .thenAnswer((_) async => Right(testUser));
      
      // act
      await viewModel.loadUserProfile(testUserId);
      
      // assert
      expect(notifyCount, greaterThan(0));
    });
    
    test('should clear previous error before loading', () async {
      // arrange
      viewModel.setError('Previous error'); // å‡è¨­æœ‰é€™å€‹æ–¹æ³•ç”¨æ–¼æ¸¬è©¦
      when(mockGetUserProfileUseCase.execute(testUserId))
          .thenAnswer((_) async => Right(testUser));
      
      // act
      await viewModel.loadUserProfile(testUserId);
      
      // assert
      expect(viewModel.errorMessage, isNull);
    });
  });
  
  group('updateProfile', () {
    final User originalUser = TestHelper.createMockUser();
    final User updatedUser = originalUser.copyWith(
      name: 'Updated Name',
      email: 'updated@example.com',
    );
    
    setUp(() {
      viewModel.user = originalUser; // è¨­å®šåˆå§‹ä½¿ç”¨è€…
    });
    
    test('should update profile successfully', () async {
      // arrange
      when(mockUpdateUserProfileUseCase.execute(any))
          .thenAnswer((_) async => Right(updatedUser));
      
      // act
      await viewModel.updateProfile(
        name: 'Updated Name',
        email: 'updated@example.com',
      );
      
      // assert
      expect(viewModel.user, equals(updatedUser));
      expect(viewModel.isUpdating, false);
      expect(viewModel.errorMessage, isNull);
      
      verify(mockUpdateUserProfileUseCase.execute(any));
    });
    
    test('should set updating state correctly', () async {
      // arrange
      when(mockUpdateUserProfileUseCase.execute(any))
          .thenAnswer((_) async {
            await Future.delayed(Duration(milliseconds: 100));
            return Right(updatedUser);
          });
      
      // act
      final future = viewModel.updateProfile(
        name: 'Updated Name',
        email: 'updated@example.com',
      );
      
      // assert - during update
      expect(viewModel.isUpdating, true);
      
      await future;
      
      // assert - after update
      expect(viewModel.isUpdating, false);
    });
    
    test('should not update when user is null', () async {
      // arrange
      viewModel.user = null;
      
      // act
      await viewModel.updateProfile(
        name: 'Updated Name',
        email: 'updated@example.com',
      );
      
      // assert
      verifyNever(mockUpdateUserProfileUseCase.execute(any));
      expect(viewModel.isUpdating, false);
    });
    
    test('should handle update error correctly', () async {
      // arrange
      const errorMessage = 'Update failed';
      when(mockUpdateUserProfileUseCase.execute(any))
          .thenAnswer((_) async => Left(ValidationFailure(errorMessage)));
      
      // act
      await viewModel.updateProfile(
        name: 'Updated Name',
        email: 'updated@example.com',
      );
      
      // assert
      expect(viewModel.user, equals(originalUser)); // ä½¿ç”¨è€…æœªè®Šæ›´
      expect(viewModel.isUpdating, false);
      expect(viewModel.errorMessage, equals(errorMessage));
    });
  });
  
  group('deleteAccount', () {
    final User testUser = TestHelper.createMockUser();
    
    setUp(() {
      viewModel.user = testUser;
    });
    
    test('should delete account successfully', () async {
      // arrange
      when(mockDeleteUserAccountUseCase.execute(testUser.id))
          .thenAnswer((_) async => Right(null));
      
      // act
      final result = await viewModel.deleteAccount();
      
      // assert
      expect(result, true);
      expect(viewModel.user, isNull);
      expect(viewModel.isLoading, false);
      expect(viewModel.errorMessage, isNull);
      
      verify(mockDeleteUserAccountUseCase.execute(testUser.id));
    });
    
    test('should return false when user is null', () async {
      // arrange
      viewModel.user = null;
      
      // act
      final result = await viewModel.deleteAccount();
      
      // assert
      expect(result, false);
      verifyNever(mockDeleteUserAccountUseCase.execute(any));
    });
    
    test('should handle delete error correctly', () async {
      // arrange
      const errorMessage = 'Delete failed';
      when(mockDeleteUserAccountUseCase.execute(testUser.id))
          .thenAnswer((_) async => Left(ServerFailure(errorMessage)));
      
      // act
      final result = await viewModel.deleteAccount();
      
      // assert
      expect(result, false);
      expect(viewModel.user, equals(testUser)); // ä½¿ç”¨è€…ä»å­˜åœ¨
      expect(viewModel.isLoading, false);
      expect(viewModel.errorMessage, equals(errorMessage));
    });
  });
  
  group('refresh', () {
    final User testUser = TestHelper.createMockUser();
    
    test('should refresh user data when user exists', () async {
      // arrange
      viewModel.user = testUser;
      when(mockGetUserProfileUseCase.execute(testUser.id))
          .thenAnswer((_) async => Right(testUser));
      
      // act
      await viewModel.refresh();
      
      // assert
      verify(mockGetUserProfileUseCase.execute(testUser.id));
    });
    
    test('should not refresh when user is null', () async {
      // arrange
      viewModel.user = null;
      
      // act
      await viewModel.refresh();
      
      // assert
      verifyNever(mockGetUserProfileUseCase.execute(any));
    });
  });
  
  group('clearError', () {
    test('should clear error message', () {
      // arrange
      viewModel.setError('Test error'); // å‡è¨­æœ‰é€™å€‹æ–¹æ³•
      
      // act
      viewModel.clearError();
      
      // assert
      expect(viewModel.errorMessage, isNull);
    });
  });
}
```

------

## ğŸ–¼ï¸ Widget æ¸¬è©¦è¨­è¨ˆ

### åŸºæœ¬ Widget æ¸¬è©¦

```dart
// ä½ç½®: test/widget/pages/user_profile_page_test.dart

import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:provider/provider.dart';
import 'package:mockito/mockito.dart';
import 'package:network_image_mock/network_image_mock.dart';

import '../../helpers/test_helper.dart';
import '../../helpers/test_helper.mocks.dart';

void main() {
  late MockUserViewModel mockViewModel;
  
  setUp(() {
    TestHelper.setUpTestEnvironment();
    mockViewModel = MockUserViewModel();
  });
  
  tearDown(() {
    TestHelper.tearDownTestEnvironment();
  });
  
  group('UserProfilePage Widget Tests', () {
    testWidgets('should display loading indicator when isLoading is true', (WidgetTester tester) async {
      // arrange
      mockViewModel.setMockState(mockIsLoading: true);
      
      // act
      await tester.pumpWidget(
        ChangeNotifierProvider<UserViewModel>.value(
          value: mockViewModel,
          child: TestHelper.wrapWithMaterialApp(
            UserProfilePage(userId: 'test_id'),
          ),
        ),
      );
      
      // assert
      TestHelper.expectWidgetExists(
        find.byType(CircularProgressIndicator),
        reason: 'Loading indicator should be visible',
      );
      TestHelper.expectTextExists('è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™ä¸­...');
    });
    
    testWidgets('should display user profile when user is loaded', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser(
        name: 'John Doe',
        email: 'john@example.com',
      );
      mockViewModel.setMockState(mockUser: testUser);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectTextExists(testUser.displayName);
      TestHelper.expectTextExists(testUser.email);
      TestHelper.expectTextExists('ç·¨è¼¯å€‹äººè³‡æ–™');
      TestHelper.expectWidgetExists(find.byType(CircleAvatar));
    });
    
    testWidgets('should display error message when error occurs', (WidgetTester tester) async {
      // arrange
      const errorMessage = 'Failed to load user';
      mockViewModel.setMockState(mockError: errorMessage);
      
      // act
      await tester.pumpWidget(
        ChangeNotifierProvider<UserViewModel>.value(
          value: mockViewModel,
          child: TestHelper.wrapWithMaterialApp(
            UserProfilePage(userId: 'test_id'),
          ),
        ),
      );
      
      // assert
      TestHelper.expectTextExists('è¼‰å…¥å¤±æ•—');
      TestHelper.expectTextExists(errorMessage);
      TestHelper.expectTextExists('é‡æ–°è¼‰å…¥');
      TestHelper.expectWidgetExists(find.byIcon(Icons.error_outline));
    });
    
    testWidgets('should call refresh when refresh button is tapped', (WidgetTester tester) async {
      // arrange
      const errorMessage = 'Failed to load user';
      mockViewModel.setMockState(mockError: errorMessage);
      
      // act
      await tester.pumpWidget(
        ChangeNotifierProvider<UserViewModel>.value(
          value: mockViewModel,
          child: TestHelper.wrapWithMaterialApp(
            UserProfilePage(userId: 'test_id'),
          ),
        ),
      );
      
      await TestHelper.tapAndSettle(tester, find.text('é‡æ–°è¼‰å…¥'));
      
      // assert
      verify(mockViewModel.loadUserProfile('test_id')).called(1);
    });
    
    testWidgets('should show error banner when error exists but user is loaded', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      const errorMessage = 'Update failed';
      mockViewModel.setMockState(
        mockUser: testUser,
        mockError: errorMessage,
      );
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectTextExists(errorMessage);
      TestHelper.expectWidgetExists(find.byIcon(Icons.error));
      TestHelper.expectWidgetExists(find.byIcon(Icons.close));
    });
    
    testWidgets('should dismiss error banner when close button is tapped', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      const errorMessage = 'Update failed';
      mockViewModel.setMockState(
        mockUser: testUser,
        mockError: errorMessage,
      );
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      await TestHelper.tapAndSettle(tester, find.byIcon(Icons.close));
      
      // assert
      verify(mockViewModel.clearError()).called(1);
    });
    
    testWidgets('should show correct status chip based on user status', (WidgetTester tester) async {
      // arrange
      final activeUser = TestHelper.createMockUser(status: UserStatus.active);
      mockViewModel.setMockState(mockUser: activeUser);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectTextExists('æ´»èº');
      
      // Test different status
      final inactiveUser = TestHelper.createMockUser(status: UserStatus.inactive);
      mockViewModel.setMockState(mockUser: inactiveUser);
      await tester.pump();
      
      TestHelper.expectTextExists('éæ´»èº');
    });
    
    testWidgets('should navigate to edit profile page when edit button is tapped', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(mockUser: testUser);
      
      final mockNavigatorObserver = MockNavigatorObserver();
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: MaterialApp(
              navigatorObservers: [mockNavigatorObserver],
              home: UserProfilePage(userId: 'test_id'),
              routes: {
                '/edit-profile': (context) => EditProfilePage(user: testUser),
              },
            ),
          ),
        );
      });
      
      await TestHelper.tapAndSettle(tester, find.text('ç·¨è¼¯å€‹äººè³‡æ–™'));
      
      // assert
      verify(mockNavigatorObserver.didPush(any, any));
    });
    
    testWidgets('should show loading indicator on buttons when isUpdating is true', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(
        mockUser: testUser,
        mockIsUpdating: true,
      );
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectTextExists('æ›´æ–°ä¸­...');
      TestHelper.expectWidgetExists(find.byType(CircularProgressIndicator));
    });
    
    testWidgets('should show delete confirmation dialog when delete button is tapped', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(mockUser: testUser);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      await TestHelper.tapAndSettle(tester, find.text('åˆªé™¤å¸³è™Ÿ'));
      
      // assert
      TestHelper.expectWidgetExists(find.byType(AlertDialog));
      TestHelper.expectTextExists('åˆªé™¤å¸³è™Ÿ');
      TestHelper.expectTextExists('ç¢ºå®šè¦åˆªé™¤æ­¤å¸³è™Ÿå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚');
      TestHelper.expectTextExists('å–æ¶ˆ');
      TestHelper.expectTextExists('åˆªé™¤');
    });
    
    testWidgets('should call deleteAccount when delete is confirmed', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(mockUser: testUser);
      when(mockViewModel.deleteAccount()).thenAnswer((_) async => true);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      await TestHelper.tapAndSettle(tester, find.text('åˆªé™¤å¸³è™Ÿ'));
      await TestHelper.tapAndSettle(tester, find.text('åˆªé™¤'));
      
      // assert
      verify(mockViewModel.deleteAccount()).called(1);
    });
  });
  
  group('UserProfilePage Responsive Tests', () {
    testWidgets('should adapt layout for different screen sizes', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(mockUser: testUser);
      
      // act - Mobile screen
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMediaQuery(
            ChangeNotifierProvider<UserViewModel>.value(
              value: mockViewModel,
              child: TestHelper.wrapWithMaterialApp(
                UserProfilePage(userId: 'test_id'),
              ),
            ),
            width: 375, // Mobile width
            height: 812,
          ),
        );
      });
      
      // assert - Mobile layout
      TestHelper.expectWidgetExists(find.byType(Column));
      
      // act - Tablet screen
      await tester.pumpWidget(
        TestHelper.wrapWithMediaQuery(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
          width: 768, // Tablet width
          height: 1024,
        ),
      );
      
      await tester.pump();
      
      // assert - Layout should still work on tablet
      TestHelper.expectWidgetExists(find.byType(UserProfilePage));
    });
    
    testWidgets('should handle dark theme correctly', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(mockUser: testUser);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMediaQuery(
            ChangeNotifierProvider<UserViewModel>.value(
              value: mockViewModel,
              child: MaterialApp(
                theme: ThemeData.light(),
                darkTheme: ThemeData.dark(),
                themeMode: ThemeMode.dark,
                home: UserProfilePage(userId: 'test_id'),
              ),
            ),
            platformBrightness: Brightness.dark,
          ),
        );
      });
      
      // assert
      final materialApp = tester.widget<MaterialApp>(find.byType(MaterialApp));
      expect(materialApp.darkTheme, isNotNull);
    });
  });
  
  group('UserProfilePage Accessibility Tests', () {
    testWidgets('should have proper accessibility labels', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(mockUser: testUser);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectWidgetExists(find.byType(Semantics));
      
      // æª¢æŸ¥é‡è¦æŒ‰éˆ•æ˜¯å¦æœ‰é©ç•¶çš„èªç¾©æ¨™ç±¤
      final editButton = find.text('ç·¨è¼¯å€‹äººè³‡æ–™');
      expect(editButton, findsOneWidget);
      
      final deleteButton = find.text('åˆªé™¤å¸³è™Ÿ');
      expect(deleteButton, findsOneWidget);
    });
    
    testWidgets('should be navigable with keyboard', (WidgetTester tester) async {
      // arrange
      final testUser = TestHelper.createMockUser();
      mockViewModel.setMockState(mockUser: testUser);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          ChangeNotifierProvider<UserViewModel>.value(
            value: mockViewModel,
            child: TestHelper.wrapWithMaterialApp(
              UserProfilePage(userId: 'test_id'),
            ),
          ),
        );
      });
      
      // æ¨¡æ“¬ Tab éµå°èˆª
      await tester.sendKeyEvent(LogicalKeyboardKey.tab);
      await tester.pump();
      
      // assert
      // ç¢ºä¿ç„¦é»å¯ä»¥åœ¨å¯äº¤äº’å…ƒç´ ä¹‹é–“ç§»å‹•
      TestHelper.expectWidgetExists(find.byType(Focus));
    });
  });
}

// Mock Navigator Observer
class MockNavigatorObserver extends Mock implements NavigatorObserver {}
```

### è¤‡é›œ Widget æ¸¬è©¦

```dart
// ä½ç½®: test/widget/widgets/user_list_widget_test.dart

import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';

import '../../helpers/test_helper.dart';

void main() {
  group('UserListWidget Tests', () {
    testWidgets('should display list of users', (WidgetTester tester) async {
      // arrange
      final users = TestHelper.createMockUserList(5);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            UserListWidget(
              users: users,
              onUserTap: (user) {},
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectWidgetCount(find.byType(ListTile), 5);
      
      for (final user in users) {
        TestHelper.expectTextExists(user.name);
        TestHelper.expectTextExists(user.email);
      }
    });
    
    testWidgets('should handle empty user list', (WidgetTester tester) async {
      // act
      await tester.pumpWidget(
        TestHelper.wrapWithMaterialApp(
          UserListWidget(
            users: [],
            onUserTap: (user) {},
          ),
        ),
      );
      
      // assert
      TestHelper.expectTextExists('æ²’æœ‰ä½¿ç”¨è€…è³‡æ–™');
      TestHelper.expectWidgetExists(find.byIcon(Icons.person_outline));
    });
    
    testWidgets('should call onUserTap when user is tapped', (WidgetTester tester) async {
      // arrange
      final users = TestHelper.createMockUserList(3);
      User? tappedUser;
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            UserListWidget(
              users: users,
              onUserTap: (user) => tappedUser = user,
            ),
          ),
        );
      });
      
      await TestHelper.tapAndSettle(tester, find.text(users[1].name));
      
      // assert
      expect(tappedUser, equals(users[1]));
    });
    
    testWidgets('should support pull to refresh', (WidgetTester tester) async {
      // arrange
      final users = TestHelper.createMockUserList(3);
      bool refreshCalled = false;
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            RefreshIndicator(
              onRefresh: () async {
                refreshCalled = true;
              },
              child: UserListWidget(
                users: users,
                onUserTap: (user) {},
              ),
            ),
          ),
        );
      });
      
      // æ¨¡æ“¬ä¸‹æ‹‰åˆ·æ–°
      await tester.fling(
        find.byType(ListView),
        const Offset(0, 300),
        1000,
      );
      await TestHelper.pumpAndSettle(tester);
      
      // assert
      expect(refreshCalled, true);
    });
    
    testWidgets('should handle scroll to load more', (WidgetTester tester) async {
      // arrange
      final users = TestHelper.createMockUserList(20);
      bool loadMoreCalled = false;
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            UserListWidget(
              users: users,
              onUserTap: (user) {},
              onLoadMore: () => loadMoreCalled = true,
            ),
          ),
        );
      });
      
      // æ»¾å‹•åˆ°åº•éƒ¨
      await tester.scrollUntilVisible(
        find.text(users.last.name),
        500.0,
      );
      await TestHelper.pumpAndSettle(tester);
      
      // assert
      expect(loadMoreCalled, true);
    });
    
    testWidgets('should show loading indicator when loading more', (WidgetTester tester) async {
      // arrange
      final users = TestHelper.createMockUserList(10);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            UserListWidget(
              users: users,
              onUserTap: (user) {},
              isLoadingMore: true,
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectWidgetExists(find.byType(CircularProgressIndicator));
    });
    
    testWidgets('should filter users based on search query', (WidgetTester tester) async {
      // arrange
      final users = [
        TestHelper.createMockUser(name: 'John Doe', email: 'john@example.com'),
        TestHelper.createMockUser(name: 'Jane Smith', email: 'jane@example.com'),
        TestHelper.createMockUser(name: 'Bob Johnson', email: 'bob@example.com'),
      ];
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            Column(
              children: [
                TextField(
                  key: Key('search_field'),
                  onChanged: (query) {
                    // é€™è£¡æ‡‰è©²è§¸ç™¼æœå°‹é‚è¼¯
                  },
                ),
                Expanded(
                  child: UserListWidget(
                    users: users.where((user) =>
                        user.name.toLowerCase().contains('john')).toList(),
                    onUserTap: (user) {},
                  ),
                ),
              ],
            ),
          ),
        );
      });
      
      // assert
      TestHelper.expectTextExists('John Doe');
      TestHelper.expectTextExists('Bob Johnson');
      TestHelper.expectWidgetNotExists(find.text('Jane Smith'));
    });
  });
  
  group('UserListWidget Performance Tests', () {
    testWidgets('should handle large list efficiently', (WidgetTester tester) async {
      // arrange
      final largeUserList = TestHelper.createMockUserList(1000);
      
      // act
      final stopwatch = Stopwatch()..start();
      
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            UserListWidget(
              users: largeUserList,
              onUserTap: (user) {},
            ),
          ),
        );
      });
      
      stopwatch.stop();
      
      // assert
      expect(stopwatch.elapsedMilliseconds, lessThan(1000)); // æ‡‰è©²åœ¨ 1 ç§’å…§å®Œæˆ
      
      // ç¢ºä¿åªæ¸²æŸ“å¯è¦‹çš„é …ç›®ï¼ˆListView.builder çš„å„ªå‹¢ï¼‰
      final listTiles = tester.widgetList(find.byType(ListTile));
      expect(listTiles.length, lessThan(20)); // å±å¹•ä¸Šä¸æ‡‰è©²æœ‰å¤ªå¤š ListTile
    });
    
    testWidgets('should recycle list items efficiently', (WidgetTester tester) async {
      // arrange
      final users = TestHelper.createMockUserList(100);
      
      // act
      await TestHelper.mockNetworkImages(() async {
        await tester.pumpWidget(
          TestHelper.wrapWithMaterialApp(
            UserListWidget(
              users: users,
              onUserTap: (user) {},
            ),
          ),
        );
      });
      
      // è¨˜éŒ„åˆå§‹çš„ ListTile æ•¸é‡
      final initialTileCount = tester.widgetList(find.byType(ListTile)).length;
      
      // æ»¾å‹•åˆ—è¡¨
      await tester.drag(find.byType(ListView), const Offset(0, -2000));
      await tester.pump();
      
      // å†æ¬¡æª¢æŸ¥ ListTile æ•¸é‡
      final afterScrollTileCount = tester.widgetList(find.byType(ListTile)).length;
      
      // assert
      // ListView.builder æ‡‰è©²å›æ”¶ä¸å¯è¦‹çš„é …ç›®
      expect(afterScrollTileCount, lessThanOrEqualTo(initialTileCount + 5));
    });
  });
}
```

------

## ğŸ”— Integration æ¸¬è©¦è¨­è¨ˆ

### å®Œæ•´æµç¨‹æ¸¬è©¦

```dart
// ä½ç½®: test/integration/user_flow_test.dart

import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';

import '../helpers/test_helper.dart';

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();
  
  group('User Profile Flow Integration Tests', () {
    testWidgets('complete user authentication and profile management flow', (WidgetTester tester) async {
      // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
      await tester.pumpWidget(MyApp());
      await TestHelper.pumpAndSettle(tester);
      
      // æ­¥é©Ÿ 1: ä½¿ç”¨è€…ç™»å…¥
      await _performLogin(tester);
      
      // æ­¥é©Ÿ 2: å°èˆªåˆ°å€‹äººè³‡æ–™é é¢
      await _navigateToProfile(tester);
      
      // æ­¥é©Ÿ 3: æŸ¥çœ‹å€‹äººè³‡æ–™
      await _viewProfile(tester);
      
      // æ­¥é©Ÿ 4: ç·¨è¼¯å€‹äººè³‡æ–™
      await _editProfile(tester);
      
      // æ­¥é©Ÿ 5: é©—è­‰æ›´æ–°
      await _verifyProfileUpdate(tester);
      
      // æ­¥é©Ÿ 6: æ¸¬è©¦éŒ¯èª¤è™•ç†
      await _testErrorHandling(tester);
    });
    
    testWidgets('offline functionality test', (WidgetTester tester) async {
      // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
      await tester.pumpWidget(MyApp());
      await TestHelper.pumpAndSettle(tester);
      
      // æ¨¡æ“¬é›¢ç·šç‹€æ…‹
      await _simulateOfflineMode(tester);
      
      // æ¸¬è©¦é›¢ç·šåŠŸèƒ½
      await _testOfflineFunctionality(tester);
      
      // æ¢å¾©ç·šä¸Šç‹€æ…‹
      await _simulateOnlineMode(tester);
      
      // æ¸¬è©¦æ•¸æ“šåŒæ­¥
      await _testDataSynchronization(tester);
    });
    
    testWidgets('error recovery flow test', (WidgetTester tester) async {
      // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
      await tester.pumpWidget(MyApp());
      await TestHelper.pumpAndSettle(tester);
      
      // æ¨¡æ“¬å„ç¨®éŒ¯èª¤æƒ…æ³
      await _testNetworkError(tester);
      await _testValidationError(tester);
      await _testServerError(tester);
      
      // æ¸¬è©¦éŒ¯èª¤æ¢å¾©
      await _testErrorRecovery(tester);
    });
  });
  
  group('Performance Integration Tests', () {
    testWidgets('app startup performance test', (WidgetTester tester) async {
      final stopwatch = Stopwatch()..start();
      
      // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
      await tester.pumpWidget(MyApp());
      await TestHelper.pumpAndSettle(tester);
      
      stopwatch.stop();
      
      // é©—è­‰å•Ÿå‹•æ™‚é–“
      expect(stopwatch.elapsedMilliseconds, lessThan(3000)); // 3 ç§’å…§å•Ÿå‹•
      
      // é©—è­‰é¦–é è¼‰å…¥
      TestHelper.expectWidgetExists(find.byType(HomePage));
    });
    
    testWidgets('memory usage test', (WidgetTester tester) async {
      // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
      await tester.pumpWidget(MyApp());
      await TestHelper.pumpAndSettle(tester);
      
      // åŸ·è¡Œè¨˜æ†¶é«”å¯†é›†å‹æ“ä½œ
      await _performMemoryIntensiveOperations(tester);
      
      // æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³
      // é€™è£¡å¯ä»¥æ·»åŠ è¨˜æ†¶é«”ä½¿ç”¨é‡æª¢æŸ¥é‚è¼¯
    });
  });
}

// è¼”åŠ©æ–¹æ³•
Future<void> _performLogin(WidgetTester tester) async {
  // å°‹æ‰¾ç™»å…¥æŒ‰éˆ•
  final loginButton = find.text('ç™»å…¥');
  if (loginButton.evaluate().isEmpty) {
    // å¦‚æœæ²’æœ‰ç™»å…¥æŒ‰éˆ•ï¼Œå¯èƒ½å·²ç¶“ç™»å…¥
    return;
  }
  
  // é»æ“Šç™»å…¥æŒ‰éˆ•
  await TestHelper.tapAndSettle(tester, loginButton);
  
  // è¼¸å…¥ä½¿ç”¨è€…åç¨±
  await TestHelper.enterTextAndSettle(
    tester,
    find.byKey(Key('username_field')),
    'test@example.com',
  );
  
  // è¼¸å…¥å¯†ç¢¼
  await TestHelper.enterTextAndSettle(
    tester,
    find.byKey(Key('password_field')),
    'password123',
  );
  
  // æäº¤ç™»å…¥è¡¨å–®
  await TestHelper.tapAndSettle(tester, find.text('ç™»å…¥'));
  
  // ç­‰å¾…ç™»å…¥å®Œæˆ
  await TestHelper.pumpAndSettle(tester);
  
  // é©—è­‰ç™»å…¥æˆåŠŸ
  TestHelper.expectWidgetExists(find.byType(HomePage));
}

Future<void> _navigateToProfile(WidgetTester tester) async {
  // é»æ“Šå€‹äººè³‡æ–™é¸é …å¡æˆ–æŒ‰éˆ•
  await TestHelper.tapAndSettle(tester, find.byIcon(Icons.person));
  
  // é©—è­‰å°èˆªæˆåŠŸ
  TestHelper.expectWidgetExists(find.byType(UserProfilePage));
}

Future<void> _viewProfile(WidgetTester tester) async {
  // ç­‰å¾…å€‹äººè³‡æ–™è¼‰å…¥
  await TestHelper.pumpAndSettle(tester);
  
  // é©—è­‰å€‹äººè³‡æ–™é¡¯ç¤º
  TestHelper.expectWidgetExists(find.byType(CircleAvatar));
  TestHelper.expectWidgetExists(find.textContaining('@')); // é›»å­éƒµä»¶
  TestHelper.expectTextExists('ç·¨è¼¯å€‹äººè³‡æ–™');
}

Future<void> _editProfile(WidgetTester tester) async {
  // é»æ“Šç·¨è¼¯æŒ‰éˆ•
  await TestHelper.tapAndSettle(tester, find.text('ç·¨è¼¯å€‹äººè³‡æ–™'));
  
  // é©—è­‰ç·¨è¼¯é é¢é–‹å•Ÿ
  TestHelper.expectWidgetExists(find.byType(EditProfilePage));
  
  // ä¿®æ”¹ä½¿ç”¨è€…åç¨±
  final nameField = find.byKey(Key('name_field'));
  await tester.clear(nameField);
  await TestHelper.enterTextAndSettle(tester, nameField, 'Updated Name');
  
  // ä¿®æ”¹é›»å­éƒµä»¶
  final emailField = find.byKey(Key('email_field'));
  await tester.clear(emailField);
  await TestHelper.enterTextAndSettle(tester, emailField, 'updated@example.com');
  
  // ä¿å­˜è®Šæ›´
  await TestHelper.tapAndSettle(tester, find.text('ä¿å­˜'));
  
  // ç­‰å¾…ä¿å­˜å®Œæˆ
  await TestHelper.pumpAndSettle(tester);
}

```